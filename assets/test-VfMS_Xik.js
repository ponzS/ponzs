import{n as jt,o as H,t as z,I as vt,G as R,F as M,J as P,H as K,v as V,B as X,u as Q,C as st,L as wt,M as gt,N as Tt,O as Ot,P as $t,Q as Dt,R as Y,S as Z,T as tt,U as rt,V as Et,W as Ct}from"./index-B6k_4lB8.js";var lt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bt(q){return q&&q.__esModule&&Object.prototype.hasOwnProperty.call(q,"default")?q.default:q}function At(q){throw new Error('Could not dynamically require "'+q+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var at={exports:{}};at.exports;var bt;function ht(){return bt||(bt=1,function(q){(function(){function b(B,e){return e?At(B):B.slice?b[a(B)]:function(s,d){B(s={exports:{}}),b[a(d)]=s.exports};function a(s){return s.split("/").slice(-1).toString().replace(".js","")}}var G=q;b(function(B){String.random=function(a,s){var d="";for(a=a||24,s=s||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";a-- >0;)d+=s.charAt(Math.floor(Math.random()*s.length));return d},String.match=function(a,s){var d,h;return typeof a!="string"?!1:(typeof s=="string"&&(s={"=":s}),s=s||{},d=s["="]||s["*"]||s[">"]||s["<"],a===d?!0:h!==s["="]?!1:(d=s["*"]||s[">"],a.slice(0,(d||"").length)===d?!0:h!==s["*"]?!1:h!==s[">"]&&h!==s["<"]?a>=s[">"]&&a<=s["<"]:h!==s[">"]&&a>=s[">"]||h!==s["<"]&&a<=s["<"]))},String.hash=function(a,s){if(typeof a=="string"){if(s=s||0,!a.length)return s;for(var d=0,h=a.length,f;d<h;++d)f=a.charCodeAt(d),s=(s<<5)-s+f,s|=0;return s}};var e=Object.prototype.hasOwnProperty;Object.plain=function(a){return a?a instanceof Object&&a.constructor===Object||Object.prototype.toString.call(a).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(a,s){for(var d in a)if(e.call(a,d)&&(!s||s.indexOf(d)==-1))return!1;return!0},Object.keys=Object.keys||function(a){var s=[];for(var d in a)e.call(a,d)&&s.push(d);return s},function(){var a,s=setTimeout,d=0,h=0,f=typeof setImmediate!=""+a&&setImmediate||function(i,w){return typeof MessageChannel==""+a?s:((i=new MessageChannel).port1.onmessage=function(_){_.data==""&&w()},function(_){w=_,i.port2.postMessage("")})}(),u=s.check=s.check||typeof performance!=""+a&&performance||{now:function(){return+new Date}};s.hold=s.hold||9,s.poll=s.poll||function(i){if(s.hold>=u.now()-d&&h++<3333){i();return}f(function(){d=u.now(),i()},h=0)}}(),function(){var a=setTimeout,s=a.turn=a.turn||function(w){d.push(w)==1&&h(i)},d=s.s=[],h=a.poll,f=0,u,i=function(){(u=d[f++])&&u(),(f==d.length||f==99)&&(d=s.s=d.slice(f),f=0),d.length&&h(i)}}(),function(){var a,s=setTimeout,d=s.turn;(s.each=s.each||function(h,f,u,i){i=i||9,function w(_,n,y){if(n=(_=(h||[]).splice(0,i)).length){for(var c=0;c<n&&a===(y=f(_[c]));c++);if(a===y){d(w);return}}u&&u(y)}()})()}()})(b,"./shim"),b(function(B){B.exports=function e(u,s,d){if(!u)return{to:e};var h,f=typeof s=="function",u=(this.tag||(this.tag={}))[u]||f&&(this.tag[u]={tag:u,to:e._={next:function(w){var _;(_=this.to)&&_.next(w)}}});if(f){var i={off:e.off||(e.off=function(){if(this.next===e._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=e._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:e._,next:s,the:u,on:this,as:d};return(i.back=u.last||u).to=i,u.last=i}return(u=u.to)&&h!==s&&u.next(s),u}})(b,"./onto"),b(function(B){B.exports=function(e){return e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"&&e!=1/0&&e!=-1/0&&e===e||!!e&&typeof e["#"]=="string"&&Object.keys(e).length===1&&e["#"]}})(b,"./valid"),b(function(B){b("./shim");function e(){var u=+new Date;return h<u?(s=0,h=u+e.drift):h=u+(s+=1)/d+e.drift}e.drift=0;var a=-1/0,s=0,d=999,h=a,f;e.is=function(u,i,w){var _=i&&u&&u._&&u._[">"]||w;if(_)return typeof(_=_[i])=="number"?_:a},e.ify=function(u,i,w,_,n){(u=u||{})._=u._||{},n&&(u._["#"]=n);var y=u._[">"]||(u._[">"]={});return f!==i&&i!=="_"&&(typeof w=="number"&&(y[i]=w),f!==_&&(u[i]=_)),u},B.exports=e})(b,"./state"),b(function(B){b("./shim");function e(a){var s={s:{}},d=s.s;a=a||{max:999,age:1e3*9},s.check=function(f){return d[f]?h(f):!1};var h=s.track=function(f){var u=d[f]||(d[f]={});return u.was=s.now=+new Date,s.to||(s.to=setTimeout(s.drop,a.age+9)),h.ed&&h.ed(f),u};return s.drop=function(f){s.to=null,s.now=+new Date;var u=Object.keys(d);console.STAT&&console.STAT(s.now,+new Date-s.now,"dup drop keys"),setTimeout.each(u,function(i){var w=d[i];w&&(f||a.age)>s.now-w.was||delete d[i]},0,99)},s}B.exports=e})(b,"./dup"),b(function(B){b("./onto"),B.exports=function(s,d){if(this.on){var h=(this.opt||{}).lack||9e3;if(typeof s!="function"){if(!s)return;var u=s["#"]||s,f=(this.tag||"")[u];return f?(d&&(f=this.on(u,d),clearTimeout(f.err),f.err=setTimeout(function(){f.off()},h)),!0):void 0}var u=d&&d["#"]||e(9);if(!s)return u;var i=this.on(u,s,d);return i.err=i.err||setTimeout(function(){i.off(),i.next({err:"Error: No ACK yet.",lack:!0})},h),u}};var e=String.random||function(){return Math.random().toString(36).slice(2)}})(b,"./ask"),b(function(B){function e(n){return n instanceof e?(this._={$:this}).$:this instanceof e?e.create(this._={$:this,opt:n}):new e(n)}e.is=function(n){return n instanceof e||n&&n._&&n===n._.$||!1},e.version=.202,e.chain=e.prototype,e.chain.toJSON=function(){},b("./shim"),e.valid=b("./valid"),e.state=b("./state"),e.on=b("./onto"),e.dup=b("./dup"),e.ask=b("./ask"),function(){e.create=function(o){o.root=o.root||o,o.graph=o.graph||{},o.on=o.on||e.on,o.ask=o.ask||e.ask,o.dup=o.dup||e.dup();var x=o.$.opt(o.opt);return o.once||(o.on("in",n,o),o.on("out",n,o),o.on("put",v,o),e.on("create",o),o.on("create",o)),o.once=1,x};function n(o){if(o){if(o.out===n){this.to.next(o);return}var x=this,T=x.as,E=T.at||T,D=E.$,j=E.dup,S,$=o.DBG;if((S=o["#"])||(S=o["#"]=s(9)),!j.check(S)){if(j.track(S),S=o._,o._=typeof S=="function"?S:function(){},o.$&&o.$===(o.$._||"").$||(o.$=D),o["@"]&&!o.put&&t(o),!E.ask(o["@"],o))if($&&($.u=+new Date),o.put){y(o);return}else o.get&&e.on.get(o,D);$&&($.uc=+new Date),x.to.next(o),$&&($.ua=+new Date),!(o.nts||o.NTS)&&(o.out=n,E.on("out",o),$&&($.ue=+new Date))}}}function y(o){if(o){var x=o._||"",T=x.root=((x.$=o.$||"")._||"").root;if(o["@"]&&x.faith&&!x.miss){o.out=n,T.on("out",o);return}x.latch=T.hatch,x.match=T.hatch=[];var E=o.put,D=x.DBG=o.DBG,j=+new Date;if(C=C||j,!(E["#"]&&E["."])){D&&(D.p=j),x["#"]=o["#"],x.msg=o,x.all=0,x.stun=1;var S=Object.keys(E);console.STAT&&console.STAT(j,((D||x).pk=+new Date)-j,"put sort");var $=0,U,I,J,L,F,W,it;(function et(ot){if(U!=$){if(U=$,!(J=S[$])){console.STAT&&console.STAT(j,((D||x).pd=+new Date)-j,"put"),r(x);return}(L=E[J])?(it=L._)?J!==it["#"]?W=p+m(J)+"soul not same.":(F=it[">"])||(W=p+m(J)+"no state."):W=p+m(J)+"no meta.":W=p+m(J)+"no node.",I=Object.keys(L||{})}if(W){o.err=x.err=W,r(x);return}var dt=0,nt;for(ot=ot||0;ot++<9&&(nt=I[dt++]);)if(nt!=="_"){var ut=L[nt],yt=F[nt];if(i===yt){W=p+m(nt)+"on"+m(J)+"no state.";break}if(!h(ut)){W=p+m(nt)+"on"+m(J)+"bad "+typeof ut+m(ut);break}c(ut,nt,J,yt,o),++N}if((I=I.slice(dt)).length){d(et);return}++$,I=null,et(ot)})()}}}e.on.put=y;function c(o,x,T,E,D){var j=D._||"",S=j.root,$=S.graph,U,I=$[T]||w,J=f(I,x,1),L=I[x],F=j.DBG;(U=console.STAT)&&(!$[T]||!L)&&(U.has=(U.has||0)+1);var W=O();if(E>W){setTimeout(function(){c(o,x,T,E,D)},(U=E-W)>A?A:U),console.STAT&&console.STAT((F||j).Hf=+new Date,U,"future");return}if(!(E<J)&&!(!j.faith&&E===J&&(o===L||k(o)<=k(L))&&!j.miss)){j.stun++;var it=D["#"]+j.all++,et={toString:function(){return it},_:j};et.toJSON=et.toString,S.dup.track(et)["#"]=D["#"],F&&(F.ph=F.ph||+new Date),S.on("put",{"#":et,"@":D["@"],put:{"#":T,".":x,":":o,">":E},ok:D.ok,_:j})}}function v(o){var x;(x=(o._||"").DBG)&&(x.pa=+new Date,x.pm=x.pm||+new Date);var T=this,E=T.as,D=E.graph,j=o._,S=o.put,$=S["#"],U=S["."],I=S[":"],J=S[">"];o["#"];var L;(L=j.msg)&&(L=L.put)&&(L=L[$])&&u(L,U,J,I,$),D[$]=u(D[$],U,J,I,$),(L=(E.next||"")[$])&&L.on("in",o),r(j),T.to.next(o)}function r(o,x){var T;if(!o.stop&&!(!o.err&&0<--o.stun)&&(o.stop=1,!!(T=o.root))){var E=o.match;E.end=1,E===T.hatch&&(!(E=o.latch)||E.end?delete T.hatch:T.hatch=E),o.hatch&&o.hatch(),setTimeout.each(o.match,function(D){D&&D()}),!(!(x=o.msg)||o.err||x.err)&&(x.out=n,o.root.on("out",x),g())}}function t(o){var x=o["@"]||"",T;if(!(T=x._)){var E=(E=o.$)&&(E=E._)&&(E=E.root)&&(E=E.dup);if(!(E=E.check(x)))return;o["@"]=E["#"]||o["@"];return}T.acks=(T.acks||0)+1,(T.err=o.err)&&(o["@"]=T["#"],r(T)),T.ok=o.ok||T.ok,!T.stop&&!T.crack&&(T.crack=T.match&&T.match.push(function(){l(T)})),l(T)}function l(o){!o||!o.root||o.stun||o.acks!==o.all||o.root.on("in",{"@":o["#"],err:o.err,ok:o.err?i:o.ok||{"":1}})}var p="Error: Invalid graph!",m=function(o){return" '"+(""+o).slice(0,9)+"...' "},k=JSON.stringify,A=2147483647,O=e.state,N=0,C,g=function(){N>999&&N/-(C-(C=+new Date))>1&&(e.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),g=function(){N=0})}}(),function(){e.on.get=function(y,c){var v=c._,r=y.get,t=r["#"],l=v.graph[t],p=r["."],m=v.next||(v.next={}),k=m[t],A=y._||{},O=A.DBG=y.DBG;if(O&&(O.g=+new Date),!l)return v.on("get",y);if(p){if((typeof p!="string"||i===l[p])&&!((k||"").next||"")[p]){v.on("get",y);return}l=u({},p,f(l,p),l[p],t)}l&&n(y,l),v.on("get",y)};function n(y,c){var v=+new Date,r=y._||{},t=r.DBG=y.DBG,l=y["#"],p=s(9),m=Object.keys(c||"").sort(),k=((c||"")._||"")["#"];m.length;var A=y.$._.root,O=c===A.graph[k];console.STAT&&console.STAT(v,((t||r).gk=+new Date)-v,"got keys"),c&&function N(){v=+new Date;for(var C=0,g,o={},x;C<9&&(g=m[C++]);)u(o,g,f(c,g),c[g],k);m=m.slice(C),(x={})[k]=o,o=x;var T;O&&(T=function(){},T.ram=T.faith=!0),x=m.length,console.STAT&&console.STAT(v,-(v-(v=+new Date)),"got copied some"),t&&(t.ga=+new Date),A.on("in",{"@":l,"#":p,put:o,"%":x?p=s(9):i,$:A.$,_:T,DBG:t,FOO:1}),console.STAT&&console.STAT(v,+new Date-v,"got in"),x&&setTimeout.turn(N)}(),c||A.on("in",{"@":y["#"]})}e.on.get.ack=n}(),function(){e.chain.opt=function(n){n=n||{};var y=this,c=y._,v=n.peers||n;return Object.plain(n)||(n={}),Object.plain(c.opt)||(c.opt=n),typeof v=="string"&&(v=[v]),Object.plain(c.opt.peers)||(c.opt.peers={}),v instanceof Array&&(n.peers={},v.forEach(function(r){var t={};t.id=t.url=r,n.peers[r]=c.opt.peers[r]=c.opt.peers[r]||t})),a(n,function r(t){var l=this[t];if(this&&this.hasOwnProperty(t)||typeof l=="string"||Object.empty(l)){this[t]=l;return}l&&l.constructor!==Object&&!(l instanceof Array)||a(l,r)}),c.opt.from=n,e.on("opt",c),c.opt.uuid=c.opt.uuid||function(t){return e.state().toString(36).replace(".","")+String.random(t||12)},y}}();var a=function(n,y){Object.keys(n).forEach(y,n)},s=String.random,d=setTimeout.turn,h=e.valid,f=e.state.is,u=e.state.ify,i,w={},_;e.log=function(){return!e.log.off&&_.log.apply(_,arguments),[].slice.call(arguments).join(" ")},e.log.once=function(n,y,c){return(c=e.log.once)[n]=c[n]||0,c[n]++||e.log(y)},typeof window<"u"&&((window.GUN=window.Gun=e).window=window);try{typeof G<"u"&&(G.exports=e)}catch{}B.exports=e,(e.window||{}).console=(e.window||{}).console||{log:function(){}},(_=console).only=function(n,y){return _.only.i&&n===_.only.i&&_.only.i++&&(_.log.apply(_,arguments)||y)},e.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(b,"./root"),b(function(B){var e=b("./root");e.chain.back=function(d,h){var f;if(d=d||1,d===-1||d===1/0)return this._.root.$;if(d===1)return(this._.back||this._).$;var u=this,i=u._;if(typeof d=="string"&&(d=d.split(".")),d instanceof Array){var w=0,_=d.length,f=i;for(w;w<_;w++)f=(f||a)[d[w]];return s!==f?h?u:f:(f=i.back)?f.$.back(d,h):void 0}if(typeof d=="function"){for(var n,f={back:i};(f=f.back)&&s===(n=d(f,h)););return n}return typeof d=="number"?(i.back||i).$.back(d-1):this};var a={},s})(b,"./back"),b(function(B){var e=b("./root");e.chain.chain=function(r){var t=this,l=t._,p=new(r||t).constructor(t),m=p._,k;return m.root=k=l.root,m.id=++k.once,m.back=t._,m.on=e.on,m.on("in",e.on.in,m),m.on("out",e.on.out,m),p};function a(r){var t,l=this.as,p=l.back,m=l.root,k;if(r.$||(r.$=l.$),this.to.next(r),l.err){l.on("in",{put:l.put=i,$:l.$});return}if(t=r.get){if(m.pass&&(m.pass[l.id]=l),l.lex&&Object.keys(l.lex).forEach(function(A){k[A]=l.lex[A]},k=r.get=r.get||{}),t["#"]||l.soul){if(t["#"]=t["#"]||l.soul,r["#"]||(r["#"]=w(9)),p=m.$.get(t["#"])._,t=t["."]){if(n(p.put,t)&&(k=p.ask&&p.ask[t],(p.ask||(p.ask={}))[t]=p.$.get(t)._,p.on("in",{get:t,put:{"#":p.soul,".":t,":":p.put[t],">":c(m.graph[p.soul],t)}}),k))return}else{if(k=p.ask&&p.ask[""],(p.ask||(p.ask={}))[""]=p,i!==p.put&&(p.on("in",p),k))return;r.$=p.$}return m.ask(f,r),m.on("in",r)}if(t["."])return l.get?(r={get:{".":l.get},$:l.$},(p.ask||(p.ask={}))[l.get]=r.$._,p.on("out",r)):(r={get:l.lex?r.get:{},$:l.$},p.on("out",r));if((l.ask||(l.ask={}))[""]=l,l.get)return t["."]=l.get,(p.ask||(p.ask={}))[l.get]=r.$._,p.on("out",r)}return p.on("out",r)}e.on.out=a;function s(r,t){t=t||this.as;var l=t.root,p=r.$||(r.$=t.$),m=(p||"")._||u,k=r.put||"",A=k["#"],O=k["."],N=i!==k["="]?k["="]:k[":"],C=k[">"]||-1/0,g;if(i!==r.put&&(i===k["#"]||i===k["."]||i===k[":"]&&i===k["="]||i===k[">"])){if(!_(k)){if(!(A=((k||"")._||"")["#"])){console.log("chain not yet supported for",k,"...",r,t);return}return p=t.root.$.get(A),setTimeout.each(Object.keys(k).sort(),function(o){o=="_"||i===(C=c(k,o))||t.on("in",{$:p,put:{"#":A,".":o,"=":k[o],">":C},VIA:r})})}t.on("in",{$:m.back.$,put:{"#":A=m.back.soul,".":O=m.has||m.get,"=":k,">":c(m.back.put,O)},via:r});return}(r.seen||"")[t.id]||((r.seen||(r.seen=function(){}))[t.id]=t,t!==m&&(Object.keys(r).forEach(function(o){k[o]=r[o]},k={}),k.get=t.get||k.get,!t.soul&&!t.has?k.$$$=k.$$$||t.$:m.soul&&(k.$=t.$,k.$$=k.$$||m.$),r=k),h(r,t),(t.soul||r.$$)&&C>=c(l.graph[A],O)&&((k=l.$.get(A)._).put=v(k.put,O,C,N,A)),!m.soul&&C>=c(l.graph[A],O)&&(g=(l.$.get(A)._.next||"")[O])&&(g.put=N,typeof(k=_(N))=="string"&&(g.put=l.$.get(k)._.put||N)),this.to&&this.to.next(r),t.any&&setTimeout.each(Object.keys(t.any),function(o){(o=t.any[o])&&o(r)},0,99),t.echo&&setTimeout.each(Object.keys(t.echo),function(o){(o=t.echo[o])&&o.on("in",r)},0,99),((r.$$||"")._||m).soul&&(g=t.next)&&(g=g[O])&&(k={},Object.keys(r).forEach(function(o){k[o]=r[o]}),k.$=(r.$$||r.$).get(k.get=O),delete k.$$,delete k.$$$,g.on("in",k)),d(r,t))}e.on.in=s;function d(r,t){if(t=t||this.as||r.$._,!(r.$$&&this!==e.on)&&!(!r.put||t.soul)){var l=r.put||"",p=l["="]||l[":"],O,m=t.root,k=m.$.get(l["#"]).get(l["."])._;if(typeof(p=_(p))!="string"){this===e.on&&((k.echo||(k.echo={}))[t.id]=t);return}if(!((k.echo||(k.echo={}))[t.id]&&!(m.pass||"")[t.id])){if(O=m.pass){if(O[p+t.id])return;O[p+t.id]=1}(k.echo||(k.echo={}))[t.id]=t,t.has&&(t.link=p);var A=m.$.get(k.link=p)._;(A.echo||(A.echo={}))[k.id]=k;var O=t.ask||"";(O[""]||t.lex)&&A.on("out",{get:{"#":p}}),setTimeout.each(Object.keys(O),function(N,C){!N||!(C=O[N])||C.on("out",{get:{"#":p,".":N}})},0,99)}}}e.on.link=d;function h(r,t){var l=r.put||"",p=i!==l["="]?l["="]:l[":"],m=t.root,k,A;if(i===p){if(t.soul&&i!==t.put||(A=(r.$$||r.$||"")._||"",r["@"]&&(i!==A.put||i!==t.put)))return;(k=t.link||r.linked)&&delete(m.$.get(k)._.echo||"")[t.id],t.has&&(t.link=null),t.put=i,setTimeout.each(Object.keys(t.next||""),function(O,N){(N=t.next[O])&&(k&&delete(m.$.get(k).get(O)._.echo||"")[N.id],N.on("in",{get:O,put:i,$:N.$}))},0,99);return}t.soul||r.$$||(k=_(p),A=r.$._||"",!((k===A.link||t.has&&!A.link)&&!((m.pass||"")[t.id]&&typeof k!="string"))&&(delete(A.echo||"")[t.id],h({get:t.get,put:i,$:r.$,linked:r.linked=r.linked||A.link},t)))}e.on.unlink=h;function f(r,t){var l=this.as,p=l.$._;p.root;var m=l.get||"",k=(r.put||"")[m["#"]]||"";if(!r.put||typeof m["."]=="string"&&i===k[m["."]]){if(i!==p.put||!p.soul&&!p.has)return;p.ack=(p.ack||0)+1,p.on("in",{get:p.get,put:p.put=i,$:p.$,"@":r["@"]});return}(r._||{}).miss=1,e.on.put(r)}var u={},i,w=String.random,_=e.valid,n=function(r,t){return r&&Object.prototype.hasOwnProperty.call(r,t)},y=e.state,c=y.is,v=y.ify})(b,"./chain"),b(function(B){var e=b("./root");e.chain.get=function(i,w,_){var n,y;if(typeof i=="string"){if(i.length==0)return(n=this.chain())._.err={err:e.log("0 length key!",i)},w&&w.call(n,n._.err),n;var c=this,v=c._,r=v.next||h;(n=r[i])||(n=i&&a(i,c)),n=n&&n.$}else if(typeof i=="function"){let A=function(O,N,C){if(!A.stun&&!((D=l.pass)&&!D[p])){var g=O.$._,o=(O.$$||"")._,x=(o||g).put,T=!g.has&&!g.soul,E={},D;if((T||u===x)&&(x=u===((D=O.put)||"")["="]?u===(D||"")[":"]?D:D[":"]:D["="]),typeof(D=e.valid(x))=="string"&&(x=u===(D=l.$.get(D)._.put)?t.not?u:x:D),!(t.not&&u===x)){if(u===t.stun){if((D=l.stun)&&D.on&&(v.$.back(function(j){if(D.on(""+j.id,E={}),(E.run||0)<A.id)return E}),!E.run&&D.on(""+g.id,E={}),!E.run&&o&&D.on(""+o.id,E={}),A.id>E.run&&((!E.stun||E.stun.end)&&(E.stun=D.on("stun"),E.stun=E.stun&&E.stun.last),E.stun&&!E.stun.end))){(E.stun.add||(E.stun.add={}))[p]=function(){A(O,N,1)};return}if(u===x&&(C=0),(D=l.hatch)&&!D.end&&u===t.hatch&&!C){if(m[g.$._.id])return;m[g.$._.id]=1,D.push(function(){A(O,N,1)});return}m={}}if(l.pass){if(l.pass[p+g.id])return;l.pass[p+g.id]=1}if(t.on){t.ok.call(g.$,x,g.get,O,N||A);return}if(t.v2020){t.ok(O,N||A);return}Object.keys(O).forEach(function(j){D[j]=O[j]},D={}),O=D,O.put=x,t.ok.call(t.as,O,N||A)}}};if(w===!0)return s(this,i,w,_),this;n=this;var v=n._,t=w||{},l=v.root,p;t.at=v,t.ok=i;var m={};return A.at=v,(v.any||(v.any={}))[p=String.random(7)]=A,A.off=function(){A.stun=1,v.any&&delete v.any[p]},A.rid=d,A.id=t.run||++l.once,y=l.pass,(l.pass={})[p]=1,t.out=t.out||{get:{}},v.on("out",t.out),l.pass=y,n}else{if(typeof i=="number")return this.get(""+i,w,_);if(typeof(y=f(i))=="string")return this.get(y,w,_);(y=this.get.next)&&(n=y(this,i))}return n?(w&&typeof w=="function"&&n.get(w,_),n):((n=this.chain())._.err={err:e.log("Invalid get request!",i)},w&&w.call(n,n._.err),n)};function a(i,w){var _=w._,n=_.next,y=w.chain(),c=y._;return n||(n=_.next={}),n[c.get=i]=c,w===_.root.$?c.soul=i:(_.soul||_.has)&&(c.has=i),c}function s(i,w,_,n){var y=i._,c=0,v;return(v=y.soul||y.link)?w(v,n,y):y.jam?y.jam.push([w,n]):(y.jam=[[w,n]],i.get(function(t,l){if(!(u===t.put&&!y.root.opt.super&&(v=Object.keys(y.root.opt.peers).length)&&++c<=v)){l.rid(t);var p=(p=t.$)&&p._||{},m=0,k;for(v=y.jam,delete y.jam;k=v[m++];){var A=k[0];k=k[1],A&&A(p.link||p.soul||e.valid(t.put)||((t.put||{})._||{})["#"],k,t,l)}}},{out:{get:{".":!0}}}),i)}function d(i){var w=this.at||this.on;if(!i||w.soul||w.has)return this.off();if(i=(i=(i=i.$||i)._||i).id){w.map;var _;if((_=this.seen||(this.seen={}))[i])return!0;_[i]=!0}}var h={},f=e.valid,u})(b,"./get"),b(function(B){var e=b("./root");e.chain.put=function(n,y,c){var v=this,r=v._,t=r.root;c=c||{},c.root=r.root,c.run||(c.run=t.once),a(c,r.id),c.ack=c.ack||y,c.via=c.via||v,c.data=c.data||n,c.soul||(c.soul=r.soul||typeof y=="string"&&y);var l=c.state=c.state||e.state();return typeof n=="function"?(n(function(p){c.data=p,v.put(f,f,c)}),v):c.soul?(c.$=t.$.get(c.soul),c.todo=[{it:c.data,ref:c.$}],c.turn=c.turn||i,c.ran=c.ran||s,function p(){var m=c.todo,k=m.pop(),A=k.it;k.ref&&k.ref._.id;var O,N,C,g,o;if(a(c,k.ref),(g=k.todo)&&(N=g.pop(),A=A[N],g.length&&m.push(k)),N&&(m.path||(m.path=[])).push(N),!(O=w(A))&&!(o=e.is(A))){if(!Object.plain(A)){s.err(c,"Invalid data: "+h(A)+" at "+(c.via.back(function(D){D.get&&g.push(D.get)},g=[])||g.join("."))+"."+(m.path||[]).join("."));return}for(var x=c.seen||(c.seen=[]),T=x.length;T--;)if(A===(g=x[T]).it){O=A=g.link;break}}if(N&&O)k.node=_(k.node,N,l,A);else{let D=function(j,S){var $=C.link["#"];S&&(S.off(),S.rid(j));var U=$||j.soul||(g=(j.$$||j.$)._||"").soul||g.link||((g=g.put||"")._||"")["#"]||g["#"]||((g=j.put||"")&&j.$$?g["#"]:(g["="]||g[":"]||"")["#"]);if(!$&&a(c,j.$),!U&&!k.link["#"]){(k.wait||(k.wait=[])).push(function(){D(j,S)});return}U||(U=[],(j.$$||j.$).back(function(I){if(g=I.soul||I.link)return U.push(g);U.push(I.get)}),U=U.reverse().join("/")),C.link["#"]=U,!o&&(((c.graph||(c.graph={}))[U]=C.node||(C.node={_:{}}))._["#"]=U),delete c.wait[E],C.wait&&setTimeout.each(C.wait,function(I){I&&I()}),c.ran(c)};if(!c.seen){s.err(c,"Data at root of graph must be a node (an object).");return}c.seen.push(C={it:A,link:{},todo:o?[]:Object.keys(A).sort().reverse(),path:(m.path||[]).slice(),up:k}),k.node=_(k.node,N,l,C.link),!o&&C.todo.length&&m.push(C);var E=c.seen.length;(c.wait||(c.wait={}))[E]="",g=(C.ref=o?A:N?k.ref.get(N):k.ref)._,(g=A&&(A._||"")["#"]||g.soul||g.link)?D({soul:g}):C.ref.get(D,{run:c.run,v2020:1,out:{get:{".":" "}}})}if(!m.length)return c.ran(c);c.turn(p)}(),v):(d(c),v)};function a(n,y){if(y){y=(y._||"").id||y;var c=n.root.stun||(n.root.stun={on:e.on}),v={},r;n.stun||(n.stun=c.on("stun",function(){})),(r=c.on(""+y))&&r.the.last.next(v),!(v.run>=n.run)&&c.on(""+y,function(t){if(n.stun.end){this.off(),this.to.next(t);return}t.run=t.run||n.run,t.stun=t.stun||n.stun})}}function s(n){if(n.err){s.end(n.stun,n.root);return}if(!(n.todo.length||n.end||!Object.empty(n.wait))){n.end=1;var y=n.$.back(-1)._,c=y.root,v=y.ask(function(p){c.on("ack",p),p.err&&!p.lack&&e.log(p),++r>(n.acks||0)&&this.off(),n.ack&&n.ack(p,this)},n.opt),r=0,t=n.stun,l;(l=function(){t&&(s.end(t,c),setTimeout.each(Object.keys(t=t.add||""),function(p){(p=t[p])&&p()}))}).hatch=l,n.ack&&!n.ok&&(n.ok=n.acks||9),n.via._.on("out",{put:n.out=n.graph,ok:n.ok&&{"@":n.ok+1},opt:n.opt,"#":v,_:l})}}s.end=function(n,y){n.end=u,n.the.to===n&&n===n.the.last&&delete y.stun,n.off()},s.err=function(n,y){(n.ack||u).call(n,n.out={err:n.err=e.log(y)}),n.ran(n)};function d(n){var y=n.via._,c;n.via=n.via.back(function(v){if(v.soul||!v.get)return v.$;c=n.data,(n.data={})[v.get]=c}),(!n.via||!n.via._.soul)&&(n.via=y.root.$.get(((n.data||"")._||"")["#"]||y.$.back("opt.uuid")())),n.via.put(n.data,n.ack,n)}function h(n,y){return n&&(y=n.constructor)&&y.name||typeof n}var f,u=function(){},i=setTimeout.turn,w=e.valid,_=e.state.ify})(b,"./put"),b(function(B){var e=b("./root");b("./chain"),b("./back"),b("./put"),b("./get"),B.exports=e})(b,"./index"),b(function(B){var e=b("./index");e.chain.on=function(d,h,f,u){var i=this,w=i._;w.root;var _;if(typeof d=="string")return h?(_=w.on(d,h,f||w,u),f&&f.$&&(f.subs||(f.subs=[])).push(_),i):w.on(d);var n=h;return(n=n===!0?{change:!0}:n||{}).not=1,n.on=1,i.get(d,n),i},e.chain.once=function(d,h){if(h=h||{},!d)return a(this);var f=this,u=f._,i=u.root;u.put;var w=String.random(7),_;return f.get(function(n,y,c,v){var r=this,t=r._,l=t.one||(t.one={});if(v.stun||l[w]==="")return;if((_=e.valid(n))===!0){p();return}if(typeof _=="string")return;clearTimeout((u.one||"")[w]),clearTimeout(l[w]),l[w]=setTimeout(p,h.wait||99);function p(m){if(!t.has&&!t.soul&&(t={put:n,get:y}),s===(_=t.put)&&(_=((c.$$||"")._||"").put),typeof e.valid(_)=="string"&&(_=i.$.get(_)._.put,_===s&&!m)){l[w]=setTimeout(function(){p(1)},h.wait||99);return}v.stun||l[w]!==""&&(l[w]="",(u.soul||u.has)&&v.off(),d.call(r,_,t.get),clearTimeout(l[w]))}},{on:1}),f};function a(d,h,f){return e.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(f=d.chain())._.nix=d.once(function(u,i){f._.on("in",this._)}),f._.lex=d._.lex,f}e.chain.off=function(){var d=this,h=d._,f,u=h.back;if(u)return h.ack=0,(f=u.next)&&f[h.get]&&delete f[h.get],(f=u.any)&&(delete u.any,u.any={}),(f=u.ask)&&delete f[h.get],(f=u.put)&&delete f[h.get],(f=h.soul)&&delete u.root.graph[f],(f=h.map)&&Object.keys(f).forEach(function(i,w){w=f[i],w.link&&u.root.$.get(w.link).off()}),(f=h.next)&&Object.keys(f).forEach(function(i,w){w=f[i],w.$.off()}),h.on("off",{}),d};var s})(b,"./on"),b(function(B){var e=b("./index"),a=e.chain.get.next;e.chain.get.next=function(f,u){var i;return Object.plain(u)?(i=((i=u["#"])||"")["="]||i)?f.get(i):((i=f.chain()._).lex=u,f.on("in",function(w){String.match(w.get||(w.put||"")["."],u["."]||u["#"]||u)&&i.on("in",w),this.to.next(w)}),i.$):(a||d)(f,u)},e.chain.map=function(f,u,i){var w=this,_=w._,n,y;return Object.plain(f)&&(n=f["."]?f:{".":f},f=h),f?(e.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),y=w.chain(),w.map().on(function(c,v,r,t){var l=(f||d).call(this,c,v,r,t);if(h!==l){if(c===l)return y._.on("in",r);if(e.is(l))return y._.on("in",l._);var p={};Object.keys(r.put).forEach(function(m){p[m]=r.put[m]},p),p["="]=l,y._.on("in",{get:v,put:p})}}),y):((y=_.each)||((_.each=y=w.chain())._.lex=n||y._.lex||_.lex,y._.nix=w.back("nix"),w.on("in",s,y._)),y)};function s(f){this.to.next(f);var u=this.as,i=f.$,w=i._,_=f.put,n;!w.soul&&!f.$$||(n=u.lex)&&!String.match(f.get||(_||"")["."],n["."]||n["#"]||n)||e.on.link(f,u)}var d=function(){},h})(b,"./map"),b(function(B){var e=b("./index");e.chain.set=function(a,s,d){var h=this,f=h.back(-1),u,i;return s=s||function(){},d=d||{},d.item=d.item||a,(u=((a||"")._||"")["#"])&&((a={})["#"]=u),typeof(i=e.valid(a))=="string"?h.get(u=i).put(a,s,d):e.is(a)?(h.put(function(w){a.get(function(_,n,y){if(!_)return s.call(h,{err:e.log('Only a node can be linked! Not "'+y.put+'"!')});(i={})[_]={"#":_},w(i)},!0)}),a):(Object.plain(a)&&(a=f.get(u=h.back("opt.uuid")()).put(a)),h.get(u||f.back("opt.uuid")(7)).put(a,s,d))}})(b,"./set"),b(function(B){b("./shim");var e=function(){},a=JSON.parseAsync||function(f,u,i){var w,_=+new Date;try{u(w,JSON.parse(f,i),s.sucks(+new Date-_))}catch(n){u(n)}},s=JSON.stringifyAsync||function(f,u,i,w){var _,n=+new Date;try{u(_,JSON.stringify(f,i,w),s.sucks(+new Date-n))}catch(y){u(y)}};s.sucks=function(f){f>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),s.sucks=e)};function d(f){var u=function(){},i=f.opt||{};i.log=i.log||console.log,i.gap=i.gap||i.wait||0,i.max=i.max||(i.memory?i.memory*999*999:3e8)*.3,i.pack=i.pack||i.max*.01*.01,i.puff=i.puff||9;var w=setTimeout.turn||setTimeout,_=f.dup,n=_.check,y=_.track,c=u.hear=function(t,l){if(t){if(i.max<=t.length)return u.say({dam:"!",err:"Message too big!"},l);u===this&&(c.d+=t.length||0,++c.c);var p=l.SH=+new Date,m=t[0],k;if(m==="["){a(t,function(A,O){if(A||!O)return u.say({dam:"!",err:"DAM JSON parse error."},l);console.STAT&&console.STAT(+new Date,O.length,"# on hear batch");var N=i.puff;(function C(){for(var g=+new Date,o=0,x;o<N&&(x=O[o++]);)u.hear(x,l);O=O.slice(o),console.STAT&&console.STAT(g,+new Date-g,"hear loop"),v(l),O.length&&w(C,0)})()}),t="";return}if(m==="{"||(t["#"]||Object.plain(t))&&(k=t)){if(k)return c.one(k,l,p);a(t,function(A,O){if(A||!O)return u.say({dam:"!",err:"DAM JSON parse error."},l);c.one(O,l,p)});return}}};c.one=function(t,l,C){var m,k,A,O,N;if(t.DBG&&(t.DBG=N={DBG:t.DBG}),N&&(N.h=C),N&&(N.hp=+new Date),(m=t["#"])||(m=t["#"]=String.random(9)),!(A=n(m))&&(k=t["##"],!(k&&(A=t["@"]||t.get&&m)&&_.check(O=A+k)))){if((t._=function(){}).via=u.leap=l,(A=t["><"])&&typeof A=="string"&&A.slice(0,99).split(",").forEach(function(g){this[g]=1},t._.yo={}),A=t.dam){(A=u.hear[A])&&A(t,l,f),y(m);return}(A=t.ok)&&(t._.near=A["/"]);var C=+new Date;N&&(N.is=C),l.SI=m,y.ed=function(g){m===g&&(y.ed=0,(g=_.s[m])&&(g.via=l,t.get&&(g.it=t)))},f.on("in",u.last=t),N&&(N.hd=+new Date),console.STAT&&console.STAT(C,+new Date-C,t.get?"msg get":t.put?"msg put":"msg"),y(m),O&&y(O),u.leap=u.last=null}},c.c=c.d=0,function(){var t=0,l;u.hash=function(k,A){var O,N,C,g=+new Date;s(k.put,function o(x,T){var E=(N||(N=C=T||"")).slice(0,32768);if(O=String.hash(E,O),N=N.slice(32768),N){w(o,0);return}console.STAT&&console.STAT(g,+new Date-g,"say json+hash"),k._.$put=C,k["##"]=O,u.say(k,A),delete k._.$put},p)};function p(k,A){var O;return A instanceof Object?(Object.keys(A).sort().forEach(m,{to:O={},on:A}),O):A}function m(k){this.to[k]=this.on[k]}u.say=function(k,A){var O;if((O=this)&&(O=O.to)&&O.next&&O.next(k),!k)return!1;var N,C,g,o=k["@"],x=k._||(k._=function(){}),T=k.DBG,E=+new Date;if(x.y=x.y||E,A||T&&(T.y=E),(N=k["#"])||(N=k["#"]=String.random(9)),!l&&y(N),!(C=k["##"])&&h!==k.put&&!x.via&&o){u.hash(k,A);return}if(!A&&o&&(A=(O=_.s[o])&&(O.via||(O=O.it)&&(O=O._)&&O.via)||(O=u.last)&&o===O["#"]&&u.leap),!A&&o)return _.s[o]?void 0:(console.STAT&&console.STAT(+new Date,++t,"total no peer to ack to"),!1);if(o&&!k.put&&!C&&((_.s[o]||"").it||"")["##"])return!1;if(!A&&u.way)return u.way(k);if(T&&(T.yh=+new Date),!(g=x.raw)){u.raw(k,A);return}if(T&&(T.yr=+new Date),!A||!A.id){if(!Object.plain(A||i.peers))return!1;var E=+new Date;i.puff;var D=i.peers,j=Object.keys(A||i.peers||{});console.STAT&&console.STAT(E,+new Date-E,"peer keys"),function U(){var I=+new Date;l=1;var J=x.raw;x.raw=g;for(var L=0,F;L<9&&(F=(j||"")[L++]);)(F=D[F]||(A||"")[F])&&u.say(k,F);x.raw=J,l=0,j=j.slice(L),console.STAT&&console.STAT(I,+new Date-I,"say loop"),j.length&&(w(U,0),o&&y(o))}();return}if(!A.wire&&u.wire&&u.wire(A),N!==A.last){if(A.last=N,A===x.via||(O=x.yo)&&(O[A.url]||O[A.pid]||O[A.id]))return!1;if(console.STAT&&console.STAT(E,((T||x).yp=+new Date)-(x.y||E),"say prep"),!l&&o&&y(o),A.batch){if(A.tail=(O=A.tail||0)+g.length,A.tail<=i.pack){A.batch+=(O?",":"")+g;return}v(A)}A.batch="[";var S=+new Date;setTimeout(function(){console.STAT&&console.STAT(S,+new Date-S,"0ms TO"),v(A)},i.gap),r(g,A),console.STAT&&o===A.SI&&console.STAT(E,+new Date-A.SH,"say ack")}},u.say.c=u.say.d=0,u.raw=function(k,A){if(!k)return"";var O=k._||{},N,C;if(C=O.raw)return C;if(typeof k=="string")return k;var g=k["##"],o=k["@"];if(g&&o){if(!O.via&&n(o+g))return!1;if(C=(_.s[o]||"").it){if(g===C["##"])return!1;C["##"]||(C["##"]=g)}}if(!k.dam&&!k["@"]){var x=0,T=[];C=i.peers;for(var E in C){var D=C[E];if(T.push(D.url||D.pid||D.id),++x>6)break}x>1&&(k["><"]=T.join())}if(k.put&&(C=k.ok)&&(k.ok={"@":(C["@"]||1)-1,"/":C["/"]==k._.near?u.near:C["/"]}),N=O.$put){C={},Object.keys(k).forEach(function(S){C[S]=k[S]}),C.put=":])([:",s(C,function(S,$){if(!S){var U=+new Date;C=$.indexOf('"put":":])([:"'),j(h,$=$.slice(0,C+6)+N+$.slice(C+14)),console.STAT&&console.STAT(U,+new Date-U,"say slice")}});return}s(k,j);function j(S,$){S||(O.raw=$,u.say(k,A))}}}();function v(t){var l=t.batch,p=typeof l=="string";if(p&&(l+="]"),t.batch=t.tail=null,!!l&&!(p?3>l.length:!l.length)){if(!p)try{l=l.length===1?l[0]:JSON.stringify(l)}catch(m){return i.log("DAM JSON stringify error",m)}l&&r(l,t)}}function r(t,l){try{var p=l.wire;l.say?l.say(t):p.send&&p.send(t),u.say.d+=t.length||0,++u.say.c}catch{(l.queue=l.queue||[]).push(t)}}return u.near=0,u.hi=function(t){var l=t.wire,p;if(!l){u.wire(t.length&&{url:t,id:t}||t);return}t.id?i.peers[t.url||t.id]=t:(p=t.id=t.id||t.url||String.random(9),u.say({dam:"?",pid:f.opt.pid},i.peers[p]=t),delete _.s[t.last]),t.met||(u.near++,t.met=+new Date,f.on("hi",t)),p=t.queue,t.queue=[],setTimeout.each(p||[],function(m){r(m,t)},0,9)},u.bye=function(t){t.met&&--u.near,delete t.met,f.on("bye",t);var l=+new Date;l=l-(t.met||l),u.bye.time=((u.bye.time||l)+l)/2},u.hear["!"]=function(t,l){i.log("Error:",t.err)},u.hear["?"]=function(t,l){t.pid&&(l.pid||(l.pid=t.pid),t["@"])||(u.say({dam:"?",pid:i.pid,"@":t["#"]},l),delete _.s[l.last])},u.hear.mob=function(t,l){if(t.peers){var p=Object.keys(t.peers),m=p[Math.random()*p.length>>0];m&&(u.bye(l),u.hi(m))}},f.on("create",function(t){t.opt.pid=t.opt.pid||String.random(9),this.to.next(t),t.on("out",u.say)}),f.on("bye",function(t,l){t=i.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(l=t.wire)&&l.close&&l.close(),delete i.peers[t.id],t.wire=null}),f.on("bye",function(t,l){this.to.next(t),(l=console.STAT)&&(l.peers=u.near),(l=t.url)&&setTimeout(function(){},i.lack||9e3)}),f.on("hi",function(t,l){if(this.to.next(t),(l=console.STAT)&&(l.peers=u.near),!i.super){var p=Object.keys(f.next||"");p.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(p,function(m){var k=f.next[m];if(i.super||(k.ask||"")[""]){u.say({get:{"#":m}},t);return}setTimeout.each(Object.keys(k.ask||""),function(A){A&&u.say({"##":String.hash((f.graph[m]||"")[A]),get:{"#":m,".":A}},t)})})}}),u}var h;try{B.exports=d}catch{}})(b,"./mesh"),b(function(B){var e=b("./index");e.Mesh=b("./mesh"),e.on("opt",function(s){if(this.to.next(s),s.once)return;var d=s.opt;if(d.WebSocket===!1)return;var h=e.window||{},f=d.WebSocket||h.WebSocket||h.webkitWebSocket||h.mozWebSocket;if(!f)return;d.WebSocket=f;var u=d.mesh=d.mesh||e.Mesh(s);u.wire||d.wire,u.wire=d.wire=i;function i(y){try{if(!y||!y.url)return v&&v(y);var c=y.url.replace(/^http/,"ws"),v=y.wire=new d.WebSocket(c);return v.onclose=function(){_(y),d.mesh.bye(y)},v.onerror=function(r){_(y)},v.onopen=function(){d.mesh.hi(y)},v.onmessage=function(r){r&&d.mesh.hear(r.data||r,y)},v}catch{d.mesh.bye(y)}}setTimeout(function(){!d.super&&s.on("out",{dam:"hi"})},1);var w=2*999;function _(y){clearTimeout(y.defer),d.peers[y.url]&&(n&&y.retry<=0||(y.retry=(y.retry||d.retry+1||60)-(-y.tried+(y.tried=+new Date)<w*4?1:0),y.defer=setTimeout(function c(){if(n&&n.hidden)return setTimeout(c,w);i(y)},w)))}var n=""+a!=typeof document&&document});var a})(b,"./websocket"),b(function(B){if(!(typeof Gun>"u")){var e=function(){},a;try{a=(Gun.window||e).localStorage}catch{}a||(Gun.log("Warning: No localStorage exists to persist data to!"),a={setItem:function(d,h){this[d]=h},removeItem:function(d){delete this[d]},getItem:function(d){return this[d]}});var s=JSON.stringifyAsync||function(d,h,f,u){var i;try{h(i,JSON.stringify(d,f,u))}catch(w){h(w)}};Gun.on("create",function d(h){this.to.next(h);var f=h.opt;h.graph;var u=[],i,w,_,n;if(f.localStorage===!1)return;f.prefix=f.file||"gun/";try{i=d[f.prefix]=d[f.prefix]||JSON.parse(_=a.getItem(f.prefix))||{}}catch{i=d[f.prefix]={}}_=(_||"").length,h.on("get",function(c){this.to.next(c);var v=c.get,r,t,l,p;!v||!(r=v["#"])||(t=i[r]||p,t&&(l=v["."])&&!Object.plain(l)&&(t=Gun.state.ify({},l,Gun.state.is(t,l),t[l],r)),Gun.on.get.ack(c,t))}),h.on("put",function(c){this.to.next(c);var v=c.put,r=v["#"],t=v["."],l=c["#"],p=c.ok||"";if(i[r]=Gun.state.ify(i[r],t,v[">"],v[":"],r),n&&_>4999880){h.on("in",{"@":l,err:"localStorage max!"});return}!c["@"]&&(!c._.via||Math.random()<p["@"]/p["/"])&&u.push(l),!w&&(w=setTimeout(y,9+_/333))});function y(){if(!u.length&&((setTimeout.turn||"").s||"").length){setTimeout(y,99);return}var c=u;clearTimeout(w),w=!1,u=[],s(i,function(v,r){try{!v&&a.setItem(f.prefix,r)}catch(t){v=n=t||"localStorage failure"}v&&(Gun.log(v+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),h.on("localStorage:error",{err:v,get:f.prefix,put:i})),_=r.length,setTimeout.each(c,function(t){h.on("in",{"@":t,err:v,ok:0})},0,99)})}})}})(b,"./localStorage")})(),function(){var C;if(""+C!=typeof Gun){var b=function(g){console.warn("Warning! Deprecated internal utility will break in next version:",g)},G=Gun;G.fn=G.fn||{is:function(g){return b("fn"),!!g&&typeof g=="function"}},G.bi=G.bi||{is:function(g){return b("bi"),g instanceof Boolean||typeof g=="boolean"}},G.num=G.num||{is:function(g){return b("num"),!B(g)&&(g-parseFloat(g)+1>=0||g===1/0||g===-1/0)}},G.text=G.text||{is:function(g){return b("text"),typeof g=="string"}},G.text.ify=G.text.ify||function(g){return b("text.ify"),G.text.is(g)?g:typeof JSON<"u"?JSON.stringify(g):g&&g.toString?g.toString():g},G.text.random=G.text.random||function(g,o){b("text.random");var x="";for(g=g||24,o=o||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";g>0;)x+=o.charAt(Math.floor(Math.random()*o.length)),g--;return x},G.text.match=G.text.match||function(g,o){var x,T;return b("text.match"),typeof g!="string"?!1:(typeof o=="string"&&(o={"=":o}),o=o||{},x=o["="]||o["*"]||o[">"]||o["<"],g===x?!0:T!==o["="]?!1:(x=o["*"]||o[">"]||o["<"],g.slice(0,(x||"").length)===x?!0:T!==o["*"]?!1:T!==o[">"]&&T!==o["<"]?g>=o[">"]&&g<=o["<"]:T!==o[">"]&&g>=o[">"]||T!==o["<"]&&g<=o["<"]))},G.text.hash=G.text.hash||function(g,o){if(b("text.hash"),typeof g=="string"){if(o=o||0,!g.length)return o;for(var x=0,T=g.length,E;x<T;++x)E=g.charCodeAt(x),o=(o<<5)-o+E,o|=0;return o}},G.list=G.list||{is:function(g){return b("list"),g instanceof Array}},G.list.slit=G.list.slit||Array.prototype.slice,G.list.sort=G.list.sort||function(g){return b("list.sort"),function(o,x){return!o||!x?0:(o=o[g],x=x[g],o<x?-1:o>x?1:0)}},G.list.map=G.list.map||function(g,o,x){return b("list.map"),O(g,o,x)},G.list.index=1,G.obj=G.boj||{is:function(g){return b("obj"),g?g instanceof Object&&g.constructor===Object||Object.prototype.toString.call(g).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},G.obj.put=G.obj.put||function(g,o,x){return b("obj.put"),(g||{})[o]=x,g},G.obj.has=G.obj.has||function(g,o){return b("obj.has"),g&&Object.prototype.hasOwnProperty.call(g,o)},G.obj.del=G.obj.del||function(g,o){if(b("obj.del"),!!g)return g[o]=null,delete g[o],g},G.obj.as=G.obj.as||function(g,o,x,T){return b("obj.as"),g[o]=g[o]||(T===x?{}:x)},G.obj.ify=G.obj.ify||function(g){if(b("obj.ify"),l(g))return g;try{g=JSON.parse(g)}catch{g={}}return g},function(){var g;function o(x,T){m(this,T)&&g!==this[T]||(this[T]=x)}G.obj.to=G.obj.to||function(x,T){return b("obj.to"),T=T||{},O(x,o,T),T}}(),G.obj.copy=G.obj.copy||function(g){return b("obj.copy"),g&&JSON.parse(JSON.stringify(g))},function(){function g(o,x){var T=this.n,E;if(!(T&&(x===T||l(T)&&m(T,x)))&&E!==x)return!0}G.obj.empty=G.obj.empty||function(o,x){return b("obj.empty"),o?!O(o,g,{n:x}):!0}}(),function(){function g(T,E){if(arguments.length===2){g.r=g.r||{},g.r[T]=E;return}g.r=g.r||[],g.r.push(T)}var o=Object.keys,x;Object.keys=Object.keys||function(T){return x(T,function(E,D,j){j(D)})},G.obj.map=x=G.obj.map||function(T,E,D){b("obj.map");var j,S=0,$,U,I,J,L=typeof E=="function";if(g.r=j,o&&l(T)&&(I=o(T),J=!0),D=D||{},B(T)||I)for($=(I||T).length;S<$;S++){var F=S+G.list.index;if(L){if(U=J?E.call(D,T[I[S]],I[S],g):E.call(D,T[S],F,g),U!==j)return U}else if(E===T[J?I[S]:S])return I?I[S]:F}else for(S in T)if(L){if(m(T,S)&&(U=D?E.call(D,T[S],S,g):E(T[S],S,g),U!==j))return U}else if(E===T[S])return S;return L?g.r:G.list.index?0:-1}}(),G.time=G.time||{},G.time.is=G.time.is||function(g){return b("time"),g?g instanceof Date:+new Date().getTime()};var r=G.fn.is,B=G.list.is,t=G.obj,l=t.is,m=t.has,O=t.map,e={};e.is=function(g){return b("val.is"),g===C?!1:g===null?!0:g===1/0?!1:d(g)||s(g)||n(g)?!0:e.link.is(g)||!1},e.link=e.rel={_:"#"},function(){e.link.is=function(o){if(b("val.link.is"),o&&o[a]&&!o._&&l(o)){var x={};if(O(o,g,x),x.id)return x.id}return!1};function g(o,x){var T=this;if(T.id)return T.id=!1;if(x==a&&d(o))T.id=o;else return T.id=!1}}(),e.link.ify=function(g){return b("val.link.ify"),A({},a,g)},G.obj.has._=".";var a=e.link._,C,s=G.bi.is,n=G.num.is,d=G.text.is,t=G.obj,l=t.is,A=t.put,O=t.map;G.val=G.val||e;var h={_:"_"};h.soul=function(g,o){return b("node.soul"),g&&g._&&g._[o||i]},h.soul.ify=function(g,o){return b("node.soul.ify"),o=typeof o=="string"?{soul:o}:o||{},g=g||{},g._=g._||{},g._[i]=o.soul||g._[i]||u(),g},h.soul._=e.link._,function(){h.is=function(o,x,T){b("node.is");var E;return l(o)&&(E=h.soul(o))?!O(o,g,{as:T,cb:x,s:E,n:o}):!1};function g(o,x){if(x!==h._){if(!e.is(o))return!0;this.cb&&this.cb.call(this.as,o,x,this.n,this.s)}}}(),function(){h.ify=function(o,x,T){return b("node.ify"),x?typeof x=="string"?x={soul:x}:typeof x=="function"&&(x={map:x}):x={},x.map&&(x.node=x.map.call(T,o,C,x.node||{})),(x.node=h.soul.ify(x.node||{},x))&&O(o,g,{o:x,as:T}),x.node};function g(o,x){var T=this.o,E,D;if(T.map){E=T.map.call(this.as,o,""+x,T.node),D===E?p(T.node,x):T.node&&(T.node[x]=E);return}e.is(o)&&(T.node[x]=o)}}();var t=G.obj,l=t.is,p=t.del,O=t.map,f=G.text,u=f.random,i=h.soul._,C;G.node=G.node||h;var w=G.state;w.lex=function(){return b("state.lex"),w().toString(36).replace(".","")},w.to=function(g,o,x){b("state.to");var T=(g||{})[o];return l(T)&&(T=N(T)),w.ify(x,o,w.is(g,o),T,h.soul(g))},function(){w.map=function(o,x,T){b("state.map");var E,D=l(D=o||x)?D:null;return o=r(o=o||x)?o:null,D&&!o?(x=n(x)?x:w(),D[c]=D[c]||{},O(D,g,{o:D,s:x}),D):(T=T||l(x)?x:E,x=n(x)?x:w(),function(j,S,$,U){if(!o)return g.call({o:$,s:x},j,S),j;o.call(T||this||{},j,S,$,U),!(m($,S)&&E===$[S])&&g.call({o:$,s:x},j,S)})};function g(o,x){c!==x&&w.ify(this.o,x,this.s)}}();var t=G.obj;t.as;var m=t.has,l=t.is,O=t.map,N=t.copy,_=G.num,n=_.is,y=G.fn,r=y.is,c=h._,C,v={};(function(){v.is=function(x,T,E,D){return b("graph.is"),!x||!l(x)||k(x)?!1:!O(x,g,{cb:T,fn:E,as:D})};function g(x,T){if(!x||T!==h.soul(x)||!h.is(x,this.fn,this.as))return!0;this.cb&&(o.n=x,o.as=this.as,this.cb.call(o.as,x,T,o))}function o(x){x&&h.is(o.n,x,o.as)}})(),function(){v.ify=function(D,j,S){b("graph.ify");var $={path:[],obj:D};return j?typeof j=="string"?j={soul:j}:typeof j=="function"&&(j.map=j):j={},typeof S=="string"&&(j.soul=j.soul||S,S=C),j.soul&&($.link=e.link.ify(j.soul)),j.shell=(S||{}).shell,j.graph=j.graph||{},j.seen=j.seen||[],j.as=j.as||S,g(j,$),j.root=$.node,j.graph};function g(D,j){var S;return(S=E(D,j))?S:(j.env=D,j.soul=x,h.ify(j.obj,o,j)&&(j.link=j.link||e.link.ify(h.soul(j.node)),j.obj!==D.shell&&(D.graph[e.link.is(j.link)]=j.node)),j)}function o(D,j,S){var $=this,U=$.env,I,J;if(h._===j&&m(D,e.link._))return S._;if(I=T(D,j,S,$,U)){if(j||($.node=$.node||S||{},m(D,h._)&&h.soul(D)&&($.node._=N(D._)),$.node=h.soul.ify($.node,e.link.is($.link)),$.link=$.link||e.link.ify(h.soul($.node))),(J=U.map)&&(J.call(U.as||{},D,j,S,$),m(S,j))){if(D=S[j],C===D){p(S,j);return}if(!(I=T(D,j,S,$,U)))return}if(!j)return $.node;if(I===!0)return D;if(J=g(U,{obj:D,path:$.path.concat(j)}),!!J.node)return J.link}}function x(D){var j=this,S=e.link.is(j.link),$=j.env.graph;j.link=j.link||e.link.ify(D),j.link[e.link._]=D,j.node&&j.node[h._]&&(j.node[h._][e.link._]=D),m($,S)&&($[D]=$[S],p($,S))}function T(D,j,S,$,U){var I;if(e.is(D))return!0;if(l(D))return 1;if(I=U.invalid)return D=I.call(U.as||{},D,j,S),T(D,j,S,$,U);U.err="Invalid value at '"+$.path.concat(j).join(".")+"'!",G.list.is(D)&&(U.err+=" Use `.set(item)` instead of an Array.")}function E(D,j){for(var S=D.seen,$=S.length,U;$--;)if(U=S[$],j.obj===U.obj)return U;S.push(j)}}(),v.node=function(g){b("graph.node");var o=h.soul(g);if(o)return A({},o,g)},function(){v.to=function(o,x,T){if(b("graph.to"),!!o){var E={};return T=T||{seen:{}},O(o[x],g,{obj:E,graph:o,opt:T}),E}};function g(o,x){var T,E;if(h._===x){if(k(o,e.link._))return;this.obj[x]=N(o);return}if(!(T=e.link.is(o))){this.obj[x]=o;return}if(E=this.opt.seen[T]){this.obj[x]=E;return}this.obj[x]=this.opt.seen[T]=v.to(this.graph,T,this.opt)}}();var r=G.fn.is,t=G.obj,l=t.is,p=t.del,m=t.has,k=t.empty,A=t.put,O=t.map,N=t.copy,C;G.graph=G.graph||v}}()}(at)),at.exports}var ct,kt;function Gt(){return kt||(kt=1,ct=ht()),ct}var Nt=Gt();const Ut=Bt(Nt);var ft={exports:{}};ft.exports;var mt;function It(){return mt||(mt=1,function(q){(function(){function b(B,e){return e?At(B):B.slice?b[a(B)]:function(s,d){B(s={exports:{}}),b[a(d)]=s.exports};function a(s){return s.split("/").slice(-1).toString().replace(".js","")}}var G=q;b(function(B){typeof self<"u"&&(B.window=self),typeof window<"u"&&(B.window=window);var e=B.window||B,a,s=e.SEA||{};(s.window=B.window)&&(s.window.SEA=s);try{a+""!=typeof G&&(G.exports=s)}catch{}B.exports=s})(b,"./root"),b(function(B){var e=b("./root");try{e.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(b,"./https"),b(function(B){var e;if(e+""==typeof btoa){if(e+""==typeof Buffer)try{lt.Buffer=b("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}lt.btoa=function(a){return Buffer.from(a,"binary").toString("base64")},lt.atob=function(a){return Buffer.from(a,"base64").toString("binary")}}})(b,"./base64"),b(function(B){b("./base64");function e(){}Object.assign(e,{from:Array.from}),e.prototype=Object.create(Array.prototype),e.prototype.toString=function(a,s,d){a=a||"utf8",s=s||0;const h=this.length;if(a==="hex"){const f=new Uint8Array(this);return[...Array((d&&d+1||h)-s).keys()].map(u=>f[u+s].toString(16).padStart(2,"0")).join("")}if(a==="utf8")return Array.from({length:(d||h)-s},(f,u)=>String.fromCharCode(this[u+s])).join("");if(a==="base64")return btoa(this)},B.exports=e})(b,"./array"),b(function(B){b("./base64");var e=b("./array");function a(...s){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),a.from(...s)}a.prototype=Object.create(Array.prototype),Object.assign(a,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const s=arguments[0];let d;if(typeof s=="string"){const f=arguments[1]||"utf8";if(f==="hex"){const u=s.match(/([\da-fA-F]{2})/g).map(i=>parseInt(i,16));if(!u||!u.length)throw new TypeError("Invalid first argument for type 'hex'.");d=e.from(u)}else if(f==="utf8"||f==="binary"){const u=s.length,i=new Uint16Array(u);Array.from({length:u},(w,_)=>i[_]=s.charCodeAt(_)),d=e.from(i)}else if(f==="base64"){const u=atob(s),i=u.length,w=new Uint8Array(i);Array.from({length:i},(_,n)=>w[n]=u.charCodeAt(n)),d=e.from(w)}else f==="binary"?d=e.from(s):console.info("SafeBuffer.from unknown encoding: "+f);return d}if(s.byteLength,s.byteLength?s.byteLength:s.length){let f;return s instanceof ArrayBuffer&&(f=new Uint8Array(s)),e.from(f||s)}},alloc(s,d=0){return e.from(new Uint8Array(Array.from({length:s},()=>d)))},allocUnsafe(s){return e.from(new Uint8Array(Array.from({length:s})))},concat(s){if(!Array.isArray(s))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return e.from(s.reduce((d,h)=>d.concat(Array.from(h)),[]))}}),a.prototype.from=a.from,a.prototype.toString=e.prototype.toString,B.exports=a})(b,"./buffer"),b(function(B){const e=b("./root"),a={Buffer:b("./buffer")};var s={},d;if(JSON.parseAsync=JSON.parseAsync||function(f,u,i){var w;try{u(w,JSON.parse(f,i))}catch(_){u(_)}},JSON.stringifyAsync=JSON.stringifyAsync||function(f,u,i,w){var _;try{u(_,JSON.stringify(f,i,w))}catch(n){u(n)}},a.parse=function(f,u){return new Promise(function(i,w){JSON.parseAsync(f,function(_,n){_?w(_):i(n)},u)})},a.stringify=function(f,u,i){return new Promise(function(w,_){JSON.stringifyAsync(f,function(n,y){n?_(n):w(y)},u,i)})},e.window&&(a.crypto=e.window.crypto||e.window.msCrypto,a.subtle=(a.crypto||s).subtle||(a.crypto||s).webkitSubtle,a.TextEncoder=e.window.TextEncoder,a.TextDecoder=e.window.TextDecoder,a.random=f=>a.Buffer.from(a.crypto.getRandomValues(new Uint8Array(a.Buffer.alloc(f))))),!a.TextDecoder){const{TextEncoder:f,TextDecoder:u}=b((d+""==typeof G?".":"")+"./lib/text-encoding",1);a.TextDecoder=u,a.TextEncoder=f}if(!a.crypto)try{var h=b("crypto",1);Object.assign(a,{crypto:h,random:u=>a.Buffer.from(h.randomBytes(u))});const{Crypto:f}=b("@peculiar/webcrypto",1);a.ossl=a.subtle=new f({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}B.exports=a})(b,"./shim"),b(function(B){var e=b("./root"),a=b("./shim"),s={};s.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},s.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},s.ecdh={name:"ECDH",namedCurve:"P-256"},s.jwk=function(d,h){d=d.split(".");var f=d[0],u=d[1],i={kty:"EC",crv:"P-256",x:f,y:u,ext:!0};return i.key_ops=h?["sign"]:["verify"],h&&(i.d=h),i},s.keyToJwk=function(d){return{kty:"oct",k:d.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},s.recall={validity:12*60*60,hook:function(d){return d}},s.check=function(d){return typeof d=="string"&&d.slice(0,4)==="SEA{"},s.parse=async function(h){try{var f=typeof h=="string";return f&&h.slice(0,4)==="SEA{"&&(h=h.slice(3)),f?await a.parse(h):h}catch{}return h},e.opt=s,B.exports=s})(b,"./settings"),b(function(B){var e=b("./shim");B.exports=async function(a,s){var d=typeof a=="string"?a:await e.stringify(a),h=await e.subtle.digest({name:s||"SHA-256"},new e.TextEncoder().encode(d));return e.Buffer.from(h)}})(b,"./sha256"),b(function(B){const e=b("./shim"),a=e.subtle,s=e.ossl?e.ossl:a,d=h=>s.digest({name:"SHA-1"},new ArrayBuffer(h));B.exports=d})(b,"./sha1"),b(function(B){var e=b("./root"),a=b("./shim"),s=b("./settings"),d=b("./sha256"),h;e.work=e.work||(async(f,u,i,w)=>{try{var _=(u||{}).epub||u;if(w=w||{},_ instanceof Function&&(i=_,_=h),f=typeof f=="string"?f:await a.stringify(f),(w.name||"").toLowerCase().slice(0,3)==="sha"){var n=a.Buffer.from(await d(f,w.name),"binary").toString(w.encode||"base64");if(i)try{i(n)}catch(r){console.log(r)}return n}_=_||a.random(9);var y=await(a.ossl||a.subtle).importKey("raw",new a.TextEncoder().encode(f),{name:w.name||"PBKDF2"},!1,["deriveBits"]),c=await(a.ossl||a.subtle).deriveBits({name:w.name||"PBKDF2",iterations:w.iterations||s.pbkdf2.iter,salt:new a.TextEncoder().encode(w.salt||_),hash:w.hash||s.pbkdf2.hash},y,w.length||s.pbkdf2.ks*8);f=a.random(f.length);var v=a.Buffer.from(c,"binary").toString(w.encode||"base64");if(i)try{i(v)}catch(r){console.log(r)}return v}catch(r){if(console.log(r),e.err=r,e.throw)throw r;i&&i();return}}),B.exports=e.work})(b,"./work"),b(function(B){var e=b("./root"),a=b("./shim");b("./settings"),e.name=e.name||(async(s,d)=>{try{if(s)try{s()}catch(h){console.log(h)}return}catch(h){if(console.log(h),e.err=h,e.throw)throw h;s&&s();return}}),e.pair=e.pair||(async(s,d)=>{try{var h=a.ossl||a.subtle,f=await a.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async w=>{var _={};_.priv=(await a.subtle.exportKey("jwk",w.privateKey)).d;var n=await a.subtle.exportKey("jwk",w.publicKey);return _.pub=n.x+"."+n.y,_});try{var u=await h.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async w=>{var _={};_.epriv=(await h.exportKey("jwk",w.privateKey)).d;var n=await h.exportKey("jwk",w.publicKey);return _.epub=n.x+"."+n.y,_})}catch(w){if(e.window)throw w;if(w=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw w}u=u||{};var i={pub:f.pub,priv:f.priv,epub:u.epub,epriv:u.epriv};if(s)try{s(i)}catch(w){console.log(w)}return i}catch(w){if(console.log(w),e.err=w,e.throw)throw w;s&&s();return}}),B.exports=e.pair})(b,"./pair"),b(function(B){var e=b("./root"),a=b("./shim"),s=b("./settings"),d=b("./sha256"),h;e.sign=e.sign||(async(f,u,i,w)=>{try{if(w=w||{},!(u||w).priv){if(!e.I)throw"No signing key.";u=await e.I(null,{what:f,how:"sign",why:w.why})}if(h===f)throw"`undefined` not allowed.";var _=await s.parse(f),n=w.check=w.check||_;if(e.verify&&(e.opt.check(n)||n&&n.s&&n.m)&&h!==await e.verify(n,u)){var l=await s.parse(n);if(w.raw||(l="SEA"+await a.stringify(l)),i)try{i(l)}catch(m){console.log(m)}return l}var y=u.pub,c=u.priv,v=s.jwk(y,c),r=await d(_),t=await(a.ossl||a.subtle).importKey("jwk",v,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(p=>(a.ossl||a.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},p,new Uint8Array(r))),l={m:_,s:a.Buffer.from(t,"binary").toString(w.encode||"base64")};if(w.raw||(l="SEA"+await a.stringify(l)),i)try{i(l)}catch(p){console.log(p)}return l}catch(p){if(console.log(p),e.err=p,e.throw)throw p;i&&i();return}}),B.exports=e.sign})(b,"./sign"),b(function(B){var e=b("./root"),a=b("./shim"),s=b("./settings"),d=b("./sha256"),h;e.verify=e.verify||(async(i,w,_,n)=>{try{var y=await s.parse(i);if(w===!1){var c=await s.parse(y.m);if(_)try{_(c)}catch(O){console.log(O)}return c}n=n||{};var v=w.pub||w,r=e.opt.slow_leak?await e.opt.slow_leak(v):await(a.ossl||a.subtle).importKey("jwk",s.jwk(v),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),t=await d(y.m),l,p,m,k;try{if(l=a.Buffer.from(y.s,n.encode||"base64"),p=new Uint8Array(l),m=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},r,p,new Uint8Array(t)),!m)throw"Signature did not match."}catch{if(e.opt.fallback)return await e.opt.fall_verify(i,w,_,n)}var A=m?await s.parse(y.m):h;if(_)try{_(A)}catch(O){console.log(O)}return A}catch(O){if(console.log(O),e.err=O,e.throw)throw O;_&&_();return}}),B.exports=e.verify;var f={};e.opt.slow_leak=i=>{if(f[i])return f[i];var w=s.jwk(i);return f[i]=(a.ossl||a.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),f[i]};var u=e.opt;e.opt.fall_verify=async function(i,w,_,n,y){if(y===e.opt.fallback)throw"Signature did not match";y=y||1;var c=i||"";i=e.opt.unpack(i)||i;var v=await s.parse(i),r=w.pub||w,t=await e.opt.slow_leak(r),l=y<=e.opt.fallback?a.Buffer.from(await a.subtle.digest({name:"SHA-256"},new a.TextEncoder().encode(await s.parse(v.m)))):await d(v.m),p,m,k;try{if(p=a.Buffer.from(v.s,n.encode||"base64"),m=new Uint8Array(p),k=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},t,m,new Uint8Array(l)),!k)throw"Signature did not match."}catch{try{p=a.Buffer.from(v.s,"utf8"),m=new Uint8Array(p),k=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},t,m,new Uint8Array(l))}catch{if(!k)throw"Signature did not match."}}var A=k?await s.parse(v.m):h;if(u.fall_soul=c["#"],u.fall_key=c["."],u.fall_val=i,u.fall_state=c[">"],_)try{_(A)}catch(O){console.log(O)}return A},e.opt.fallback=2})(b,"./verify"),b(function(B){var e=b("./shim"),a=b("./settings"),s=b("./sha256");const d=async(h,f,u)=>{const i=h+(f||e.random(8)).toString("utf8"),w=e.Buffer.from(await s(i),"binary"),_=a.keyToJwk(w);return await e.subtle.importKey("jwk",_,{name:"AES-GCM"},!1,["encrypt","decrypt"])};B.exports=d})(b,"./aeskey"),b(function(B){var e=b("./root"),a=b("./shim");b("./settings");var s=b("./aeskey"),d;e.encrypt=e.encrypt||(async(h,f,u,i)=>{try{i=i||{};var w=(f||i).epriv||f;if(d===h)throw"`undefined` not allowed.";if(!w){if(!e.I)throw"No encryption key.";f=await e.I(null,{what:h,how:"encrypt",why:i.why}),w=f.epriv||f}var _=typeof h=="string"?h:await a.stringify(h),n={s:a.random(9),iv:a.random(15)},y=await s(w,n.s,i).then(v=>a.subtle.encrypt({name:i.name||"AES-GCM",iv:new Uint8Array(n.iv)},v,new a.TextEncoder().encode(_))),c={ct:a.Buffer.from(y,"binary").toString(i.encode||"base64"),iv:n.iv.toString(i.encode||"base64"),s:n.s.toString(i.encode||"base64")};if(i.raw||(c="SEA"+await a.stringify(c)),u)try{u(c)}catch(v){console.log(v)}return c}catch(v){if(console.log(v),e.err=v,e.throw)throw v;u&&u();return}}),B.exports=e.encrypt})(b,"./encrypt"),b(function(B){var e=b("./root"),a=b("./shim"),s=b("./settings"),d=b("./aeskey");e.decrypt=e.decrypt||(async(h,f,u,i)=>{try{i=i||{};var w=(f||i).epriv||f;if(!w){if(!e.I)throw"No decryption key.";f=await e.I(null,{what:h,how:"decrypt",why:i.why}),w=f.epriv||f}var _=await s.parse(h),n,y,c;try{n=a.Buffer.from(_.s,i.encode||"base64"),y=a.Buffer.from(_.iv,i.encode||"base64"),c=a.Buffer.from(_.ct,i.encode||"base64");var v=await d(w,n,i).then(t=>a.subtle.decrypt({name:i.name||"AES-GCM",iv:new Uint8Array(y),tagLength:128},t,new Uint8Array(c)))}catch{if(i.encode==="utf8")throw"Could not decrypt";if(e.opt.fallback)return i.encode="utf8",await e.decrypt(h,f,u,i)}var r=await s.parse(new a.TextDecoder("utf8").decode(v));if(u)try{u(r)}catch(t){console.log(t)}return r}catch(t){if(console.log(t),e.err=t,e.throw)throw t;u&&u();return}}),B.exports=e.decrypt})(b,"./decrypt"),b(function(B){var e=b("./root"),a=b("./shim");b("./settings"),e.secret=e.secret||(async(d,h,f,u)=>{try{if(u=u||{},!h||!h.epriv||!h.epub){if(!e.I)throw"No secret mix.";h=await e.I(null,{what:d,how:"secret",why:u.why})}var i=d.epub||d,w=h.epub,_=h.epriv,n=a.ossl||a.subtle,y=s(i),c=Object.assign({public:await n.importKey(...y,!0,[])},{name:"ECDH",namedCurve:"P-256"}),v=s(w,_),r=await n.importKey(...v,!1,["deriveBits"]).then(async l=>{var p=await n.deriveBits(c,l,256),m=new Uint8Array(p),k=await n.importKey("raw",m,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return n.exportKey("jwk",k).then(({k:A})=>A)}),t=r;if(f)try{f(t)}catch(l){console.log(l)}return t}catch(l){if(console.log(l),e.err=l,e.throw)throw l;f&&f();return}});var s=(d,h)=>{var[f,u]=d.split("."),i=h?{d:h}:{};return["jwk",Object.assign(i,{x:f,y:u,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};B.exports=e.secret})(b,"./secret"),b(function(B){var e=b("./root");e.certify=e.certify||(async(a,s={},d,h,f={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),a=(()=>{var t=[];if(a){if((typeof a=="string"||Array.isArray(a))&&a.indexOf("*")>-1)return"*";if(typeof a=="string")return a;if(Array.isArray(a)){if(a.length===1&&a[0])return typeof a[0]=="object"&&a[0].pub?a[0].pub:typeof a[0]=="string"?a[0]:null;a.map(l=>{typeof l=="string"?t.push(l):typeof l=="object"&&l.pub&&t.push(l.pub)})}return typeof a=="object"&&a.pub?a.pub:t.length>0?t:null}})(),!a)return console.log("No certificant found.");const i=f.expiry&&(typeof f.expiry=="number"||typeof f.expiry=="string")?parseFloat(f.expiry):null,w=(s||{}).read?s.read:null,_=(s||{}).write?s.write:typeof s=="string"||Array.isArray(s)||s["+"]||s["#"]||s["."]||s["="]||s["*"]||s[">"]||s["<"]?s:null,n=(f||{}).block||(f||{}).blacklist||(f||{}).ban||{},y=n.read&&(typeof n.read=="string"||(n.read||{})["#"])?n.read:null,c=typeof n=="string"?n:n.write&&(typeof n.write=="string"||n.write["#"])?n.write:null;if(!w&&!_)return console.log("No policy found.");const v=JSON.stringify({c:a,...i?{e:i}:{},...w?{r:w}:{},..._?{w:_}:{},...y?{rb:y}:{},...c?{wb:c}:{}});var u=await e.sign(v,d,null,{raw:1});if(f.raw||(u="SEA"+JSON.stringify(u)),h)try{h(u)}catch(t){console.log(t)}return u}catch(i){if(e.err=i,e.throw)throw i;h&&h();return}}),B.exports=e.certify})(b,"./certify"),b(function(B){var e=b("./shim"),a=b("./root");a.work=b("./work"),a.sign=b("./sign"),a.verify=b("./verify"),a.encrypt=b("./encrypt"),a.decrypt=b("./decrypt"),a.certify=b("./certify"),a.random=a.random||e.random,a.Buffer=a.Buffer||b("./buffer"),a.keyid=a.keyid||(async s=>{try{const d=e.Buffer.concat(s.replace(/-/g,"+").replace(/_/g,"/").split(".").map(i=>e.Buffer.from(i,"base64"))),h=e.Buffer.concat([e.Buffer.from([153,d.length/256,d.length%256]),d]),f=await sha1hash(h),u=e.Buffer.from(f,"binary");return u.toString("hex",u.length-8)}catch(d){throw console.log(d),d}}),((a.window||{}).GUN||{}).SEA=a,B.exports=a})(b,"./sea"),b(function(B){var e=b("./sea"),a,s;e.window?a=e.window.GUN||{chain:{}}:a=b((s+""==typeof G?".":"")+"./gun",1),e.GUN=a;function d(f){this._={$:this}}d.prototype=function(){function f(){}return f.prototype=a.chain,new f}(),d.prototype.constructor=d,a.chain.user=function(f){var u=this,w=u.back(-1),i;if(f)return f=e.opt.pub((f._||"")["#"])||f,w.get("~"+f);if(i=w.back("user"))return i;var w=w._,_=w,n=_.opt.uuid||h;return(_=(i=_.user=u.chain(new d))._).opt={},_.opt.uuid=function(y){var c=n(),v=w.user;return!v||!(v=v.is)||!(v=v.pub)||(c="~"+v+"/"+c,y&&y.call&&y(null,c)),c},i};function h(){return a.state().toString(36).replace(".","")}a.User=d,d.GUN=a,d.SEA=a.SEA=e,B.exports=d})(b,"./user"),b(function(B){var e,a=""+e!=typeof GUN?GUN||{chain:{}}:b((""+e==typeof G?".":"")+"./gun",1);a.chain.then=function(s,d){var h=this,f=new Promise(function(u,i){h.once(u,d)});return s?f.then(s):f}})(b,"./then"),b(function(B){var e=b("./user"),a=e.SEA,s=e.GUN,d=function(){};e.prototype.create=function(...h){var f=typeof h[0]=="object"&&(h[0].pub||h[0].epub)?h[0]:typeof h[1]=="object"&&(h[1].pub||h[1].epub)?h[1]:null,u=f&&(f.pub||f.epub)?f.pub:typeof h[0]=="string"?h[0]:null,i=f&&(f.pub||f.epub)?f:u&&typeof h[1]=="string"?h[1]:null,w=h.filter(t=>typeof t=="function")[0]||null,_=h&&h.length>1&&typeof h[h.length-1]=="object"?h[h.length-1]:{},n=this,y=n._,c=n.back(-1);if(w=w||d,_=_||{},_.check!==!1){var v;if(u||(v="No user."),(i||"").length<8&&(v="Password too short!"),v)return w({err:s.log(v)}),n}if(y.ing)return(w||d)({err:s.log("User is already being created or authenticated!"),wait:!0}),n;y.ing=!0;var r={};return r.a=function(t){if(r.pubs=t,t&&!_.already){var l={err:s.log("User already created!")};y.ing=!1,(w||d)(l),n.leave();return}r.salt=String.random(64),a.work(i,r.salt,r.b)},r.b=function(t){r.proof=t,f?r.c(f):a.pair(r.c)},r.c=function(t){var l;r.pair=t||{},(l=y.root.user)&&(l._.sea=t,l.is={pub:t.pub,epub:t.epub,alias:u}),r.data={pub:t.pub},r.d()},r.d=function(){r.data.alias=u,r.e()},r.e=function(){r.data.epub=r.pair.epub,a.encrypt({priv:r.pair.priv,epriv:r.pair.epriv},r.proof,r.f,{raw:1})},r.f=function(t){r.data.auth=JSON.stringify({ek:t,s:r.salt}),r.g(r.data.auth)},r.g=function(t){var l;r.data.auth=r.data.auth||t,c.get(l="~"+r.pair.pub).put(r.data).on(r.h);var p={};p[l]={"#":l},c.get("~@"+u).put(p).get(l).on(r.i)},r.h=function(t,l,p,m){m.off(),r.h.ok=1,r.i()},r.i=function(t,l,p,m){m&&(r.i.ok=1,m.off()),!(!r.h.ok||!r.i.ok)&&(y.ing=!1,w({ok:0,pub:r.pair.pub}),d===w&&(f?n.auth(f):n.auth(u,i)))},c.get("~@"+u).once(r.a),n},e.prototype.leave=function(h,f){var u=this,i=u.back(-1)._.user;if(i&&(delete i.is,delete i._.is,delete i._.sea),a.window)try{var w={};w=a.window.sessionStorage,delete w.recall,delete w.pair}catch{}return u}})(b,"./create"),b(function(B){var e=b("./user"),a=e.SEA,s=e.GUN,d=function(){};e.prototype.auth=function(...f){var u=typeof f[0]=="object"&&(f[0].pub||f[0].epub)?f[0]:typeof f[1]=="object"&&(f[1].pub||f[1].epub)?f[1]:null,i=!u&&typeof f[0]=="string"?f[0]:null,w=(i||u&&!(u.priv&&u.epriv))&&typeof f[1]=="string"?f[1]:null,_=f.filter(p=>typeof p=="function")[0]||null,n=f&&f.length>1&&typeof f[f.length-1]=="object"?f[f.length-1]:{},y=this,c=y._,v=y.back(-1);if(c.ing)return(_||d)({err:s.log("User is already being created or authenticated!"),wait:!0}),y;c.ing=!0;var r={},t,l=9;return r.a=function(p){if(!p)return r.b();if(!p.pub){var m=[];return Object.keys(p).forEach(function(k){k!="_"&&m.push(p[k])}),r.b(m)}if(r.name)return r.f(p);r.c((r.data=p).auth)},r.b=function(p){var m=(r.list=(r.list||[]).concat(p||[])).shift();if(t===m){if(r.name)return r.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(i&&l--){v.get("~@"+i).once(r.a);return}return r.err("Wrong user or password.")}v.get(m).once(r.a)},r.c=function(p){if(t===p)return r.b();if(typeof p=="string")return r.c(h(p));a.work(w,(r.auth=p).s,r.d,r.enc)},r.d=function(p){a.decrypt(r.auth.ek,p,r.e,r.enc)},r.e=function(p){if(t===p)return r.enc?(r.enc=null,r.b()):(r.enc={encode:"utf8"},r.c(r.auth));r.half=p,r.f(r.data)},r.f=function(p){var m=r.half||{},k=r.data||{};r.g(r.lol={pub:p.pub||k.pub,epub:p.epub||k.epub,priv:p.priv||m.priv,epriv:p.epriv||m.epriv})},r.g=function(p){if(!p||!p.pub||!p.epub)return r.b();r.pair=p;var m=v._.user,k=m._;k.tag;var A=k.opt;k=m._=v.get("~"+p.pub)._,k.opt=A,m.is={pub:p.pub,epub:p.epub,alias:i||p.pub},k.sea=r.pair,c.ing=!1;try{w&&t==(h(c.root.graph["~"+p.pub].auth)||"")[":"]&&(n.shuffle=n.change=w)}catch{}if(n.change?r.z():(_||d)(k),a.window&&(y.back("user")._.opt||n).remember)try{var O={};O=a.window.sessionStorage,O.recall=!0,O.pair=JSON.stringify(p)}catch{}try{v._.tag.auth?v._.on("auth",k):setTimeout(function(){v._.on("auth",k)},1)}catch(N){s.log("Your 'auth' callback crashed with:",N)}},r.h=function(p){if(!p)return r.b();if(i=p.alias,i||(i=p.alias="~"+u.pub),!p.auth)return r.g(u);u=null,r.c((r.data=p).auth)},r.z=function(){r.salt=String.random(64),a.work(n.change,r.salt,r.y)},r.y=function(p){a.encrypt({priv:r.pair.priv,epriv:r.pair.epriv},p,r.x,{raw:1})},r.x=function(p){r.w(JSON.stringify({ek:p,s:r.salt}))},r.w=function(p){if(n.shuffle){console.log("migrate core account from UTF8 & shuffle");var m={};Object.keys(r.data).forEach(function(k){m[k]=r.data[k]}),delete m._,m.auth=p,v.get("~"+r.pair.pub).put(m)}v.get("~"+r.pair.pub).get("auth").put(p,_||d)},r.err=function(p){var m={err:s.log(p||"User cannot be found!")};c.ing=!1,(_||d)(m)},r.plugin=function(p){if(!(r.name=p))return r.err();var m=[p];p[0]!=="~"&&(m[1]="~"+p,m[2]="~@"+p),r.b(m)},u?u.priv&&u.epriv?r.g(u):v.get("~"+u.pub).once(r.h):i?v.get("~@"+i).once(r.a):!i&&!w&&a.name(r.plugin),y};function h(f){if(typeof f!="string")return f;try{f=JSON.parse(f)}catch{f={}}return f}})(b,"./auth"),b(function(B){var e=b("./user"),a=e.SEA;e.GUN,e.prototype.recall=function(s,d){var h=this,f=h.back(-1);if(s=s||{},s&&s.sessionStorage){if(a.window)try{var u={};u=a.window.sessionStorage,u&&(f._.opt.remember=!0,(h.back("user")._.opt||s).remember=!0,(u.recall||u.pair)&&f.user().auth(JSON.parse(u.pair),d))}catch{}return h}return h}})(b,"./recall"),b(function(B){var e=b("./user"),a=e.SEA,s=e.GUN,d=function(){};e.prototype.pair=function(){var h=this,f;try{f=new Proxy({DANGER:"☠"},{get:function(u,i,w){if(!(!h.is||!(h._||"").sea))return h._.sea[i]}})}catch{}return f},e.prototype.delete=async function(h,f,u){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var i=this;i.back(-1);var w=i.back("user");try{w.auth(h,f,function(_){var n=(w.is||{}).pub;w.map().once(function(){this.put(null)}),w.leave(),(u||d)({ok:0})})}catch(_){s.log("User.delete failed! Error:",_)}return i},e.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const h=this.back(-1);try{return await authRecall(h),h._.user._}catch{const u="No session!";throw s.log(u),{err:u}}},e.prototype.trust=async function(h){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),s.is(h)&&h.get("pub").get((f,u)=>{console.log(f,u)}),h.get("trust").get(path).put(theirPubkey)},e.prototype.grant=function(h,f){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var u=this,i=u.back(-1).user(),w=i._.sea,_="";return u.back(function(n){n.is||(_+=n.get||"")}),async function(){var n,y=await i.get("grant").get(w.pub).get(_).then();y=await a.decrypt(y,w),y||(y=a.random(16).toString(),n=await a.encrypt(y,w),i.get("grant").get(w.pub).get(_).put(n));var c=h.get("pub").then(),v=h.get("epub").then();c=await c,v=await v;var r=await a.secret(v,w);n=await a.encrypt(y,r),i.get("grant").get(c).get(_).put(n,f)}(),u},e.prototype.secret=function(h,f){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var u=this,i=u.back(-1).user(),w=i.pair(),_="";return u.back(function(n){n.is||(_+=n.get||"")}),async function(){var n,y=await i.get("trust").get(w.pub).get(_).then();y=await a.decrypt(y,w),y||(y=a.random(16).toString(),n=await a.encrypt(y,w),i.get("trust").get(w.pub).get(_).put(n)),n=await a.encrypt(h,y),u.put(n,f)}(),u},B.exports=e})(b,"./share"),b(function(B){var e=b("./sea"),a=b("./settings"),s,d=(e.window||"").GUN||b((""+s==typeof G?".":"")+"./gun",1);d.on("opt",function(n){n.sea||(n.sea={own:{}},n.on("put",h,n)),this.to.next(n)});function h(n){var y=this,c=y.as,v=n.put,r=v["#"],t=v["."],l=v[":"],p=v[">"],m=n["#"],k;if(!(!r||!t)){if((n._||"").faith&&(c.opt||"").faith&&typeof n._=="function"){e.opt.pack(v,function(O){e.verify(O,!1,function(N){v["="]=e.opt.unpack(N),y.to.next(n)})});return}var A=function(O){c.on("in",{"@":m,err:n.err=O})};if((n._||"").DBG&&((n._||"").DBG.c=+new Date),0<=r.indexOf("<?")&&(k=parseFloat(r.split("<?")[1]||""),k&&p<d.state()-k*1e3)){(k=n._)&&k.stun&&k.stun--;return}if(r==="~@"){h.alias(y,n,l,t,r,c,A);return}if(r.slice(0,2)==="~@"){h.pubs(y,n,l,t,r,c,A);return}if(k=e.opt.pub(r)){h.pub(y,n,l,t,r,c,A,c.user||"",k);return}if(0<=r.indexOf("#")){h.hash(y,n,l,t,r,c,A);return}h.any(y,n,l,t,r,c,A,c.user||"")}}h.hash=function(n,y,c,v,r,t,l){e.work(c,null,function(p){function m(k){let A="";for(let O=0;O<k.length;O++)A+=O-1&1?"":String.fromCharCode(parseInt(k.substring(O-1,O+1),16));return btoa(A)}if(p&&p===v.split("#").slice(-1)[0])return n.to.next(y);if(p&&p===m(v.split("#").slice(-1)[0]))return n.to.next(y);l("Data hash not same as hash!")},{name:"SHA-256"})},h.alias=function(n,y,c,v,r,t,l){if(!c)return l("Data must exist!");if("~@"+v===u(c))return n.to.next(y);l("Alias not same!")},h.pubs=function(n,y,c,v,r,t,l){if(!c)return l("Alias must exist!");if(v===u(c))return n.to.next(y);l("Alias not same!")},h.pub=async function(n,y,c,v,r,t,l,p,m){var k;const A=await a.parse(c)||{},O=(N,C,g)=>{if(N.m&&N.s&&C&&m)return e.verify(N,m,o=>{if(s!==o&&s!==o.e&&y.put[">"]&&y.put[">"]>parseFloat(o.e))return l("Certificate expired.");if(s!==o&&o.c&&o.w&&(o.c===C||o.c.indexOf("*")>-1)){let T=r.indexOf("/")>-1?r.replace(r.substring(0,r.indexOf("/")+1),""):"";String.match=String.match||d.text.match;const E=Array.isArray(o.w)?o.w:typeof o.w=="object"||typeof o.w=="string"?[o.w]:[];for(const D of E)if(String.match(T,D["#"])&&String.match(v,D["."])||!D["."]&&String.match(T,D["#"])||!D["#"]&&String.match(v,D["."])||String.match(T?T+"/"+v:v,D["#"]||D)){if(D["+"]&&D["+"].indexOf("*")>-1&&T&&T.indexOf(C)==-1&&v.indexOf(C)==-1)return l(`Path "${T}" or key "${v}" must contain string "${C}".`);if(o.wb&&(typeof o.wb=="string"||(o.wb||{})["#"])){var x=n.as.root.$.back(-1);return typeof o.wb=="string"&&o.wb.slice(0,1)!=="~"&&(x=x.get("~"+m)),x.get(o.wb).get(C).once(j=>j&&(j===1||j===!0)?l(`Certificant ${C} blocked.`):g(o))}return g(o)}return l("Certificate verification fail.")}})};if(v==="pub"&&"~"+m===r)return c===m?n.to.next(y):l("Account not same!");if((k=p.is)&&k.pub&&!A["*"]&&!A["+"]&&(m===k.pub||m!==k.pub&&((y._.msg||{}).opt||{}).cert)){e.opt.pack(y.put,N=>{e.sign(N,p._.sea,async function(C){if(s===C)return l(e.err||"Signature fail.");if(y.put[":"]={":":k=e.opt.unpack(C.m),"~":C.s},y.put["="]=k,m===p.is.pub){(k=u(c))&&((t.sea.own[k]=t.sea.own[k]||{})[m]=1),JSON.stringifyAsync(y.put[":"],function(g,o){return g?l(g||"Stringify error."):(y.put[":"]=o,n.to.next(y))});return}if(m!==p.is.pub&&((y._.msg||{}).opt||{}).cert){const g=await a.parse(y._.msg.opt.cert);g&&g.m&&g.s&&O(g,p.is.pub,o=>{y.put[":"]["+"]=g,y.put[":"]["*"]=p.is.pub,JSON.stringifyAsync(y.put[":"],function(x,T){return x?l(x||"Stringify error."):(y.put[":"]=T,n.to.next(y))})})}},{raw:1})});return}e.opt.pack(y.put,N=>{e.verify(N,A["*"]||m,function(C){var g;if(C=e.opt.unpack(C),s===C)return l("Unverified data.");if((g=u(C))&&m===e.opt.pub(g)&&((t.sea.own[g]=t.sea.own[g]||{})[m]=1),A["+"]&&A["+"].m&&A["+"].s&&A["*"])O(A["+"],A["*"],o=>(y.put["="]=C,n.to.next(y)));else return y.put["="]=C,n.to.next(y)})})},h.any=function(n,y,c,v,r,t,l,p){if(t.opt.secure)return l("Soul missing public key at '"+v+"'.");t.on("secure",function(m){if(this.off(),!t.opt.secure)return n.to.next(m);l("Data cannot be changed.")}).on.on("secure",y)};var f=d.valid,u=function(n,y){return typeof(y=f(n))=="string"&&y};(d.state||"").ify;var i=/[^\w_-]/;e.opt.pub=function(n){if(n&&(n=n.split("~"),!(!n||!(n=n[1]))&&(n=n.split(i).slice(0,2),!(!n||n.length!=2)&&(n[0]||"")[0]!=="@")))return n=n.slice(0,2).join("."),n},e.opt.stringy=function(n){},e.opt.pack=function(n,y,c,v,r){var t,l;if(e.opt.check(n))return y(n);n&&n["#"]&&n["."]&&n[">"]&&(t=n[":"],l=1),JSON.parseAsync(l?t:n,function(p,m){var k=s!==(m||"")[":"]&&(m||"")["~"];if(!k){y(n);return}y({m:{"#":r||n["#"],".":c||n["."],":":(m||"")[":"],">":n[">"]||d.state.is(v,c)},s:k})})};var w=e.opt;e.opt.unpack=function(n,y,c){var v;if(s!==n){if(n&&s!==(v=n[":"]))return v;if(y=y||w.fall_key,!c&&w.fall_val&&(c={},c[y]=w.fall_val),!(!y||!c)){if(n===c[y]||!e.opt.check(c[y]))return n;var r=c&&c._&&c._["#"]||w.fall_soul,t=d.state.is(c,y)||w.fall_state;if(n&&n.length===4&&r===n[0]&&y===n[1]&&_(t)===_(n[3]))return n[2];if(t<e.opt.shuffle_attack)return n}}},e.opt.shuffle_attack=15463296e5;var _=Math.floor})(b,"./index")})()}(ft)),ft.exports}It();var pt={exports:{}},xt={},_t;function Pt(){if(_t)return xt;_t=1;var q={},b=typeof window<"u"?window.Gun:ht(),G;b.on("opt",function(e){B(e),this.to.next(e)});function B(e){if(e.axe)return;var a=e.opt;if(a.peers,a.axe===!1||typeof process<"u"&&""+(q||"").AXE=="false")return;b.log.once("AXE","AXE relay enabled!");var s=e.axe={},d=a.mesh=a.mesh||b.Mesh(e),h=e.dup;d.way=function(c){if(c){if(c.get)return f(c);c.put||u(c)}};function f(c){if(c){var v=(c._||"").via,r;if(!v||!v.id||!(r=i(c)._))return u(c);r.asked=+new Date,f.turn(c,r.route,0)}}f.turn=function(c,v,r){var t=c["#"],l=h.s[t],p;if(!(!t||!l)&&(clearTimeout(l.lack),!(l.ack&&(t=l["##"])&&c["##"]===t))){if(p=Object.maps(v||a.peers).slice(r=r||0),!p.length){if(!v)return;f.turn(c,G,0);return}setTimeout.each(p,function(m){var k=a.peers[m];if(r++,!k||!k.wire){v&&v.delete(m);return}if(d.say(c,k)!==!1&&r%3==0)return 1},function(){l["##"]=c["##"],l.lack=setTimeout(function(){f.turn(c,v,r)},25)},3)}};function u(c){d.say(c,a.peers)}function i(c){var v="",r,t,l;if(!c||!c.get)return v;typeof(r=c.get["#"])=="string"&&(v=e.$.get(r)),typeof(l=c.get["."])=="string"?t=l:t="";var p=(c._||"").via,m=p.sub||(p.sub=new Object.Map);return(m.get(r)||m.set(r,l=new Object.Map)&&l).set(t,1),p.id&&v._&&(v._.route||(v._.route=new Object.Map)).set(p.id,p),v}function w(c){return(c=c||"")["="]||c["*"]||c[">"]||c}e.on("in",function(c){var v=this.to,r;if((r=c["@"])&&(r=h.s[r])){if(r.ack=(r.ack||0)+1,r.it&&r.it.get&&c.put){var t=r.it.get||"",l=i(r.it)._,p=(r.it._||"").via||"",m;if(p&&l&&(p.id&&(l.route||(l.route=new Object.Map)).set(p.id,p),m=p.sub||(p.sub=new Object.Map),l&&(m.get(w(t["#"]))||m.set(w(t["#"]),m=new Object.Map)&&m).set(w(t["."]),1),p=(c._||"").via||"",p&&(p.id&&(l.route||(l.route=new Object.Map)).set(p.id,p),m=p.sub||(p.sub=new Object.Map),l))){var k=w(t["#"]),A=m.get(k),O=w(t["."]);O?(A||m.set(k,A=new Object.Map)&&A).set(O,1):A||(m.set(k,A=new Object.Map),A.set("",1))}}if(r=r.back){setTimeout.each(Object.keys(r),function(N){v.next({"#":c["#"],"@":N,ok:c.ok})});return}}v.next(c)}),e.on("create",function(c){this.to.next(c),c.on("put",function(v){var r=this;r.as;var t=v.put,l=t["#"],p=t["."],m=t[":"],k=t[">"];if(r.to.next(v),!v["@"]&&!(!l||!p)){var A=c.$.get(l)._,O=(A||"").route;if(O){if(A.skip&&A.skip.has==p){A.skip.now=v["#"];return}(A.skip={now:v["#"],has:p}).to=setTimeout(function(){setTimeout.each(Object.maps(O),function(N){var C,E,g=A.skip||"";if(A.skip=null,!!(C=O.get(N))){if(!C.wire){O.delete(N);return}var o=(C.sub||(C.sub=new Object.Map)).get(l);if(o&&!(!o.get(p)&&!o.get(""))){var x=C.put||(C.put={}),T=c.graph[l],E;T&&G!==(E=T[p])&&(k=y(T,p),m=E),x[l]=n(x[l],p,k,m,l),E=h.track(C.next=C.next||String.random(9)),(E.back||(E.back={}))[""+(g.now||v["#"])]=1,!C.to&&(C.to=setTimeout(function(){_(C)},a.gap))}}})},9)}}})});function _(c){var v={"#":c.next,put:c.put,ok:{"@":3,"/":d.near}};c.next=c.put=c.to=null,d.say(v,c)}var n=b.state.ify,y=b.state.is;(function(){s.up={};var c=d.hear["?"];d.hear["?"]=function(v,r){var t;if(c(v,r),!!r.pid){if(r.pid===a.pid){d.bye(r);return}if(t=s.up[r.pid]){if(t===r)return;a.pid>r.pid&&(t=r,r=s.up[t.pid]),t.url=t.url||r.url,d.bye(r),s.up[t.pid]=t;return}r.url&&(s.up[r.pid]=r,s.stay&&s.stay())}},d.hear.opt=function(v,r){if(!v.ok){var t=v.opt;t&&(t=t.peers,!(!t||typeof t!="string")&&(99<=Object.keys(s.up).length||(d.hi({id:t,url:t,retry:9}),r&&d.say({dam:"opt",ok:1,"@":v["#"]},r))))}},s.stay=function(){clearTimeout(s.stay.to),s.stay.to=setTimeout(function(v,r){(v=e.stats&&e.stats.stay)&&(r={},Object.keys(s.up||"").forEach(function(t){t=(s.up||"")[t],t.url&&(r[t.url]={})}),(v.axe=v.axe||{}).up=r)},1e3*9)},setTimeout(function(v){(v=e.stats&&e.stats.stay&&e.stats.stay.axe)&&(v=v.up)&&(v instanceof Array||(v=Object.keys(v)),setTimeout.each(v||[],function(r){d.hear.opt({opt:{peers:r}})}))},1e3)})(),function(){a.mob=a.mob||9900,e.on("hi",function(c){if(this.to.next(c),!c.url){var v=d.near;if(!(a.mob>=v)){var r={};Object.keys(s.up).forEach(function(t){t=s.up[t],t.url&&(r[t.url]={})}),d.say({dam:"mob",mob:v,peers:r},c),setTimeout(function(){d.bye(c)},9)}}}),e.on("bye",function(c){this.to.next(c)})}()}return function(){var e=Array.from;if(Object.maps=function(a){return e&&a instanceof Map?e(a.keys()):(a instanceof Object.Map&&(a=a.s),Object.keys(a))},e)return Object.Map=Map;(Object.Map=function(){this.s={}}).prototype={set:function(a,s){return this.s[a]=s,this},get:function(a){return this.s[a]},delete:function(a){delete this.s[a]}}}(),xt}var St;function Mt(){return St||(St=1,function(q){(function(){var b=setTimeout||{},G;typeof window!=""+G&&(b.window=window);var B=(b.window||"").AXE||function(){};(B.window=b.window)&&(B.window.AXE=B);var e=(B.window||"").GUN||ht();(e.AXE=B).GUN=B.Gun=e,e.window||Pt(),e.on("opt",function(s){a(s),this.to.next(s)});function a(s){if(s.axe)return;var d=s.opt,h=d.peers;if(d.axe===!1||!e.window)return;var f=e.window,u=f.localStorage||d.localStorage||{},i=f.location||d.location||{},w=f.navigator||d.navigator||{},_=s.axe={},n,y,c=d.mesh=d.mesh||e.Mesh(s);n=h[y=i.origin+"/gun"]=h[y]||{},n.id=n.url=y,n.retry=n.retry||0,n=h[y="http://localhost:8765/gun"]=h[y]||{},n.id=n.url=y,n.retry=n.retry||0,e.log.once("AXE","AXE enabled: Trying to find network via (1) local peer (2) last used peers (3) a URL parameter, and last (4) hard coded peers."),e.log.once("AXEWarn","Warning: AXE is in alpha, use only for testing!");var v=u.peers||"";v&&(v+=" "),v+=((i.search||"").split("peers=")[1]||"").split("&")[0],s.on("bye",function(t){this.to.next(t),t.url&&(w.onLine||(t.retry=1),!t.retry&&(_.fall&&delete _.fall[t.url||t.id],function l(){if(!_.fall){setTimeout(l,9);return}var p=Object.keys(_.fall||""),m=p[Math.random()*p.length>>0];if(p.length||(u.peers="",m="https://gunjs.herokuapp.com/gun"),h[m]){l();return}c.hi(m)}()))}),s.on("hi",function(t){this.to.next(t),t.url});function r(t){_.fall={},((t||"").match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/ig)||[]).forEach(function(l){_.fall[l]={url:l,id:l,retry:0}})}if(v){r(v);return}try{fetch(((i.search||"").split("axe=")[1]||"").split("&")[0]||i.axe||"https://raw.githubusercontent.com/wiki/amark/gun/volunteer.dht.md").then(function(t){return t.text()}).then(function(t){r(u.peers=t)}).catch(function(){r()})}catch{r()}}try{""+G!="object"&&(q.exports=B)}catch{}})()}(pt)),pt.exports}Mt();const Jt={style:{border:"1px solid #aaa","margin-bottom":"16px",padding:"8px"}},Rt={style:{"margin-top":"8px",color:"blue"}},Lt={style:{border:"1px solid #aaa","margin-bottom":"16px",padding:"8px"}},Vt={key:0,style:{"margin-top":"8px",color:"green"}},Kt={key:1,style:{color:"red"}},Ht={style:{border:"1px solid #aaa","margin-bottom":"16px",padding:"8px"}},qt={style:{"margin-top":"8px"}},Ft={style:{border:"1px solid #aaa","margin-bottom":"16px",padding:"8px"}},Wt={style:{border:"1px solid #aaa",padding:"8px"}},Xt={key:0},zt={style:{"margin-top":"8px",border:"1px solid #ccc",padding:"8px","max-height":"150px",overflow:"auto"}},Yt={key:0},Zt={key:1},te=jt({__name:"test",setup(q){console.log("[GunUserFullDemo] Starting integrated test...");const b=["https://peer.wallie.io/gun"],G=Ut({peers:b,localStorage:!0});console.log("[GunUserFullDemo] GUN instance created with peers:",b);const B=G.user(),e=H(""),a=H(""),s=H(""),d=H(""),h=H(""),f=H(!1),u=H(null),i=H(null),w=H(null),_=H(""),n=H(""),y=H(""),c=H(""),v=H([]),r=H(null),t=H(null),l=H(""),p=H([]);let m=null;function k(){const j=e.value.trim(),S=a.value;if(console.log("[onRegister] Attempting to register:",j),!j||!S){s.value="请填写用户名和密码";return}B.create(j,S,$=>{var U;if(console.log("[onRegister] Registration ack:",$),"err"in $)s.value="注册失败: "+$.err;else{s.value="注册成功! 请使用相同的用户名和密码登录",e.value="",a.value="";const I=(U=B.is)==null?void 0:U.pub;I&&G.get("users").get(I).put({alias:j},J=>{J.err?console.error("[onRegister] Error saving user alias:",J.err):console.log("[onRegister] User alias saved successfully")})}})}function A(){const j=d.value.trim(),S=h.value;if(console.log("[onLogin] Attempting to login:",j),!j||!S){w.value="请填写用户名和密码";return}B.auth(j,S,$=>{console.log("[onLogin] Login ack:",$),"err"in $?(f.value=!1,u.value=null,i.value=null,w.value=$.err):(f.value=!0,u.value=j,w.value=null,B.is&&B.is.pub?(i.value=B.is.pub,console.log("[onLogin] Current user pubKey:",B.is.pub)):$.pub?(i.value=$.pub,console.log("[onLogin] Current user pubKey from ack:",$.pub)):(i.value="(未知公钥)",console.warn("[onLogin] 无法获取当前用户的公钥")),i.value&&G.get("users").get(i.value).once(U=>{U&&U.alias?u.value=U.alias:console.warn("[onLogin] 用户名未找到")}),g())})}function O(){console.log("[onLogout] Logging out"),B.leave(),f.value=!1,u.value=null,i.value=null,v.value=[],r.value=null,t.value=null,p.value=[],w.value=null,alert("已退出")}function N(){const j=_.value,S=n.value;if(console.log("[onChangePassword] Attempting to change password"),!j||!S){y.value="请填写旧密码和新密码";return}B.change(j,S,$=>{console.log("[onChangePassword] Change password ack:",$),$.err?y.value="修改密码失败: "+$.err:(y.value="密码修改成功! 请使用新密码重新登录",_.value="",n.value="")})}function C(){const j=c.value.trim();if(console.log("[addBuddy] Attempting to add buddy with pubKey:",j),!f.value){alert("请先登录");return}if(!j){alert("请填写好友的公钥");return}B.get("buddy").get(j).put(!0,S=>{console.log("[addBuddy] Add buddy ack:",S),S.err?alert("添加好友失败: "+S.err):(alert("已添加好友: "+j),c.value="",G.get("users").get(j).once($=>{$&&$.alias?v.value.some(I=>I.pub===j)||v.value.push({alias:$.alias,pub:j}):(v.value.some(I=>I.pub===j)||v.value.push({alias:"(未知)",pub:j}),console.warn("[addBuddy] 好友用户名未找到"))}))})}function g(){console.log("[listenBuddyList] Listening to buddy list updates"),v.value=[],B.get("buddy").map().on((j,S)=>{console.log("[buddyList map.on] val=",j,"key=",S),j?G.get("users").get(S).once($=>{$&&$.alias?v.value.some(I=>I.pub===S)||v.value.push({alias:$.alias,pub:S}):(v.value.some(I=>I.pub===S)||v.value.push({alias:"(未知)",pub:S}),console.warn("[listenBuddyList] 好友用户名未找到 for pubKey:",S))}):v.value=v.value.filter($=>$.pub!==S)})}function o(j){console.log("[openChat] Opening chat with pubKey:",j),r.value=j;const S=v.value.find($=>$.pub===j);S?t.value=S.alias:t.value="(未知)",p.value=[],x(j)}function x(j){console.log("[listenChat] Listening to chat with:",j),m&&m.off&&m.off();const S=E(i.value,j);console.log("[listenChat] chatId:",S),m=G.get("chats").get(S).map().on(($,U)=>{console.log("[listenChat] New message:",$,"msgId:",U),$&&p.value.push($)})}function T(){if(!r.value){alert("未选择好友");return}const j=l.value.trim();if(!j){alert("消息不能为空");return}const S=E(i.value,r.value),$={from:i.value||"未知",text:j,timestamp:Date.now()};console.log("[sendChat] Sending message:",$),G.get("chats").get(S).set($,U=>{U.err?(console.error("[sendChat] 发送失败:",U.err),alert("发送失败: "+U.err)):(console.log("[sendChat] 发送成功"),p.value.push($),l.value="")})}function E(j,S){return j?j<S?`${j}_${S}`:`${S}_${j}`:(console.warn("[generateChatId] pubA is null, using pubB only"),S)}function D(j){const S=v.value.find($=>$.pub===j);return S?S.alias:null}return(j,S)=>(z(),vt(P(Ct),null,{default:R(()=>[M(P(Tt),null,{default:R(()=>[M(P(Ot),null,{default:R(()=>[M(P($t),null,{default:R(()=>S[8]||(S[8]=[K("GUN 用户与好友管理 + 聊天")])),_:1})]),_:1})]),_:1}),M(P(Dt),{style:{padding:"16px"}},{default:R(()=>[V("div",Jt,[S[12]||(S[12]=V("h3",null,"注册 (user.create)",-1)),M(P(Y),null,{default:R(()=>[M(P(Z),{position:"floating"},{default:R(()=>S[9]||(S[9]=[K("Alias (用户名)")])),_:1}),M(P(tt),{modelValue:e.value,"onUpdate:modelValue":S[0]||(S[0]=$=>e.value=$),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),M(P(Y),null,{default:R(()=>[M(P(Z),{position:"floating"},{default:R(()=>S[10]||(S[10]=[K("Password (密码)")])),_:1}),M(P(tt),{type:"password",modelValue:a.value,"onUpdate:modelValue":S[1]||(S[1]=$=>a.value=$),placeholder:"密码"},null,8,["modelValue"])]),_:1}),M(P(rt),{onClick:k},{default:R(()=>S[11]||(S[11]=[K("注册")])),_:1}),V("p",Rt,X(s.value),1)]),V("div",Lt,[S[18]||(S[18]=V("h3",null,"登录 (user.auth)",-1)),M(P(Y),null,{default:R(()=>[M(P(Z),{position:"floating"},{default:R(()=>S[13]||(S[13]=[K("Alias (用户名)")])),_:1}),M(P(tt),{modelValue:d.value,"onUpdate:modelValue":S[2]||(S[2]=$=>d.value=$),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),M(P(Y),null,{default:R(()=>[M(P(Z),{position:"floating"},{default:R(()=>S[14]||(S[14]=[K("Password (密码)")])),_:1}),M(P(tt),{type:"password",modelValue:h.value,"onUpdate:modelValue":S[3]||(S[3]=$=>h.value=$),placeholder:"密码"},null,8,["modelValue"])]),_:1}),M(P(rt),{onClick:A},{default:R(()=>S[15]||(S[15]=[K("登录")])),_:1}),f.value?(z(),Q("div",Vt,[V("p",null,"已登录: "+X(u.value),1),V("p",null,[S[16]||(S[16]=V("b",null,"公钥 (PubKey):",-1)),K(" "+X(i.value),1)]),M(P(rt),{color:"danger",onClick:O},{default:R(()=>S[17]||(S[17]=[K("退出")])),_:1})])):st("",!0),w.value?(z(),Q("p",Kt,X(w.value),1)):st("",!0)]),V("div",Ht,[S[22]||(S[22]=V("h3",null,"修改密码 (user.change)",-1)),M(P(Y),null,{default:R(()=>[M(P(Z),{position:"floating"},{default:R(()=>S[19]||(S[19]=[K("旧密码")])),_:1}),M(P(tt),{type:"password",modelValue:_.value,"onUpdate:modelValue":S[4]||(S[4]=$=>_.value=$),placeholder:"旧密码"},null,8,["modelValue"])]),_:1}),M(P(Y),null,{default:R(()=>[M(P(Z),{position:"floating"},{default:R(()=>S[20]||(S[20]=[K("新密码")])),_:1}),M(P(tt),{type:"password",modelValue:n.value,"onUpdate:modelValue":S[5]||(S[5]=$=>n.value=$),placeholder:"新密码"},null,8,["modelValue"])]),_:1}),M(P(rt),{onClick:N},{default:R(()=>S[21]||(S[21]=[K("修改密码")])),_:1}),V("p",qt,X(y.value),1)]),V("div",Ft,[S[28]||(S[28]=V("h3",null,"好友管理",-1)),S[29]||(S[29]=V("p",{style:{color:"red"}},"需登录后才可添加好友",-1)),M(P(Y),null,{default:R(()=>[M(P(Z),{position:"floating"},{default:R(()=>S[23]||(S[23]=[K("好友公钥 (PubKey)")])),_:1}),M(P(tt),{modelValue:c.value,"onUpdate:modelValue":S[6]||(S[6]=$=>c.value=$),placeholder:"对方公钥"},null,8,["modelValue"])]),_:1}),M(P(rt),{onClick:C},{default:R(()=>S[24]||(S[24]=[K("添加好友")])),_:1}),S[30]||(S[30]=V("h4",{style:{"margin-top":"8px"}},"我的好友列表 (Buddy List)",-1)),M(P(Et),null,{default:R(()=>[(z(!0),Q(gt,null,wt(v.value,$=>(z(),vt(P(Y),{key:$.pub},{default:R(()=>[M(P(Z),null,{default:R(()=>[V("p",null,[S[25]||(S[25]=V("strong",null,"用户名:",-1)),K(" "+X($.alias),1)]),V("p",null,[S[26]||(S[26]=V("strong",null,"公钥:",-1)),K(" "+X($.pub),1)])]),_:2},1024),M(P(rt),{onClick:U=>o($.pub)},{default:R(()=>S[27]||(S[27]=[K("聊天")])),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),V("div",Wt,[V("h3",null,"聊天 - 当前好友: "+X(t.value||"暂无"),1),r.value?(z(),Q("div",Xt,[M(P(Y),null,{default:R(()=>[M(P(Z),{position:"floating"},{default:R(()=>S[31]||(S[31]=[K("发送消息")])),_:1}),M(P(tt),{modelValue:l.value,"onUpdate:modelValue":S[7]||(S[7]=$=>l.value=$),placeholder:"输入消息"},null,8,["modelValue"])]),_:1}),M(P(rt),{onClick:T},{default:R(()=>S[32]||(S[32]=[K("发送")])),_:1}),V("ul",zt,[(z(!0),Q(gt,null,wt(p.value,($,U)=>(z(),Q("li",{key:U},[$.from===i.value?(z(),Q("b",Yt,"[我]")):(z(),Q("b",Zt,"["+X(D($.from)||"对方")+"]",1)),K(" "+X($.text)+" ",1),V("small",null,"("+X(new Date($.timestamp).toLocaleTimeString())+")",1)]))),128))])])):st("",!0)])]),_:1})]),_:1}))}});export{te as default};
