import{n as jt,o as H,t as z,I as vt,G as R,F as J,J as U,H as K,v as L,B as X,u as Q,C as st,L as wt,M as gt,N as Tt,O as Ot,P as $t,Q as Dt,R as Y,S as Z,T as tt,U as et,V as Et,W as Ct}from"./index-kw_B4tjD.js";var lt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bt(F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F.default:F}function At(F){throw new Error('Could not dynamically require "'+F+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var at={exports:{}};at.exports;var bt;function ht(){return bt||(bt=1,function(F){(function(){function b(G,e){return e?At(G):G.slice?b[a(G)]:function(s,y){G(s={exports:{}}),b[a(y)]=s.exports};function a(s){return s.split("/").slice(-1).toString().replace(".js","")}}var N=F;b(function(G){String.random=function(a,s){var y="";for(a=a||24,s=s||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";a-- >0;)y+=s.charAt(Math.floor(Math.random()*s.length));return y},String.match=function(a,s){var y,h;return typeof a!="string"?!1:(typeof s=="string"&&(s={"=":s}),s=s||{},y=s["="]||s["*"]||s[">"]||s["<"],a===y?!0:h!==s["="]?!1:(y=s["*"]||s[">"],a.slice(0,(y||"").length)===y?!0:h!==s["*"]?!1:h!==s[">"]&&h!==s["<"]?a>=s[">"]&&a<=s["<"]:h!==s[">"]&&a>=s[">"]||h!==s["<"]&&a<=s["<"]))},String.hash=function(a,s){if(typeof a=="string"){if(s=s||0,!a.length)return s;for(var y=0,h=a.length,f;y<h;++y)f=a.charCodeAt(y),s=(s<<5)-s+f,s|=0;return s}};var e=Object.prototype.hasOwnProperty;Object.plain=function(a){return a?a instanceof Object&&a.constructor===Object||Object.prototype.toString.call(a).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(a,s){for(var y in a)if(e.call(a,y)&&(!s||s.indexOf(y)==-1))return!1;return!0},Object.keys=Object.keys||function(a){var s=[];for(var y in a)e.call(a,y)&&s.push(y);return s},function(){var a,s=setTimeout,y=0,h=0,f=typeof setImmediate!=""+a&&setImmediate||function(i,d){return typeof MessageChannel==""+a?s:((i=new MessageChannel).port1.onmessage=function(_){_.data==""&&d()},function(_){d=_,i.port2.postMessage("")})}(),u=s.check=s.check||typeof performance!=""+a&&performance||{now:function(){return+new Date}};s.hold=s.hold||9,s.poll=s.poll||function(i){if(s.hold>=u.now()-y&&h++<3333){i();return}f(function(){y=u.now(),i()},h=0)}}(),function(){var a=setTimeout,s=a.turn=a.turn||function(d){y.push(d)==1&&h(i)},y=s.s=[],h=a.poll,f=0,u,i=function(){(u=y[f++])&&u(),(f==y.length||f==99)&&(y=s.s=y.slice(f),f=0),y.length&&h(i)}}(),function(){var a,s=setTimeout,y=s.turn;(s.each=s.each||function(h,f,u,i){i=i||9,function d(_,r,v){if(r=(_=(h||[]).splice(0,i)).length){for(var c=0;c<r&&a===(v=f(_[c]));c++);if(a===v){y(d);return}}u&&u(v)}()})()}()})(b,"./shim"),b(function(G){G.exports=function e(u,s,y){if(!u)return{to:e};var h,f=typeof s=="function",u=(this.tag||(this.tag={}))[u]||f&&(this.tag[u]={tag:u,to:e._={next:function(d){var _;(_=this.to)&&_.next(d)}}});if(f){var i={off:e.off||(e.off=function(){if(this.next===e._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=e._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:e._,next:s,the:u,on:this,as:y};return(i.back=u.last||u).to=i,u.last=i}return(u=u.to)&&h!==s&&u.next(s),u}})(b,"./onto"),b(function(G){G.exports=function(e){return e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"&&e!=1/0&&e!=-1/0&&e===e||!!e&&typeof e["#"]=="string"&&Object.keys(e).length===1&&e["#"]}})(b,"./valid"),b(function(G){b("./shim");function e(){var u=+new Date;return h<u?(s=0,h=u+e.drift):h=u+(s+=1)/y+e.drift}e.drift=0;var a=-1/0,s=0,y=999,h=a,f;e.is=function(u,i,d){var _=i&&u&&u._&&u._[">"]||d;if(_)return typeof(_=_[i])=="number"?_:a},e.ify=function(u,i,d,_,r){(u=u||{})._=u._||{},r&&(u._["#"]=r);var v=u._[">"]||(u._[">"]={});return f!==i&&i!=="_"&&(typeof d=="number"&&(v[i]=d),f!==_&&(u[i]=_)),u},G.exports=e})(b,"./state"),b(function(G){b("./shim");function e(a){var s={s:{}},y=s.s;a=a||{max:999,age:1e3*9},s.check=function(f){return y[f]?h(f):!1};var h=s.track=function(f){var u=y[f]||(y[f]={});return u.was=s.now=+new Date,s.to||(s.to=setTimeout(s.drop,a.age+9)),h.ed&&h.ed(f),u};return s.drop=function(f){s.to=null,s.now=+new Date;var u=Object.keys(y);console.STAT&&console.STAT(s.now,+new Date-s.now,"dup drop keys"),setTimeout.each(u,function(i){var d=y[i];d&&(f||a.age)>s.now-d.was||delete y[i]},0,99)},s}G.exports=e})(b,"./dup"),b(function(G){b("./onto"),G.exports=function(s,y){if(this.on){var h=(this.opt||{}).lack||9e3;if(typeof s!="function"){if(!s)return;var u=s["#"]||s,f=(this.tag||"")[u];return f?(y&&(f=this.on(u,y),clearTimeout(f.err),f.err=setTimeout(function(){f.off()},h)),!0):void 0}var u=y&&y["#"]||e(9);if(!s)return u;var i=this.on(u,s,y);return i.err=i.err||setTimeout(function(){i.off(),i.next({err:"Error: No ACK yet.",lack:!0})},h),u}};var e=String.random||function(){return Math.random().toString(36).slice(2)}})(b,"./ask"),b(function(G){function e(r){return r instanceof e?(this._={$:this}).$:this instanceof e?e.create(this._={$:this,opt:r}):new e(r)}e.is=function(r){return r instanceof e||r&&r._&&r===r._.$||!1},e.version=.202,e.chain=e.prototype,e.chain.toJSON=function(){},b("./shim"),e.valid=b("./valid"),e.state=b("./state"),e.on=b("./onto"),e.dup=b("./dup"),e.ask=b("./ask"),function(){e.create=function(o){o.root=o.root||o,o.graph=o.graph||{},o.on=o.on||e.on,o.ask=o.ask||e.ask,o.dup=o.dup||e.dup();var x=o.$.opt(o.opt);return o.once||(o.on("in",r,o),o.on("out",r,o),o.on("put",w,o),e.on("create",o),o.on("create",o)),o.once=1,x};function r(o){if(o){if(o.out===r){this.to.next(o);return}var x=this,j=x.as,E=j.at||j,$=E.$,D=E.dup,O,S=o.DBG;if((O=o["#"])||(O=o["#"]=s(9)),!D.check(O)){if(D.track(O),O=o._,o._=typeof O=="function"?O:function(){},o.$&&o.$===(o.$._||"").$||(o.$=$),o["@"]&&!o.put&&t(o),!E.ask(o["@"],o))if(S&&(S.u=+new Date),o.put){v(o);return}else o.get&&e.on.get(o,$);S&&(S.uc=+new Date),x.to.next(o),S&&(S.ua=+new Date),!(o.nts||o.NTS)&&(o.out=r,E.on("out",o),S&&(S.ue=+new Date))}}}function v(o){if(o){var x=o._||"",j=x.root=((x.$=o.$||"")._||"").root;if(o["@"]&&x.faith&&!x.miss){o.out=r,j.on("out",o);return}x.latch=j.hatch,x.match=j.hatch=[];var E=o.put,$=x.DBG=o.DBG,D=+new Date;if(B=B||D,!(E["#"]&&E["."])){$&&($.p=D),x["#"]=o["#"],x.msg=o,x.all=0,x.stun=1;var O=Object.keys(E);console.STAT&&console.STAT(D,(($||x).pk=+new Date)-D,"put sort");var S=0,C,P,M,V,q,W,it;(function nt(ot){if(C!=S){if(C=S,!(M=O[S])){console.STAT&&console.STAT(D,(($||x).pd=+new Date)-D,"put"),n(x);return}(V=E[M])?(it=V._)?M!==it["#"]?W=p+k(M)+"soul not same.":(q=it[">"])||(W=p+k(M)+"no state."):W=p+k(M)+"no meta.":W=p+k(M)+"no node.",P=Object.keys(V||{})}if(W){o.err=x.err=W,n(x);return}var dt=0,rt;for(ot=ot||0;ot++<9&&(rt=P[dt++]);)if(rt!=="_"){var ut=V[rt],yt=q[rt];if(i===yt){W=p+k(rt)+"on"+k(M)+"no state.";break}if(!h(ut)){W=p+k(rt)+"on"+k(M)+"bad "+typeof ut+k(ut);break}c(ut,rt,M,yt,o),++I}if((P=P.slice(dt)).length){y(nt);return}++S,P=null,nt(ot)})()}}}e.on.put=v;function c(o,x,j,E,$){var D=$._||"",O=D.root,S=O.graph,C,P=S[j]||d,M=f(P,x,1),V=P[x],q=D.DBG;(C=console.STAT)&&(!S[j]||!V)&&(C.has=(C.has||0)+1);var W=T();if(E>W){setTimeout(function(){c(o,x,j,E,$)},(C=E-W)>A?A:C),console.STAT&&console.STAT((q||D).Hf=+new Date,C,"future");return}if(!(E<M)&&!(!D.faith&&E===M&&(o===V||m(o)<=m(V))&&!D.miss)){D.stun++;var it=$["#"]+D.all++,nt={toString:function(){return it},_:D};nt.toJSON=nt.toString,O.dup.track(nt)["#"]=$["#"],q&&(q.ph=q.ph||+new Date),O.on("put",{"#":nt,"@":$["@"],put:{"#":j,".":x,":":o,">":E},ok:$.ok,_:D})}}function w(o){var x;(x=(o._||"").DBG)&&(x.pa=+new Date,x.pm=x.pm||+new Date);var j=this,E=j.as,$=E.graph,D=o._,O=o.put,S=O["#"],C=O["."],P=O[":"],M=O[">"];o["#"];var V;(V=D.msg)&&(V=V.put)&&(V=V[S])&&u(V,C,M,P,S),$[S]=u($[S],C,M,P,S),(V=(E.next||"")[S])&&V.on("in",o),n(D),j.to.next(o)}function n(o,x){var j;if(!o.stop&&!(!o.err&&0<--o.stun)&&(o.stop=1,!!(j=o.root))){var E=o.match;E.end=1,E===j.hatch&&(!(E=o.latch)||E.end?delete j.hatch:j.hatch=E),o.hatch&&o.hatch(),setTimeout.each(o.match,function($){$&&$()}),!(!(x=o.msg)||o.err||x.err)&&(x.out=r,o.root.on("out",x),g())}}function t(o){var x=o["@"]||"",j;if(!(j=x._)){var E=(E=o.$)&&(E=E._)&&(E=E.root)&&(E=E.dup);if(!(E=E.check(x)))return;o["@"]=E["#"]||o["@"];return}j.acks=(j.acks||0)+1,(j.err=o.err)&&(o["@"]=j["#"],n(j)),j.ok=o.ok||j.ok,!j.stop&&!j.crack&&(j.crack=j.match&&j.match.push(function(){l(j)})),l(j)}function l(o){!o||!o.root||o.stun||o.acks!==o.all||o.root.on("in",{"@":o["#"],err:o.err,ok:o.err?i:o.ok||{"":1}})}var p="Error: Invalid graph!",k=function(o){return" '"+(""+o).slice(0,9)+"...' "},m=JSON.stringify,A=2147483647,T=e.state,I=0,B,g=function(){I>999&&I/-(B-(B=+new Date))>1&&(e.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),g=function(){I=0})}}(),function(){e.on.get=function(v,c){var w=c._,n=v.get,t=n["#"],l=w.graph[t],p=n["."],k=w.next||(w.next={}),m=k[t],A=v._||{},T=A.DBG=v.DBG;if(T&&(T.g=+new Date),!l)return w.on("get",v);if(p){if((typeof p!="string"||i===l[p])&&!((m||"").next||"")[p]){w.on("get",v);return}l=u({},p,f(l,p),l[p],t)}l&&r(v,l),w.on("get",v)};function r(v,c){var w=+new Date,n=v._||{},t=n.DBG=v.DBG,l=v["#"],p=s(9),k=Object.keys(c||"").sort(),m=((c||"")._||"")["#"];k.length;var A=v.$._.root,T=c===A.graph[m];console.STAT&&console.STAT(w,((t||n).gk=+new Date)-w,"got keys"),c&&function I(){w=+new Date;for(var B=0,g,o={},x;B<9&&(g=k[B++]);)u(o,g,f(c,g),c[g],m);k=k.slice(B),(x={})[m]=o,o=x;var j;T&&(j=function(){},j.ram=j.faith=!0),x=k.length,console.STAT&&console.STAT(w,-(w-(w=+new Date)),"got copied some"),t&&(t.ga=+new Date),A.on("in",{"@":l,"#":p,put:o,"%":x?p=s(9):i,$:A.$,_:j,DBG:t,FOO:1}),console.STAT&&console.STAT(w,+new Date-w,"got in"),x&&setTimeout.turn(I)}(),c||A.on("in",{"@":v["#"]})}e.on.get.ack=r}(),function(){e.chain.opt=function(r){r=r||{};var v=this,c=v._,w=r.peers||r;return Object.plain(r)||(r={}),Object.plain(c.opt)||(c.opt=r),typeof w=="string"&&(w=[w]),Object.plain(c.opt.peers)||(c.opt.peers={}),w instanceof Array&&(r.peers={},w.forEach(function(n){var t={};t.id=t.url=n,r.peers[n]=c.opt.peers[n]=c.opt.peers[n]||t})),a(r,function n(t){var l=this[t];if(this&&this.hasOwnProperty(t)||typeof l=="string"||Object.empty(l)){this[t]=l;return}l&&l.constructor!==Object&&!(l instanceof Array)||a(l,n)}),c.opt.from=r,e.on("opt",c),c.opt.uuid=c.opt.uuid||function(t){return e.state().toString(36).replace(".","")+String.random(t||12)},v}}();var a=function(r,v){Object.keys(r).forEach(v,r)},s=String.random,y=setTimeout.turn,h=e.valid,f=e.state.is,u=e.state.ify,i,d={},_;e.log=function(){return!e.log.off&&_.log.apply(_,arguments),[].slice.call(arguments).join(" ")},e.log.once=function(r,v,c){return(c=e.log.once)[r]=c[r]||0,c[r]++||e.log(v)},typeof window<"u"&&((window.GUN=window.Gun=e).window=window);try{typeof N<"u"&&(N.exports=e)}catch{}G.exports=e,(e.window||{}).console=(e.window||{}).console||{log:function(){}},(_=console).only=function(r,v){return _.only.i&&r===_.only.i&&_.only.i++&&(_.log.apply(_,arguments)||v)},e.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(b,"./root"),b(function(G){var e=b("./root");e.chain.back=function(y,h){var f;if(y=y||1,y===-1||y===1/0)return this._.root.$;if(y===1)return(this._.back||this._).$;var u=this,i=u._;if(typeof y=="string"&&(y=y.split(".")),y instanceof Array){var d=0,_=y.length,f=i;for(d;d<_;d++)f=(f||a)[y[d]];return s!==f?h?u:f:(f=i.back)?f.$.back(y,h):void 0}if(typeof y=="function"){for(var r,f={back:i};(f=f.back)&&s===(r=y(f,h)););return r}return typeof y=="number"?(i.back||i).$.back(y-1):this};var a={},s})(b,"./back"),b(function(G){var e=b("./root");e.chain.chain=function(n){var t=this,l=t._,p=new(n||t).constructor(t),k=p._,m;return k.root=m=l.root,k.id=++m.once,k.back=t._,k.on=e.on,k.on("in",e.on.in,k),k.on("out",e.on.out,k),p};function a(n){var t,l=this.as,p=l.back,k=l.root,m;if(n.$||(n.$=l.$),this.to.next(n),l.err){l.on("in",{put:l.put=i,$:l.$});return}if(t=n.get){if(k.pass&&(k.pass[l.id]=l),l.lex&&Object.keys(l.lex).forEach(function(A){m[A]=l.lex[A]},m=n.get=n.get||{}),t["#"]||l.soul){if(t["#"]=t["#"]||l.soul,n["#"]||(n["#"]=d(9)),p=k.$.get(t["#"])._,t=t["."]){if(r(p.put,t)&&(m=p.ask&&p.ask[t],(p.ask||(p.ask={}))[t]=p.$.get(t)._,p.on("in",{get:t,put:{"#":p.soul,".":t,":":p.put[t],">":c(k.graph[p.soul],t)}}),m))return}else{if(m=p.ask&&p.ask[""],(p.ask||(p.ask={}))[""]=p,i!==p.put&&(p.on("in",p),m))return;n.$=p.$}return k.ask(f,n),k.on("in",n)}if(t["."])return l.get?(n={get:{".":l.get},$:l.$},(p.ask||(p.ask={}))[l.get]=n.$._,p.on("out",n)):(n={get:l.lex?n.get:{},$:l.$},p.on("out",n));if((l.ask||(l.ask={}))[""]=l,l.get)return t["."]=l.get,(p.ask||(p.ask={}))[l.get]=n.$._,p.on("out",n)}return p.on("out",n)}e.on.out=a;function s(n,t){t=t||this.as;var l=t.root,p=n.$||(n.$=t.$),k=(p||"")._||u,m=n.put||"",A=m["#"],T=m["."],I=i!==m["="]?m["="]:m[":"],B=m[">"]||-1/0,g;if(i!==n.put&&(i===m["#"]||i===m["."]||i===m[":"]&&i===m["="]||i===m[">"])){if(!_(m)){if(!(A=((m||"")._||"")["#"])){console.log("chain not yet supported for",m,"...",n,t);return}return p=t.root.$.get(A),setTimeout.each(Object.keys(m).sort(),function(o){o=="_"||i===(B=c(m,o))||t.on("in",{$:p,put:{"#":A,".":o,"=":m[o],">":B},VIA:n})})}t.on("in",{$:k.back.$,put:{"#":A=k.back.soul,".":T=k.has||k.get,"=":m,">":c(k.back.put,T)},via:n});return}(n.seen||"")[t.id]||((n.seen||(n.seen=function(){}))[t.id]=t,t!==k&&(Object.keys(n).forEach(function(o){m[o]=n[o]},m={}),m.get=t.get||m.get,!t.soul&&!t.has?m.$$$=m.$$$||t.$:k.soul&&(m.$=t.$,m.$$=m.$$||k.$),n=m),h(n,t),(t.soul||n.$$)&&B>=c(l.graph[A],T)&&((m=l.$.get(A)._).put=w(m.put,T,B,I,A)),!k.soul&&B>=c(l.graph[A],T)&&(g=(l.$.get(A)._.next||"")[T])&&(g.put=I,typeof(m=_(I))=="string"&&(g.put=l.$.get(m)._.put||I)),this.to&&this.to.next(n),t.any&&setTimeout.each(Object.keys(t.any),function(o){(o=t.any[o])&&o(n)},0,99),t.echo&&setTimeout.each(Object.keys(t.echo),function(o){(o=t.echo[o])&&o.on("in",n)},0,99),((n.$$||"")._||k).soul&&(g=t.next)&&(g=g[T])&&(m={},Object.keys(n).forEach(function(o){m[o]=n[o]}),m.$=(n.$$||n.$).get(m.get=T),delete m.$$,delete m.$$$,g.on("in",m)),y(n,t))}e.on.in=s;function y(n,t){if(t=t||this.as||n.$._,!(n.$$&&this!==e.on)&&!(!n.put||t.soul)){var l=n.put||"",p=l["="]||l[":"],T,k=t.root,m=k.$.get(l["#"]).get(l["."])._;if(typeof(p=_(p))!="string"){this===e.on&&((m.echo||(m.echo={}))[t.id]=t);return}if(!((m.echo||(m.echo={}))[t.id]&&!(k.pass||"")[t.id])){if(T=k.pass){if(T[p+t.id])return;T[p+t.id]=1}(m.echo||(m.echo={}))[t.id]=t,t.has&&(t.link=p);var A=k.$.get(m.link=p)._;(A.echo||(A.echo={}))[m.id]=m;var T=t.ask||"";(T[""]||t.lex)&&A.on("out",{get:{"#":p}}),setTimeout.each(Object.keys(T),function(I,B){!I||!(B=T[I])||B.on("out",{get:{"#":p,".":I}})},0,99)}}}e.on.link=y;function h(n,t){var l=n.put||"",p=i!==l["="]?l["="]:l[":"],k=t.root,m,A;if(i===p){if(t.soul&&i!==t.put||(A=(n.$$||n.$||"")._||"",n["@"]&&(i!==A.put||i!==t.put)))return;(m=t.link||n.linked)&&delete(k.$.get(m)._.echo||"")[t.id],t.has&&(t.link=null),t.put=i,setTimeout.each(Object.keys(t.next||""),function(T,I){(I=t.next[T])&&(m&&delete(k.$.get(m).get(T)._.echo||"")[I.id],I.on("in",{get:T,put:i,$:I.$}))},0,99);return}t.soul||n.$$||(m=_(p),A=n.$._||"",!((m===A.link||t.has&&!A.link)&&!((k.pass||"")[t.id]&&typeof m!="string"))&&(delete(A.echo||"")[t.id],h({get:t.get,put:i,$:n.$,linked:n.linked=n.linked||A.link},t)))}e.on.unlink=h;function f(n,t){var l=this.as,p=l.$._;p.root;var k=l.get||"",m=(n.put||"")[k["#"]]||"";if(!n.put||typeof k["."]=="string"&&i===m[k["."]]){if(i!==p.put||!p.soul&&!p.has)return;p.ack=(p.ack||0)+1,p.on("in",{get:p.get,put:p.put=i,$:p.$,"@":n["@"]});return}(n._||{}).miss=1,e.on.put(n)}var u={},i,d=String.random,_=e.valid,r=function(n,t){return n&&Object.prototype.hasOwnProperty.call(n,t)},v=e.state,c=v.is,w=v.ify})(b,"./chain"),b(function(G){var e=b("./root");e.chain.get=function(i,d,_){var r,v;if(typeof i=="string"){if(i.length==0)return(r=this.chain())._.err={err:e.log("0 length key!",i)},d&&d.call(r,r._.err),r;var c=this,w=c._,n=w.next||h;(r=n[i])||(r=i&&a(i,c)),r=r&&r.$}else if(typeof i=="function"){let A=function(T,I,B){if(!A.stun&&!(($=l.pass)&&!$[p])){var g=T.$._,o=(T.$$||"")._,x=(o||g).put,j=!g.has&&!g.soul,E={},$;if((j||u===x)&&(x=u===(($=T.put)||"")["="]?u===($||"")[":"]?$:$[":"]:$["="]),typeof($=e.valid(x))=="string"&&(x=u===($=l.$.get($)._.put)?t.not?u:x:$),!(t.not&&u===x)){if(u===t.stun){if(($=l.stun)&&$.on&&(w.$.back(function(D){if($.on(""+D.id,E={}),(E.run||0)<A.id)return E}),!E.run&&$.on(""+g.id,E={}),!E.run&&o&&$.on(""+o.id,E={}),A.id>E.run&&((!E.stun||E.stun.end)&&(E.stun=$.on("stun"),E.stun=E.stun&&E.stun.last),E.stun&&!E.stun.end))){(E.stun.add||(E.stun.add={}))[p]=function(){A(T,I,1)};return}if(u===x&&(B=0),($=l.hatch)&&!$.end&&u===t.hatch&&!B){if(k[g.$._.id])return;k[g.$._.id]=1,$.push(function(){A(T,I,1)});return}k={}}if(l.pass){if(l.pass[p+g.id])return;l.pass[p+g.id]=1}if(t.on){t.ok.call(g.$,x,g.get,T,I||A);return}if(t.v2020){t.ok(T,I||A);return}Object.keys(T).forEach(function(D){$[D]=T[D]},$={}),T=$,T.put=x,t.ok.call(t.as,T,I||A)}}};if(d===!0)return s(this,i,d,_),this;r=this;var w=r._,t=d||{},l=w.root,p;t.at=w,t.ok=i;var k={};return A.at=w,(w.any||(w.any={}))[p=String.random(7)]=A,A.off=function(){A.stun=1,w.any&&delete w.any[p]},A.rid=y,A.id=t.run||++l.once,v=l.pass,(l.pass={})[p]=1,t.out=t.out||{get:{}},w.on("out",t.out),l.pass=v,r}else{if(typeof i=="number")return this.get(""+i,d,_);if(typeof(v=f(i))=="string")return this.get(v,d,_);(v=this.get.next)&&(r=v(this,i))}return r?(d&&typeof d=="function"&&r.get(d,_),r):((r=this.chain())._.err={err:e.log("Invalid get request!",i)},d&&d.call(r,r._.err),r)};function a(i,d){var _=d._,r=_.next,v=d.chain(),c=v._;return r||(r=_.next={}),r[c.get=i]=c,d===_.root.$?c.soul=i:(_.soul||_.has)&&(c.has=i),c}function s(i,d,_,r){var v=i._,c=0,w;return(w=v.soul||v.link)?d(w,r,v):v.jam?v.jam.push([d,r]):(v.jam=[[d,r]],i.get(function(t,l){if(!(u===t.put&&!v.root.opt.super&&(w=Object.keys(v.root.opt.peers).length)&&++c<=w)){l.rid(t);var p=(p=t.$)&&p._||{},k=0,m;for(w=v.jam,delete v.jam;m=w[k++];){var A=m[0];m=m[1],A&&A(p.link||p.soul||e.valid(t.put)||((t.put||{})._||{})["#"],m,t,l)}}},{out:{get:{".":!0}}}),i)}function y(i){var d=this.at||this.on;if(!i||d.soul||d.has)return this.off();if(i=(i=(i=i.$||i)._||i).id){d.map;var _;if((_=this.seen||(this.seen={}))[i])return!0;_[i]=!0}}var h={},f=e.valid,u})(b,"./get"),b(function(G){var e=b("./root");e.chain.put=function(r,v,c){var w=this,n=w._,t=n.root;c=c||{},c.root=n.root,c.run||(c.run=t.once),a(c,n.id),c.ack=c.ack||v,c.via=c.via||w,c.data=c.data||r,c.soul||(c.soul=n.soul||typeof v=="string"&&v);var l=c.state=c.state||e.state();return typeof r=="function"?(r(function(p){c.data=p,w.put(f,f,c)}),w):c.soul?(c.$=t.$.get(c.soul),c.todo=[{it:c.data,ref:c.$}],c.turn=c.turn||i,c.ran=c.ran||s,function p(){var k=c.todo,m=k.pop(),A=m.it;m.ref&&m.ref._.id;var T,I,B,g,o;if(a(c,m.ref),(g=m.todo)&&(I=g.pop(),A=A[I],g.length&&k.push(m)),I&&(k.path||(k.path=[])).push(I),!(T=d(A))&&!(o=e.is(A))){if(!Object.plain(A)){s.err(c,"Invalid data: "+h(A)+" at "+(c.via.back(function($){$.get&&g.push($.get)},g=[])||g.join("."))+"."+(k.path||[]).join("."));return}for(var x=c.seen||(c.seen=[]),j=x.length;j--;)if(A===(g=x[j]).it){T=A=g.link;break}}if(I&&T)m.node=_(m.node,I,l,A);else{let $=function(D,O){var S=B.link["#"];O&&(O.off(),O.rid(D));var C=S||D.soul||(g=(D.$$||D.$)._||"").soul||g.link||((g=g.put||"")._||"")["#"]||g["#"]||((g=D.put||"")&&D.$$?g["#"]:(g["="]||g[":"]||"")["#"]);if(!S&&a(c,D.$),!C&&!m.link["#"]){(m.wait||(m.wait=[])).push(function(){$(D,O)});return}C||(C=[],(D.$$||D.$).back(function(P){if(g=P.soul||P.link)return C.push(g);C.push(P.get)}),C=C.reverse().join("/")),B.link["#"]=C,!o&&(((c.graph||(c.graph={}))[C]=B.node||(B.node={_:{}}))._["#"]=C),delete c.wait[E],B.wait&&setTimeout.each(B.wait,function(P){P&&P()}),c.ran(c)};if(!c.seen){s.err(c,"Data at root of graph must be a node (an object).");return}c.seen.push(B={it:A,link:{},todo:o?[]:Object.keys(A).sort().reverse(),path:(k.path||[]).slice(),up:m}),m.node=_(m.node,I,l,B.link),!o&&B.todo.length&&k.push(B);var E=c.seen.length;(c.wait||(c.wait={}))[E]="",g=(B.ref=o?A:I?m.ref.get(I):m.ref)._,(g=A&&(A._||"")["#"]||g.soul||g.link)?$({soul:g}):B.ref.get($,{run:c.run,v2020:1,out:{get:{".":" "}}})}if(!k.length)return c.ran(c);c.turn(p)}(),w):(y(c),w)};function a(r,v){if(v){v=(v._||"").id||v;var c=r.root.stun||(r.root.stun={on:e.on}),w={},n;r.stun||(r.stun=c.on("stun",function(){})),(n=c.on(""+v))&&n.the.last.next(w),!(w.run>=r.run)&&c.on(""+v,function(t){if(r.stun.end){this.off(),this.to.next(t);return}t.run=t.run||r.run,t.stun=t.stun||r.stun})}}function s(r){if(r.err){s.end(r.stun,r.root);return}if(!(r.todo.length||r.end||!Object.empty(r.wait))){r.end=1;var v=r.$.back(-1)._,c=v.root,w=v.ask(function(p){c.on("ack",p),p.err&&!p.lack&&e.log(p),++n>(r.acks||0)&&this.off(),r.ack&&r.ack(p,this)},r.opt),n=0,t=r.stun,l;(l=function(){t&&(s.end(t,c),setTimeout.each(Object.keys(t=t.add||""),function(p){(p=t[p])&&p()}))}).hatch=l,r.ack&&!r.ok&&(r.ok=r.acks||9),r.via._.on("out",{put:r.out=r.graph,ok:r.ok&&{"@":r.ok+1},opt:r.opt,"#":w,_:l})}}s.end=function(r,v){r.end=u,r.the.to===r&&r===r.the.last&&delete v.stun,r.off()},s.err=function(r,v){(r.ack||u).call(r,r.out={err:r.err=e.log(v)}),r.ran(r)};function y(r){var v=r.via._,c;r.via=r.via.back(function(w){if(w.soul||!w.get)return w.$;c=r.data,(r.data={})[w.get]=c}),(!r.via||!r.via._.soul)&&(r.via=v.root.$.get(((r.data||"")._||"")["#"]||v.$.back("opt.uuid")())),r.via.put(r.data,r.ack,r)}function h(r,v){return r&&(v=r.constructor)&&v.name||typeof r}var f,u=function(){},i=setTimeout.turn,d=e.valid,_=e.state.ify})(b,"./put"),b(function(G){var e=b("./root");b("./chain"),b("./back"),b("./put"),b("./get"),G.exports=e})(b,"./index"),b(function(G){var e=b("./index");e.chain.on=function(y,h,f,u){var i=this,d=i._;d.root;var _;if(typeof y=="string")return h?(_=d.on(y,h,f||d,u),f&&f.$&&(f.subs||(f.subs=[])).push(_),i):d.on(y);var r=h;return(r=r===!0?{change:!0}:r||{}).not=1,r.on=1,i.get(y,r),i},e.chain.once=function(y,h){if(h=h||{},!y)return a(this);var f=this,u=f._,i=u.root;u.put;var d=String.random(7),_;return f.get(function(r,v,c,w){var n=this,t=n._,l=t.one||(t.one={});if(w.stun||l[d]==="")return;if((_=e.valid(r))===!0){p();return}if(typeof _=="string")return;clearTimeout((u.one||"")[d]),clearTimeout(l[d]),l[d]=setTimeout(p,h.wait||99);function p(k){if(!t.has&&!t.soul&&(t={put:r,get:v}),s===(_=t.put)&&(_=((c.$$||"")._||"").put),typeof e.valid(_)=="string"&&(_=i.$.get(_)._.put,_===s&&!k)){l[d]=setTimeout(function(){p(1)},h.wait||99);return}w.stun||l[d]!==""&&(l[d]="",(u.soul||u.has)&&w.off(),y.call(n,_,t.get),clearTimeout(l[d]))}},{on:1}),f};function a(y,h,f){return e.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(f=y.chain())._.nix=y.once(function(u,i){f._.on("in",this._)}),f._.lex=y._.lex,f}e.chain.off=function(){var y=this,h=y._,f,u=h.back;if(u)return h.ack=0,(f=u.next)&&f[h.get]&&delete f[h.get],(f=u.any)&&(delete u.any,u.any={}),(f=u.ask)&&delete f[h.get],(f=u.put)&&delete f[h.get],(f=h.soul)&&delete u.root.graph[f],(f=h.map)&&Object.keys(f).forEach(function(i,d){d=f[i],d.link&&u.root.$.get(d.link).off()}),(f=h.next)&&Object.keys(f).forEach(function(i,d){d=f[i],d.$.off()}),h.on("off",{}),y};var s})(b,"./on"),b(function(G){var e=b("./index"),a=e.chain.get.next;e.chain.get.next=function(f,u){var i;return Object.plain(u)?(i=((i=u["#"])||"")["="]||i)?f.get(i):((i=f.chain()._).lex=u,f.on("in",function(d){String.match(d.get||(d.put||"")["."],u["."]||u["#"]||u)&&i.on("in",d),this.to.next(d)}),i.$):(a||y)(f,u)},e.chain.map=function(f,u,i){var d=this,_=d._,r,v;return Object.plain(f)&&(r=f["."]?f:{".":f},f=h),f?(e.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),v=d.chain(),d.map().on(function(c,w,n,t){var l=(f||y).call(this,c,w,n,t);if(h!==l){if(c===l)return v._.on("in",n);if(e.is(l))return v._.on("in",l._);var p={};Object.keys(n.put).forEach(function(k){p[k]=n.put[k]},p),p["="]=l,v._.on("in",{get:w,put:p})}}),v):((v=_.each)||((_.each=v=d.chain())._.lex=r||v._.lex||_.lex,v._.nix=d.back("nix"),d.on("in",s,v._)),v)};function s(f){this.to.next(f);var u=this.as,i=f.$,d=i._,_=f.put,r;!d.soul&&!f.$$||(r=u.lex)&&!String.match(f.get||(_||"")["."],r["."]||r["#"]||r)||e.on.link(f,u)}var y=function(){},h})(b,"./map"),b(function(G){var e=b("./index");e.chain.set=function(a,s,y){var h=this,f=h.back(-1),u,i;return s=s||function(){},y=y||{},y.item=y.item||a,(u=((a||"")._||"")["#"])&&((a={})["#"]=u),typeof(i=e.valid(a))=="string"?h.get(u=i).put(a,s,y):e.is(a)?(h.put(function(d){a.get(function(_,r,v){if(!_)return s.call(h,{err:e.log('Only a node can be linked! Not "'+v.put+'"!')});(i={})[_]={"#":_},d(i)},!0)}),a):(Object.plain(a)&&(a=f.get(u=h.back("opt.uuid")()).put(a)),h.get(u||f.back("opt.uuid")(7)).put(a,s,y))}})(b,"./set"),b(function(G){b("./shim");var e=function(){},a=JSON.parseAsync||function(f,u,i){var d,_=+new Date;try{u(d,JSON.parse(f,i),s.sucks(+new Date-_))}catch(r){u(r)}},s=JSON.stringifyAsync||function(f,u,i,d){var _,r=+new Date;try{u(_,JSON.stringify(f,i,d),s.sucks(+new Date-r))}catch(v){u(v)}};s.sucks=function(f){f>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),s.sucks=e)};function y(f){var u=function(){},i=f.opt||{};i.log=i.log||console.log,i.gap=i.gap||i.wait||0,i.max=i.max||(i.memory?i.memory*999*999:3e8)*.3,i.pack=i.pack||i.max*.01*.01,i.puff=i.puff||9;var d=setTimeout.turn||setTimeout,_=f.dup,r=_.check,v=_.track,c=u.hear=function(t,l){if(t){if(i.max<=t.length)return u.say({dam:"!",err:"Message too big!"},l);u===this&&(c.d+=t.length||0,++c.c);var p=l.SH=+new Date,k=t[0],m;if(k==="["){a(t,function(A,T){if(A||!T)return u.say({dam:"!",err:"DAM JSON parse error."},l);console.STAT&&console.STAT(+new Date,T.length,"# on hear batch");var I=i.puff;(function B(){for(var g=+new Date,o=0,x;o<I&&(x=T[o++]);)u.hear(x,l);T=T.slice(o),console.STAT&&console.STAT(g,+new Date-g,"hear loop"),w(l),T.length&&d(B,0)})()}),t="";return}if(k==="{"||(t["#"]||Object.plain(t))&&(m=t)){if(m)return c.one(m,l,p);a(t,function(A,T){if(A||!T)return u.say({dam:"!",err:"DAM JSON parse error."},l);c.one(T,l,p)});return}}};c.one=function(t,l,B){var k,m,A,T,I;if(t.DBG&&(t.DBG=I={DBG:t.DBG}),I&&(I.h=B),I&&(I.hp=+new Date),(k=t["#"])||(k=t["#"]=String.random(9)),!(A=r(k))&&(m=t["##"],!(m&&(A=t["@"]||t.get&&k)&&_.check(T=A+m)))){if((t._=function(){}).via=u.leap=l,(A=t["><"])&&typeof A=="string"&&A.slice(0,99).split(",").forEach(function(g){this[g]=1},t._.yo={}),A=t.dam){(A=u.hear[A])&&A(t,l,f),v(k);return}(A=t.ok)&&(t._.near=A["/"]);var B=+new Date;I&&(I.is=B),l.SI=k,v.ed=function(g){k===g&&(v.ed=0,(g=_.s[k])&&(g.via=l,t.get&&(g.it=t)))},f.on("in",u.last=t),I&&(I.hd=+new Date),console.STAT&&console.STAT(B,+new Date-B,t.get?"msg get":t.put?"msg put":"msg"),v(k),T&&v(T),u.leap=u.last=null}},c.c=c.d=0,function(){var t=0,l;u.hash=function(m,A){var T,I,B,g=+new Date;s(m.put,function o(x,j){var E=(I||(I=B=j||"")).slice(0,32768);if(T=String.hash(E,T),I=I.slice(32768),I){d(o,0);return}console.STAT&&console.STAT(g,+new Date-g,"say json+hash"),m._.$put=B,m["##"]=T,u.say(m,A),delete m._.$put},p)};function p(m,A){var T;return A instanceof Object?(Object.keys(A).sort().forEach(k,{to:T={},on:A}),T):A}function k(m){this.to[m]=this.on[m]}u.say=function(m,A){var T;if((T=this)&&(T=T.to)&&T.next&&T.next(m),!m)return!1;var I,B,g,o=m["@"],x=m._||(m._=function(){}),j=m.DBG,E=+new Date;if(x.y=x.y||E,A||j&&(j.y=E),(I=m["#"])||(I=m["#"]=String.random(9)),!l&&v(I),!(B=m["##"])&&h!==m.put&&!x.via&&o){u.hash(m,A);return}if(!A&&o&&(A=(T=_.s[o])&&(T.via||(T=T.it)&&(T=T._)&&T.via)||(T=u.last)&&o===T["#"]&&u.leap),!A&&o)return _.s[o]?void 0:(console.STAT&&console.STAT(+new Date,++t,"total no peer to ack to"),!1);if(o&&!m.put&&!B&&((_.s[o]||"").it||"")["##"])return!1;if(!A&&u.way)return u.way(m);if(j&&(j.yh=+new Date),!(g=x.raw)){u.raw(m,A);return}if(j&&(j.yr=+new Date),!A||!A.id){if(!Object.plain(A||i.peers))return!1;var E=+new Date;i.puff;var $=i.peers,D=Object.keys(A||i.peers||{});console.STAT&&console.STAT(E,+new Date-E,"peer keys"),function C(){var P=+new Date;l=1;var M=x.raw;x.raw=g;for(var V=0,q;V<9&&(q=(D||"")[V++]);)(q=$[q]||(A||"")[q])&&u.say(m,q);x.raw=M,l=0,D=D.slice(V),console.STAT&&console.STAT(P,+new Date-P,"say loop"),D.length&&(d(C,0),o&&v(o))}();return}if(!A.wire&&u.wire&&u.wire(A),I!==A.last){if(A.last=I,A===x.via||(T=x.yo)&&(T[A.url]||T[A.pid]||T[A.id]))return!1;if(console.STAT&&console.STAT(E,((j||x).yp=+new Date)-(x.y||E),"say prep"),!l&&o&&v(o),A.batch){if(A.tail=(T=A.tail||0)+g.length,A.tail<=i.pack){A.batch+=(T?",":"")+g;return}w(A)}A.batch="[";var O=+new Date;setTimeout(function(){console.STAT&&console.STAT(O,+new Date-O,"0ms TO"),w(A)},i.gap),n(g,A),console.STAT&&o===A.SI&&console.STAT(E,+new Date-A.SH,"say ack")}},u.say.c=u.say.d=0,u.raw=function(m,A){if(!m)return"";var T=m._||{},I,B;if(B=T.raw)return B;if(typeof m=="string")return m;var g=m["##"],o=m["@"];if(g&&o){if(!T.via&&r(o+g))return!1;if(B=(_.s[o]||"").it){if(g===B["##"])return!1;B["##"]||(B["##"]=g)}}if(!m.dam&&!m["@"]){var x=0,j=[];B=i.peers;for(var E in B){var $=B[E];if(j.push($.url||$.pid||$.id),++x>6)break}x>1&&(m["><"]=j.join())}if(m.put&&(B=m.ok)&&(m.ok={"@":(B["@"]||1)-1,"/":B["/"]==m._.near?u.near:B["/"]}),I=T.$put){B={},Object.keys(m).forEach(function(O){B[O]=m[O]}),B.put=":])([:",s(B,function(O,S){if(!O){var C=+new Date;B=S.indexOf('"put":":])([:"'),D(h,S=S.slice(0,B+6)+I+S.slice(B+14)),console.STAT&&console.STAT(C,+new Date-C,"say slice")}});return}s(m,D);function D(O,S){O||(T.raw=S,u.say(m,A))}}}();function w(t){var l=t.batch,p=typeof l=="string";if(p&&(l+="]"),t.batch=t.tail=null,!!l&&!(p?3>l.length:!l.length)){if(!p)try{l=l.length===1?l[0]:JSON.stringify(l)}catch(k){return i.log("DAM JSON stringify error",k)}l&&n(l,t)}}function n(t,l){try{var p=l.wire;l.say?l.say(t):p.send&&p.send(t),u.say.d+=t.length||0,++u.say.c}catch{(l.queue=l.queue||[]).push(t)}}return u.near=0,u.hi=function(t){var l=t.wire,p;if(!l){u.wire(t.length&&{url:t,id:t}||t);return}t.id?i.peers[t.url||t.id]=t:(p=t.id=t.id||t.url||String.random(9),u.say({dam:"?",pid:f.opt.pid},i.peers[p]=t),delete _.s[t.last]),t.met||(u.near++,t.met=+new Date,f.on("hi",t)),p=t.queue,t.queue=[],setTimeout.each(p||[],function(k){n(k,t)},0,9)},u.bye=function(t){t.met&&--u.near,delete t.met,f.on("bye",t);var l=+new Date;l=l-(t.met||l),u.bye.time=((u.bye.time||l)+l)/2},u.hear["!"]=function(t,l){i.log("Error:",t.err)},u.hear["?"]=function(t,l){t.pid&&(l.pid||(l.pid=t.pid),t["@"])||(u.say({dam:"?",pid:i.pid,"@":t["#"]},l),delete _.s[l.last])},u.hear.mob=function(t,l){if(t.peers){var p=Object.keys(t.peers),k=p[Math.random()*p.length>>0];k&&(u.bye(l),u.hi(k))}},f.on("create",function(t){t.opt.pid=t.opt.pid||String.random(9),this.to.next(t),t.on("out",u.say)}),f.on("bye",function(t,l){t=i.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(l=t.wire)&&l.close&&l.close(),delete i.peers[t.id],t.wire=null}),f.on("bye",function(t,l){this.to.next(t),(l=console.STAT)&&(l.peers=u.near),(l=t.url)&&setTimeout(function(){},i.lack||9e3)}),f.on("hi",function(t,l){if(this.to.next(t),(l=console.STAT)&&(l.peers=u.near),!i.super){var p=Object.keys(f.next||"");p.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(p,function(k){var m=f.next[k];if(i.super||(m.ask||"")[""]){u.say({get:{"#":k}},t);return}setTimeout.each(Object.keys(m.ask||""),function(A){A&&u.say({"##":String.hash((f.graph[k]||"")[A]),get:{"#":k,".":A}},t)})})}}),u}var h;try{G.exports=y}catch{}})(b,"./mesh"),b(function(G){var e=b("./index");e.Mesh=b("./mesh"),e.on("opt",function(s){if(this.to.next(s),s.once)return;var y=s.opt;if(y.WebSocket===!1)return;var h=e.window||{},f=y.WebSocket||h.WebSocket||h.webkitWebSocket||h.mozWebSocket;if(!f)return;y.WebSocket=f;var u=y.mesh=y.mesh||e.Mesh(s);u.wire||y.wire,u.wire=y.wire=i;function i(v){try{if(!v||!v.url)return w&&w(v);var c=v.url.replace(/^http/,"ws"),w=v.wire=new y.WebSocket(c);return w.onclose=function(){_(v),y.mesh.bye(v)},w.onerror=function(n){_(v)},w.onopen=function(){y.mesh.hi(v)},w.onmessage=function(n){n&&y.mesh.hear(n.data||n,v)},w}catch{y.mesh.bye(v)}}setTimeout(function(){!y.super&&s.on("out",{dam:"hi"})},1);var d=2*999;function _(v){clearTimeout(v.defer),y.peers[v.url]&&(r&&v.retry<=0||(v.retry=(v.retry||y.retry+1||60)-(-v.tried+(v.tried=+new Date)<d*4?1:0),v.defer=setTimeout(function c(){if(r&&r.hidden)return setTimeout(c,d);i(v)},d)))}var r=""+a!=typeof document&&document});var a})(b,"./websocket"),b(function(G){if(!(typeof Gun>"u")){var e=function(){},a;try{a=(Gun.window||e).localStorage}catch{}a||(Gun.log("Warning: No localStorage exists to persist data to!"),a={setItem:function(y,h){this[y]=h},removeItem:function(y){delete this[y]},getItem:function(y){return this[y]}});var s=JSON.stringifyAsync||function(y,h,f,u){var i;try{h(i,JSON.stringify(y,f,u))}catch(d){h(d)}};Gun.on("create",function y(h){this.to.next(h);var f=h.opt;h.graph;var u=[],i,d,_,r;if(f.localStorage===!1)return;f.prefix=f.file||"gun/";try{i=y[f.prefix]=y[f.prefix]||JSON.parse(_=a.getItem(f.prefix))||{}}catch{i=y[f.prefix]={}}_=(_||"").length,h.on("get",function(c){this.to.next(c);var w=c.get,n,t,l,p;!w||!(n=w["#"])||(t=i[n]||p,t&&(l=w["."])&&!Object.plain(l)&&(t=Gun.state.ify({},l,Gun.state.is(t,l),t[l],n)),Gun.on.get.ack(c,t))}),h.on("put",function(c){this.to.next(c);var w=c.put,n=w["#"],t=w["."],l=c["#"],p=c.ok||"";if(i[n]=Gun.state.ify(i[n],t,w[">"],w[":"],n),r&&_>4999880){h.on("in",{"@":l,err:"localStorage max!"});return}!c["@"]&&(!c._.via||Math.random()<p["@"]/p["/"])&&u.push(l),!d&&(d=setTimeout(v,9+_/333))});function v(){if(!u.length&&((setTimeout.turn||"").s||"").length){setTimeout(v,99);return}var c=u;clearTimeout(d),d=!1,u=[],s(i,function(w,n){try{!w&&a.setItem(f.prefix,n)}catch(t){w=r=t||"localStorage failure"}w&&(Gun.log(w+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),h.on("localStorage:error",{err:w,get:f.prefix,put:i})),_=n.length,setTimeout.each(c,function(t){h.on("in",{"@":t,err:w,ok:0})},0,99)})}})}})(b,"./localStorage")})(),function(){var B;if(""+B!=typeof Gun){var b=function(g){console.warn("Warning! Deprecated internal utility will break in next version:",g)},N=Gun;N.fn=N.fn||{is:function(g){return b("fn"),!!g&&typeof g=="function"}},N.bi=N.bi||{is:function(g){return b("bi"),g instanceof Boolean||typeof g=="boolean"}},N.num=N.num||{is:function(g){return b("num"),!G(g)&&(g-parseFloat(g)+1>=0||g===1/0||g===-1/0)}},N.text=N.text||{is:function(g){return b("text"),typeof g=="string"}},N.text.ify=N.text.ify||function(g){return b("text.ify"),N.text.is(g)?g:typeof JSON<"u"?JSON.stringify(g):g&&g.toString?g.toString():g},N.text.random=N.text.random||function(g,o){b("text.random");var x="";for(g=g||24,o=o||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";g>0;)x+=o.charAt(Math.floor(Math.random()*o.length)),g--;return x},N.text.match=N.text.match||function(g,o){var x,j;return b("text.match"),typeof g!="string"?!1:(typeof o=="string"&&(o={"=":o}),o=o||{},x=o["="]||o["*"]||o[">"]||o["<"],g===x?!0:j!==o["="]?!1:(x=o["*"]||o[">"]||o["<"],g.slice(0,(x||"").length)===x?!0:j!==o["*"]?!1:j!==o[">"]&&j!==o["<"]?g>=o[">"]&&g<=o["<"]:j!==o[">"]&&g>=o[">"]||j!==o["<"]&&g<=o["<"]))},N.text.hash=N.text.hash||function(g,o){if(b("text.hash"),typeof g=="string"){if(o=o||0,!g.length)return o;for(var x=0,j=g.length,E;x<j;++x)E=g.charCodeAt(x),o=(o<<5)-o+E,o|=0;return o}},N.list=N.list||{is:function(g){return b("list"),g instanceof Array}},N.list.slit=N.list.slit||Array.prototype.slice,N.list.sort=N.list.sort||function(g){return b("list.sort"),function(o,x){return!o||!x?0:(o=o[g],x=x[g],o<x?-1:o>x?1:0)}},N.list.map=N.list.map||function(g,o,x){return b("list.map"),T(g,o,x)},N.list.index=1,N.obj=N.boj||{is:function(g){return b("obj"),g?g instanceof Object&&g.constructor===Object||Object.prototype.toString.call(g).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},N.obj.put=N.obj.put||function(g,o,x){return b("obj.put"),(g||{})[o]=x,g},N.obj.has=N.obj.has||function(g,o){return b("obj.has"),g&&Object.prototype.hasOwnProperty.call(g,o)},N.obj.del=N.obj.del||function(g,o){if(b("obj.del"),!!g)return g[o]=null,delete g[o],g},N.obj.as=N.obj.as||function(g,o,x,j){return b("obj.as"),g[o]=g[o]||(j===x?{}:x)},N.obj.ify=N.obj.ify||function(g){if(b("obj.ify"),l(g))return g;try{g=JSON.parse(g)}catch{g={}}return g},function(){var g;function o(x,j){k(this,j)&&g!==this[j]||(this[j]=x)}N.obj.to=N.obj.to||function(x,j){return b("obj.to"),j=j||{},T(x,o,j),j}}(),N.obj.copy=N.obj.copy||function(g){return b("obj.copy"),g&&JSON.parse(JSON.stringify(g))},function(){function g(o,x){var j=this.n,E;if(!(j&&(x===j||l(j)&&k(j,x)))&&E!==x)return!0}N.obj.empty=N.obj.empty||function(o,x){return b("obj.empty"),o?!T(o,g,{n:x}):!0}}(),function(){function g(j,E){if(arguments.length===2){g.r=g.r||{},g.r[j]=E;return}g.r=g.r||[],g.r.push(j)}var o=Object.keys,x;Object.keys=Object.keys||function(j){return x(j,function(E,$,D){D($)})},N.obj.map=x=N.obj.map||function(j,E,$){b("obj.map");var D,O=0,S,C,P,M,V=typeof E=="function";if(g.r=D,o&&l(j)&&(P=o(j),M=!0),$=$||{},G(j)||P)for(S=(P||j).length;O<S;O++){var q=O+N.list.index;if(V){if(C=M?E.call($,j[P[O]],P[O],g):E.call($,j[O],q,g),C!==D)return C}else if(E===j[M?P[O]:O])return P?P[O]:q}else for(O in j)if(V){if(k(j,O)&&(C=$?E.call($,j[O],O,g):E(j[O],O,g),C!==D))return C}else if(E===j[O])return O;return V?g.r:N.list.index?0:-1}}(),N.time=N.time||{},N.time.is=N.time.is||function(g){return b("time"),g?g instanceof Date:+new Date().getTime()};var n=N.fn.is,G=N.list.is,t=N.obj,l=t.is,k=t.has,T=t.map,e={};e.is=function(g){return b("val.is"),g===B?!1:g===null?!0:g===1/0?!1:y(g)||s(g)||r(g)?!0:e.link.is(g)||!1},e.link=e.rel={_:"#"},function(){e.link.is=function(o){if(b("val.link.is"),o&&o[a]&&!o._&&l(o)){var x={};if(T(o,g,x),x.id)return x.id}return!1};function g(o,x){var j=this;if(j.id)return j.id=!1;if(x==a&&y(o))j.id=o;else return j.id=!1}}(),e.link.ify=function(g){return b("val.link.ify"),A({},a,g)},N.obj.has._=".";var a=e.link._,B,s=N.bi.is,r=N.num.is,y=N.text.is,t=N.obj,l=t.is,A=t.put,T=t.map;N.val=N.val||e;var h={_:"_"};h.soul=function(g,o){return b("node.soul"),g&&g._&&g._[o||i]},h.soul.ify=function(g,o){return b("node.soul.ify"),o=typeof o=="string"?{soul:o}:o||{},g=g||{},g._=g._||{},g._[i]=o.soul||g._[i]||u(),g},h.soul._=e.link._,function(){h.is=function(o,x,j){b("node.is");var E;return l(o)&&(E=h.soul(o))?!T(o,g,{as:j,cb:x,s:E,n:o}):!1};function g(o,x){if(x!==h._){if(!e.is(o))return!0;this.cb&&this.cb.call(this.as,o,x,this.n,this.s)}}}(),function(){h.ify=function(o,x,j){return b("node.ify"),x?typeof x=="string"?x={soul:x}:typeof x=="function"&&(x={map:x}):x={},x.map&&(x.node=x.map.call(j,o,B,x.node||{})),(x.node=h.soul.ify(x.node||{},x))&&T(o,g,{o:x,as:j}),x.node};function g(o,x){var j=this.o,E,$;if(j.map){E=j.map.call(this.as,o,""+x,j.node),$===E?p(j.node,x):j.node&&(j.node[x]=E);return}e.is(o)&&(j.node[x]=o)}}();var t=N.obj,l=t.is,p=t.del,T=t.map,f=N.text,u=f.random,i=h.soul._,B;N.node=N.node||h;var d=N.state;d.lex=function(){return b("state.lex"),d().toString(36).replace(".","")},d.to=function(g,o,x){b("state.to");var j=(g||{})[o];return l(j)&&(j=I(j)),d.ify(x,o,d.is(g,o),j,h.soul(g))},function(){d.map=function(o,x,j){b("state.map");var E,$=l($=o||x)?$:null;return o=n(o=o||x)?o:null,$&&!o?(x=r(x)?x:d(),$[c]=$[c]||{},T($,g,{o:$,s:x}),$):(j=j||l(x)?x:E,x=r(x)?x:d(),function(D,O,S,C){if(!o)return g.call({o:S,s:x},D,O),D;o.call(j||this||{},D,O,S,C),!(k(S,O)&&E===S[O])&&g.call({o:S,s:x},D,O)})};function g(o,x){c!==x&&d.ify(this.o,x,this.s)}}();var t=N.obj;t.as;var k=t.has,l=t.is,T=t.map,I=t.copy,_=N.num,r=_.is,v=N.fn,n=v.is,c=h._,B,w={};(function(){w.is=function(x,j,E,$){return b("graph.is"),!x||!l(x)||m(x)?!1:!T(x,g,{cb:j,fn:E,as:$})};function g(x,j){if(!x||j!==h.soul(x)||!h.is(x,this.fn,this.as))return!0;this.cb&&(o.n=x,o.as=this.as,this.cb.call(o.as,x,j,o))}function o(x){x&&h.is(o.n,x,o.as)}})(),function(){w.ify=function($,D,O){b("graph.ify");var S={path:[],obj:$};return D?typeof D=="string"?D={soul:D}:typeof D=="function"&&(D.map=D):D={},typeof O=="string"&&(D.soul=D.soul||O,O=B),D.soul&&(S.link=e.link.ify(D.soul)),D.shell=(O||{}).shell,D.graph=D.graph||{},D.seen=D.seen||[],D.as=D.as||O,g(D,S),D.root=S.node,D.graph};function g($,D){var O;return(O=E($,D))?O:(D.env=$,D.soul=x,h.ify(D.obj,o,D)&&(D.link=D.link||e.link.ify(h.soul(D.node)),D.obj!==$.shell&&($.graph[e.link.is(D.link)]=D.node)),D)}function o($,D,O){var S=this,C=S.env,P,M;if(h._===D&&k($,e.link._))return O._;if(P=j($,D,O,S,C)){if(D||(S.node=S.node||O||{},k($,h._)&&h.soul($)&&(S.node._=I($._)),S.node=h.soul.ify(S.node,e.link.is(S.link)),S.link=S.link||e.link.ify(h.soul(S.node))),(M=C.map)&&(M.call(C.as||{},$,D,O,S),k(O,D))){if($=O[D],B===$){p(O,D);return}if(!(P=j($,D,O,S,C)))return}if(!D)return S.node;if(P===!0)return $;if(M=g(C,{obj:$,path:S.path.concat(D)}),!!M.node)return M.link}}function x($){var D=this,O=e.link.is(D.link),S=D.env.graph;D.link=D.link||e.link.ify($),D.link[e.link._]=$,D.node&&D.node[h._]&&(D.node[h._][e.link._]=$),k(S,O)&&(S[$]=S[O],p(S,O))}function j($,D,O,S,C){var P;if(e.is($))return!0;if(l($))return 1;if(P=C.invalid)return $=P.call(C.as||{},$,D,O),j($,D,O,S,C);C.err="Invalid value at '"+S.path.concat(D).join(".")+"'!",N.list.is($)&&(C.err+=" Use `.set(item)` instead of an Array.")}function E($,D){for(var O=$.seen,S=O.length,C;S--;)if(C=O[S],D.obj===C.obj)return C;O.push(D)}}(),w.node=function(g){b("graph.node");var o=h.soul(g);if(o)return A({},o,g)},function(){w.to=function(o,x,j){if(b("graph.to"),!!o){var E={};return j=j||{seen:{}},T(o[x],g,{obj:E,graph:o,opt:j}),E}};function g(o,x){var j,E;if(h._===x){if(m(o,e.link._))return;this.obj[x]=I(o);return}if(!(j=e.link.is(o))){this.obj[x]=o;return}if(E=this.opt.seen[j]){this.obj[x]=E;return}this.obj[x]=this.opt.seen[j]=w.to(this.graph,j,this.opt)}}();var n=N.fn.is,t=N.obj,l=t.is,p=t.del,k=t.has,m=t.empty,A=t.put,T=t.map,I=t.copy,B;N.graph=N.graph||w}}()}(at)),at.exports}var ct,mt;function Gt(){return mt||(mt=1,ct=ht()),ct}var Nt=Gt();const It=Bt(Nt);var ft={exports:{}};ft.exports;var kt;function Pt(){return kt||(kt=1,function(F){(function(){function b(G,e){return e?At(G):G.slice?b[a(G)]:function(s,y){G(s={exports:{}}),b[a(y)]=s.exports};function a(s){return s.split("/").slice(-1).toString().replace(".js","")}}var N=F;b(function(G){typeof self<"u"&&(G.window=self),typeof window<"u"&&(G.window=window);var e=G.window||G,a,s=e.SEA||{};(s.window=G.window)&&(s.window.SEA=s);try{a+""!=typeof N&&(N.exports=s)}catch{}G.exports=s})(b,"./root"),b(function(G){var e=b("./root");try{e.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(b,"./https"),b(function(G){var e;if(e+""==typeof btoa){if(e+""==typeof Buffer)try{lt.Buffer=b("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}lt.btoa=function(a){return Buffer.from(a,"binary").toString("base64")},lt.atob=function(a){return Buffer.from(a,"base64").toString("binary")}}})(b,"./base64"),b(function(G){b("./base64");function e(){}Object.assign(e,{from:Array.from}),e.prototype=Object.create(Array.prototype),e.prototype.toString=function(a,s,y){a=a||"utf8",s=s||0;const h=this.length;if(a==="hex"){const f=new Uint8Array(this);return[...Array((y&&y+1||h)-s).keys()].map(u=>f[u+s].toString(16).padStart(2,"0")).join("")}if(a==="utf8")return Array.from({length:(y||h)-s},(f,u)=>String.fromCharCode(this[u+s])).join("");if(a==="base64")return btoa(this)},G.exports=e})(b,"./array"),b(function(G){b("./base64");var e=b("./array");function a(...s){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),a.from(...s)}a.prototype=Object.create(Array.prototype),Object.assign(a,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const s=arguments[0];let y;if(typeof s=="string"){const f=arguments[1]||"utf8";if(f==="hex"){const u=s.match(/([\da-fA-F]{2})/g).map(i=>parseInt(i,16));if(!u||!u.length)throw new TypeError("Invalid first argument for type 'hex'.");y=e.from(u)}else if(f==="utf8"||f==="binary"){const u=s.length,i=new Uint16Array(u);Array.from({length:u},(d,_)=>i[_]=s.charCodeAt(_)),y=e.from(i)}else if(f==="base64"){const u=atob(s),i=u.length,d=new Uint8Array(i);Array.from({length:i},(_,r)=>d[r]=u.charCodeAt(r)),y=e.from(d)}else f==="binary"?y=e.from(s):console.info("SafeBuffer.from unknown encoding: "+f);return y}if(s.byteLength,s.byteLength?s.byteLength:s.length){let f;return s instanceof ArrayBuffer&&(f=new Uint8Array(s)),e.from(f||s)}},alloc(s,y=0){return e.from(new Uint8Array(Array.from({length:s},()=>y)))},allocUnsafe(s){return e.from(new Uint8Array(Array.from({length:s})))},concat(s){if(!Array.isArray(s))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return e.from(s.reduce((y,h)=>y.concat(Array.from(h)),[]))}}),a.prototype.from=a.from,a.prototype.toString=e.prototype.toString,G.exports=a})(b,"./buffer"),b(function(G){const e=b("./root"),a={Buffer:b("./buffer")};var s={},y;if(JSON.parseAsync=JSON.parseAsync||function(f,u,i){var d;try{u(d,JSON.parse(f,i))}catch(_){u(_)}},JSON.stringifyAsync=JSON.stringifyAsync||function(f,u,i,d){var _;try{u(_,JSON.stringify(f,i,d))}catch(r){u(r)}},a.parse=function(f,u){return new Promise(function(i,d){JSON.parseAsync(f,function(_,r){_?d(_):i(r)},u)})},a.stringify=function(f,u,i){return new Promise(function(d,_){JSON.stringifyAsync(f,function(r,v){r?_(r):d(v)},u,i)})},e.window&&(a.crypto=e.window.crypto||e.window.msCrypto,a.subtle=(a.crypto||s).subtle||(a.crypto||s).webkitSubtle,a.TextEncoder=e.window.TextEncoder,a.TextDecoder=e.window.TextDecoder,a.random=f=>a.Buffer.from(a.crypto.getRandomValues(new Uint8Array(a.Buffer.alloc(f))))),!a.TextDecoder){const{TextEncoder:f,TextDecoder:u}=b((y+""==typeof N?".":"")+"./lib/text-encoding",1);a.TextDecoder=u,a.TextEncoder=f}if(!a.crypto)try{var h=b("crypto",1);Object.assign(a,{crypto:h,random:u=>a.Buffer.from(h.randomBytes(u))});const{Crypto:f}=b("@peculiar/webcrypto",1);a.ossl=a.subtle=new f({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}G.exports=a})(b,"./shim"),b(function(G){var e=b("./root"),a=b("./shim"),s={};s.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},s.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},s.ecdh={name:"ECDH",namedCurve:"P-256"},s.jwk=function(y,h){y=y.split(".");var f=y[0],u=y[1],i={kty:"EC",crv:"P-256",x:f,y:u,ext:!0};return i.key_ops=h?["sign"]:["verify"],h&&(i.d=h),i},s.keyToJwk=function(y){return{kty:"oct",k:y.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},s.recall={validity:12*60*60,hook:function(y){return y}},s.check=function(y){return typeof y=="string"&&y.slice(0,4)==="SEA{"},s.parse=async function(h){try{var f=typeof h=="string";return f&&h.slice(0,4)==="SEA{"&&(h=h.slice(3)),f?await a.parse(h):h}catch{}return h},e.opt=s,G.exports=s})(b,"./settings"),b(function(G){var e=b("./shim");G.exports=async function(a,s){var y=typeof a=="string"?a:await e.stringify(a),h=await e.subtle.digest({name:s||"SHA-256"},new e.TextEncoder().encode(y));return e.Buffer.from(h)}})(b,"./sha256"),b(function(G){const e=b("./shim"),a=e.subtle,s=e.ossl?e.ossl:a,y=h=>s.digest({name:"SHA-1"},new ArrayBuffer(h));G.exports=y})(b,"./sha1"),b(function(G){var e=b("./root"),a=b("./shim"),s=b("./settings"),y=b("./sha256"),h;e.work=e.work||(async(f,u,i,d)=>{try{var _=(u||{}).epub||u;if(d=d||{},_ instanceof Function&&(i=_,_=h),f=typeof f=="string"?f:await a.stringify(f),(d.name||"").toLowerCase().slice(0,3)==="sha"){var r=a.Buffer.from(await y(f,d.name),"binary").toString(d.encode||"base64");if(i)try{i(r)}catch(n){console.log(n)}return r}_=_||a.random(9);var v=await(a.ossl||a.subtle).importKey("raw",new a.TextEncoder().encode(f),{name:d.name||"PBKDF2"},!1,["deriveBits"]),c=await(a.ossl||a.subtle).deriveBits({name:d.name||"PBKDF2",iterations:d.iterations||s.pbkdf2.iter,salt:new a.TextEncoder().encode(d.salt||_),hash:d.hash||s.pbkdf2.hash},v,d.length||s.pbkdf2.ks*8);f=a.random(f.length);var w=a.Buffer.from(c,"binary").toString(d.encode||"base64");if(i)try{i(w)}catch(n){console.log(n)}return w}catch(n){if(console.log(n),e.err=n,e.throw)throw n;i&&i();return}}),G.exports=e.work})(b,"./work"),b(function(G){var e=b("./root"),a=b("./shim");b("./settings"),e.name=e.name||(async(s,y)=>{try{if(s)try{s()}catch(h){console.log(h)}return}catch(h){if(console.log(h),e.err=h,e.throw)throw h;s&&s();return}}),e.pair=e.pair||(async(s,y)=>{try{var h=a.ossl||a.subtle,f=await a.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async d=>{var _={};_.priv=(await a.subtle.exportKey("jwk",d.privateKey)).d;var r=await a.subtle.exportKey("jwk",d.publicKey);return _.pub=r.x+"."+r.y,_});try{var u=await h.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async d=>{var _={};_.epriv=(await h.exportKey("jwk",d.privateKey)).d;var r=await h.exportKey("jwk",d.publicKey);return _.epub=r.x+"."+r.y,_})}catch(d){if(e.window)throw d;if(d=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw d}u=u||{};var i={pub:f.pub,priv:f.priv,epub:u.epub,epriv:u.epriv};if(s)try{s(i)}catch(d){console.log(d)}return i}catch(d){if(console.log(d),e.err=d,e.throw)throw d;s&&s();return}}),G.exports=e.pair})(b,"./pair"),b(function(G){var e=b("./root"),a=b("./shim"),s=b("./settings"),y=b("./sha256"),h;e.sign=e.sign||(async(f,u,i,d)=>{try{if(d=d||{},!(u||d).priv){if(!e.I)throw"No signing key.";u=await e.I(null,{what:f,how:"sign",why:d.why})}if(h===f)throw"`undefined` not allowed.";var _=await s.parse(f),r=d.check=d.check||_;if(e.verify&&(e.opt.check(r)||r&&r.s&&r.m)&&h!==await e.verify(r,u)){var l=await s.parse(r);if(d.raw||(l="SEA"+await a.stringify(l)),i)try{i(l)}catch(k){console.log(k)}return l}var v=u.pub,c=u.priv,w=s.jwk(v,c),n=await y(_),t=await(a.ossl||a.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(p=>(a.ossl||a.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},p,new Uint8Array(n))),l={m:_,s:a.Buffer.from(t,"binary").toString(d.encode||"base64")};if(d.raw||(l="SEA"+await a.stringify(l)),i)try{i(l)}catch(p){console.log(p)}return l}catch(p){if(console.log(p),e.err=p,e.throw)throw p;i&&i();return}}),G.exports=e.sign})(b,"./sign"),b(function(G){var e=b("./root"),a=b("./shim"),s=b("./settings"),y=b("./sha256"),h;e.verify=e.verify||(async(i,d,_,r)=>{try{var v=await s.parse(i);if(d===!1){var c=await s.parse(v.m);if(_)try{_(c)}catch(T){console.log(T)}return c}r=r||{};var w=d.pub||d,n=e.opt.slow_leak?await e.opt.slow_leak(w):await(a.ossl||a.subtle).importKey("jwk",s.jwk(w),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),t=await y(v.m),l,p,k,m;try{if(l=a.Buffer.from(v.s,r.encode||"base64"),p=new Uint8Array(l),k=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,p,new Uint8Array(t)),!k)throw"Signature did not match."}catch{if(e.opt.fallback)return await e.opt.fall_verify(i,d,_,r)}var A=k?await s.parse(v.m):h;if(_)try{_(A)}catch(T){console.log(T)}return A}catch(T){if(console.log(T),e.err=T,e.throw)throw T;_&&_();return}}),G.exports=e.verify;var f={};e.opt.slow_leak=i=>{if(f[i])return f[i];var d=s.jwk(i);return f[i]=(a.ossl||a.subtle).importKey("jwk",d,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),f[i]};var u=e.opt;e.opt.fall_verify=async function(i,d,_,r,v){if(v===e.opt.fallback)throw"Signature did not match";v=v||1;var c=i||"";i=e.opt.unpack(i)||i;var w=await s.parse(i),n=d.pub||d,t=await e.opt.slow_leak(n),l=v<=e.opt.fallback?a.Buffer.from(await a.subtle.digest({name:"SHA-256"},new a.TextEncoder().encode(await s.parse(w.m)))):await y(w.m),p,k,m;try{if(p=a.Buffer.from(w.s,r.encode||"base64"),k=new Uint8Array(p),m=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},t,k,new Uint8Array(l)),!m)throw"Signature did not match."}catch{try{p=a.Buffer.from(w.s,"utf8"),k=new Uint8Array(p),m=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},t,k,new Uint8Array(l))}catch{if(!m)throw"Signature did not match."}}var A=m?await s.parse(w.m):h;if(u.fall_soul=c["#"],u.fall_key=c["."],u.fall_val=i,u.fall_state=c[">"],_)try{_(A)}catch(T){console.log(T)}return A},e.opt.fallback=2})(b,"./verify"),b(function(G){var e=b("./shim"),a=b("./settings"),s=b("./sha256");const y=async(h,f,u)=>{const i=h+(f||e.random(8)).toString("utf8"),d=e.Buffer.from(await s(i),"binary"),_=a.keyToJwk(d);return await e.subtle.importKey("jwk",_,{name:"AES-GCM"},!1,["encrypt","decrypt"])};G.exports=y})(b,"./aeskey"),b(function(G){var e=b("./root"),a=b("./shim");b("./settings");var s=b("./aeskey"),y;e.encrypt=e.encrypt||(async(h,f,u,i)=>{try{i=i||{};var d=(f||i).epriv||f;if(y===h)throw"`undefined` not allowed.";if(!d){if(!e.I)throw"No encryption key.";f=await e.I(null,{what:h,how:"encrypt",why:i.why}),d=f.epriv||f}var _=typeof h=="string"?h:await a.stringify(h),r={s:a.random(9),iv:a.random(15)},v=await s(d,r.s,i).then(w=>a.subtle.encrypt({name:i.name||"AES-GCM",iv:new Uint8Array(r.iv)},w,new a.TextEncoder().encode(_))),c={ct:a.Buffer.from(v,"binary").toString(i.encode||"base64"),iv:r.iv.toString(i.encode||"base64"),s:r.s.toString(i.encode||"base64")};if(i.raw||(c="SEA"+await a.stringify(c)),u)try{u(c)}catch(w){console.log(w)}return c}catch(w){if(console.log(w),e.err=w,e.throw)throw w;u&&u();return}}),G.exports=e.encrypt})(b,"./encrypt"),b(function(G){var e=b("./root"),a=b("./shim"),s=b("./settings"),y=b("./aeskey");e.decrypt=e.decrypt||(async(h,f,u,i)=>{try{i=i||{};var d=(f||i).epriv||f;if(!d){if(!e.I)throw"No decryption key.";f=await e.I(null,{what:h,how:"decrypt",why:i.why}),d=f.epriv||f}var _=await s.parse(h),r,v,c;try{r=a.Buffer.from(_.s,i.encode||"base64"),v=a.Buffer.from(_.iv,i.encode||"base64"),c=a.Buffer.from(_.ct,i.encode||"base64");var w=await y(d,r,i).then(t=>a.subtle.decrypt({name:i.name||"AES-GCM",iv:new Uint8Array(v),tagLength:128},t,new Uint8Array(c)))}catch{if(i.encode==="utf8")throw"Could not decrypt";if(e.opt.fallback)return i.encode="utf8",await e.decrypt(h,f,u,i)}var n=await s.parse(new a.TextDecoder("utf8").decode(w));if(u)try{u(n)}catch(t){console.log(t)}return n}catch(t){if(console.log(t),e.err=t,e.throw)throw t;u&&u();return}}),G.exports=e.decrypt})(b,"./decrypt"),b(function(G){var e=b("./root"),a=b("./shim");b("./settings"),e.secret=e.secret||(async(y,h,f,u)=>{try{if(u=u||{},!h||!h.epriv||!h.epub){if(!e.I)throw"No secret mix.";h=await e.I(null,{what:y,how:"secret",why:u.why})}var i=y.epub||y,d=h.epub,_=h.epriv,r=a.ossl||a.subtle,v=s(i),c=Object.assign({public:await r.importKey(...v,!0,[])},{name:"ECDH",namedCurve:"P-256"}),w=s(d,_),n=await r.importKey(...w,!1,["deriveBits"]).then(async l=>{var p=await r.deriveBits(c,l,256),k=new Uint8Array(p),m=await r.importKey("raw",k,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return r.exportKey("jwk",m).then(({k:A})=>A)}),t=n;if(f)try{f(t)}catch(l){console.log(l)}return t}catch(l){if(console.log(l),e.err=l,e.throw)throw l;f&&f();return}});var s=(y,h)=>{var[f,u]=y.split("."),i=h?{d:h}:{};return["jwk",Object.assign(i,{x:f,y:u,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};G.exports=e.secret})(b,"./secret"),b(function(G){var e=b("./root");e.certify=e.certify||(async(a,s={},y,h,f={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),a=(()=>{var t=[];if(a){if((typeof a=="string"||Array.isArray(a))&&a.indexOf("*")>-1)return"*";if(typeof a=="string")return a;if(Array.isArray(a)){if(a.length===1&&a[0])return typeof a[0]=="object"&&a[0].pub?a[0].pub:typeof a[0]=="string"?a[0]:null;a.map(l=>{typeof l=="string"?t.push(l):typeof l=="object"&&l.pub&&t.push(l.pub)})}return typeof a=="object"&&a.pub?a.pub:t.length>0?t:null}})(),!a)return console.log("No certificant found.");const i=f.expiry&&(typeof f.expiry=="number"||typeof f.expiry=="string")?parseFloat(f.expiry):null,d=(s||{}).read?s.read:null,_=(s||{}).write?s.write:typeof s=="string"||Array.isArray(s)||s["+"]||s["#"]||s["."]||s["="]||s["*"]||s[">"]||s["<"]?s:null,r=(f||{}).block||(f||{}).blacklist||(f||{}).ban||{},v=r.read&&(typeof r.read=="string"||(r.read||{})["#"])?r.read:null,c=typeof r=="string"?r:r.write&&(typeof r.write=="string"||r.write["#"])?r.write:null;if(!d&&!_)return console.log("No policy found.");const w=JSON.stringify({c:a,...i?{e:i}:{},...d?{r:d}:{},..._?{w:_}:{},...v?{rb:v}:{},...c?{wb:c}:{}});var u=await e.sign(w,y,null,{raw:1});if(f.raw||(u="SEA"+JSON.stringify(u)),h)try{h(u)}catch(t){console.log(t)}return u}catch(i){if(e.err=i,e.throw)throw i;h&&h();return}}),G.exports=e.certify})(b,"./certify"),b(function(G){var e=b("./shim"),a=b("./root");a.work=b("./work"),a.sign=b("./sign"),a.verify=b("./verify"),a.encrypt=b("./encrypt"),a.decrypt=b("./decrypt"),a.certify=b("./certify"),a.random=a.random||e.random,a.Buffer=a.Buffer||b("./buffer"),a.keyid=a.keyid||(async s=>{try{const y=e.Buffer.concat(s.replace(/-/g,"+").replace(/_/g,"/").split(".").map(i=>e.Buffer.from(i,"base64"))),h=e.Buffer.concat([e.Buffer.from([153,y.length/256,y.length%256]),y]),f=await sha1hash(h),u=e.Buffer.from(f,"binary");return u.toString("hex",u.length-8)}catch(y){throw console.log(y),y}}),((a.window||{}).GUN||{}).SEA=a,G.exports=a})(b,"./sea"),b(function(G){var e=b("./sea"),a,s;e.window?a=e.window.GUN||{chain:{}}:a=b((s+""==typeof N?".":"")+"./gun",1),e.GUN=a;function y(f){this._={$:this}}y.prototype=function(){function f(){}return f.prototype=a.chain,new f}(),y.prototype.constructor=y,a.chain.user=function(f){var u=this,d=u.back(-1),i;if(f)return f=e.opt.pub((f._||"")["#"])||f,d.get("~"+f);if(i=d.back("user"))return i;var d=d._,_=d,r=_.opt.uuid||h;return(_=(i=_.user=u.chain(new y))._).opt={},_.opt.uuid=function(v){var c=r(),w=d.user;return!w||!(w=w.is)||!(w=w.pub)||(c="~"+w+"/"+c,v&&v.call&&v(null,c)),c},i};function h(){return a.state().toString(36).replace(".","")}a.User=y,y.GUN=a,y.SEA=a.SEA=e,G.exports=y})(b,"./user"),b(function(G){var e,a=""+e!=typeof GUN?GUN||{chain:{}}:b((""+e==typeof N?".":"")+"./gun",1);a.chain.then=function(s,y){var h=this,f=new Promise(function(u,i){h.once(u,y)});return s?f.then(s):f}})(b,"./then"),b(function(G){var e=b("./user"),a=e.SEA,s=e.GUN,y=function(){};e.prototype.create=function(...h){var f=typeof h[0]=="object"&&(h[0].pub||h[0].epub)?h[0]:typeof h[1]=="object"&&(h[1].pub||h[1].epub)?h[1]:null,u=f&&(f.pub||f.epub)?f.pub:typeof h[0]=="string"?h[0]:null,i=f&&(f.pub||f.epub)?f:u&&typeof h[1]=="string"?h[1]:null,d=h.filter(t=>typeof t=="function")[0]||null,_=h&&h.length>1&&typeof h[h.length-1]=="object"?h[h.length-1]:{},r=this,v=r._,c=r.back(-1);if(d=d||y,_=_||{},_.check!==!1){var w;if(u||(w="No user."),(i||"").length<8&&(w="Password too short!"),w)return d({err:s.log(w)}),r}if(v.ing)return(d||y)({err:s.log("User is already being created or authenticated!"),wait:!0}),r;v.ing=!0;var n={};return n.a=function(t){if(n.pubs=t,t&&!_.already){var l={err:s.log("User already created!")};v.ing=!1,(d||y)(l),r.leave();return}n.salt=String.random(64),a.work(i,n.salt,n.b)},n.b=function(t){n.proof=t,f?n.c(f):a.pair(n.c)},n.c=function(t){var l;n.pair=t||{},(l=v.root.user)&&(l._.sea=t,l.is={pub:t.pub,epub:t.epub,alias:u}),n.data={pub:t.pub},n.d()},n.d=function(){n.data.alias=u,n.e()},n.e=function(){n.data.epub=n.pair.epub,a.encrypt({priv:n.pair.priv,epriv:n.pair.epriv},n.proof,n.f,{raw:1})},n.f=function(t){n.data.auth=JSON.stringify({ek:t,s:n.salt}),n.g(n.data.auth)},n.g=function(t){var l;n.data.auth=n.data.auth||t,c.get(l="~"+n.pair.pub).put(n.data).on(n.h);var p={};p[l]={"#":l},c.get("~@"+u).put(p).get(l).on(n.i)},n.h=function(t,l,p,k){k.off(),n.h.ok=1,n.i()},n.i=function(t,l,p,k){k&&(n.i.ok=1,k.off()),!(!n.h.ok||!n.i.ok)&&(v.ing=!1,d({ok:0,pub:n.pair.pub}),y===d&&(f?r.auth(f):r.auth(u,i)))},c.get("~@"+u).once(n.a),r},e.prototype.leave=function(h,f){var u=this,i=u.back(-1)._.user;if(i&&(delete i.is,delete i._.is,delete i._.sea),a.window)try{var d={};d=a.window.sessionStorage,delete d.recall,delete d.pair}catch{}return u}})(b,"./create"),b(function(G){var e=b("./user"),a=e.SEA,s=e.GUN,y=function(){};e.prototype.auth=function(...f){var u=typeof f[0]=="object"&&(f[0].pub||f[0].epub)?f[0]:typeof f[1]=="object"&&(f[1].pub||f[1].epub)?f[1]:null,i=!u&&typeof f[0]=="string"?f[0]:null,d=(i||u&&!(u.priv&&u.epriv))&&typeof f[1]=="string"?f[1]:null,_=f.filter(p=>typeof p=="function")[0]||null,r=f&&f.length>1&&typeof f[f.length-1]=="object"?f[f.length-1]:{},v=this,c=v._,w=v.back(-1);if(c.ing)return(_||y)({err:s.log("User is already being created or authenticated!"),wait:!0}),v;c.ing=!0;var n={},t,l=9;return n.a=function(p){if(!p)return n.b();if(!p.pub){var k=[];return Object.keys(p).forEach(function(m){m!="_"&&k.push(p[m])}),n.b(k)}if(n.name)return n.f(p);n.c((n.data=p).auth)},n.b=function(p){var k=(n.list=(n.list||[]).concat(p||[])).shift();if(t===k){if(n.name)return n.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(i&&l--){w.get("~@"+i).once(n.a);return}return n.err("Wrong user or password.")}w.get(k).once(n.a)},n.c=function(p){if(t===p)return n.b();if(typeof p=="string")return n.c(h(p));a.work(d,(n.auth=p).s,n.d,n.enc)},n.d=function(p){a.decrypt(n.auth.ek,p,n.e,n.enc)},n.e=function(p){if(t===p)return n.enc?(n.enc=null,n.b()):(n.enc={encode:"utf8"},n.c(n.auth));n.half=p,n.f(n.data)},n.f=function(p){var k=n.half||{},m=n.data||{};n.g(n.lol={pub:p.pub||m.pub,epub:p.epub||m.epub,priv:p.priv||k.priv,epriv:p.epriv||k.epriv})},n.g=function(p){if(!p||!p.pub||!p.epub)return n.b();n.pair=p;var k=w._.user,m=k._;m.tag;var A=m.opt;m=k._=w.get("~"+p.pub)._,m.opt=A,k.is={pub:p.pub,epub:p.epub,alias:i||p.pub},m.sea=n.pair,c.ing=!1;try{d&&t==(h(c.root.graph["~"+p.pub].auth)||"")[":"]&&(r.shuffle=r.change=d)}catch{}if(r.change?n.z():(_||y)(m),a.window&&(v.back("user")._.opt||r).remember)try{var T={};T=a.window.sessionStorage,T.recall=!0,T.pair=JSON.stringify(p)}catch{}try{w._.tag.auth?w._.on("auth",m):setTimeout(function(){w._.on("auth",m)},1)}catch(I){s.log("Your 'auth' callback crashed with:",I)}},n.h=function(p){if(!p)return n.b();if(i=p.alias,i||(i=p.alias="~"+u.pub),!p.auth)return n.g(u);u=null,n.c((n.data=p).auth)},n.z=function(){n.salt=String.random(64),a.work(r.change,n.salt,n.y)},n.y=function(p){a.encrypt({priv:n.pair.priv,epriv:n.pair.epriv},p,n.x,{raw:1})},n.x=function(p){n.w(JSON.stringify({ek:p,s:n.salt}))},n.w=function(p){if(r.shuffle){console.log("migrate core account from UTF8 & shuffle");var k={};Object.keys(n.data).forEach(function(m){k[m]=n.data[m]}),delete k._,k.auth=p,w.get("~"+n.pair.pub).put(k)}w.get("~"+n.pair.pub).get("auth").put(p,_||y)},n.err=function(p){var k={err:s.log(p||"User cannot be found!")};c.ing=!1,(_||y)(k)},n.plugin=function(p){if(!(n.name=p))return n.err();var k=[p];p[0]!=="~"&&(k[1]="~"+p,k[2]="~@"+p),n.b(k)},u?u.priv&&u.epriv?n.g(u):w.get("~"+u.pub).once(n.h):i?w.get("~@"+i).once(n.a):!i&&!d&&a.name(n.plugin),v};function h(f){if(typeof f!="string")return f;try{f=JSON.parse(f)}catch{f={}}return f}})(b,"./auth"),b(function(G){var e=b("./user"),a=e.SEA;e.GUN,e.prototype.recall=function(s,y){var h=this,f=h.back(-1);if(s=s||{},s&&s.sessionStorage){if(a.window)try{var u={};u=a.window.sessionStorage,u&&(f._.opt.remember=!0,(h.back("user")._.opt||s).remember=!0,(u.recall||u.pair)&&f.user().auth(JSON.parse(u.pair),y))}catch{}return h}return h}})(b,"./recall"),b(function(G){var e=b("./user"),a=e.SEA,s=e.GUN,y=function(){};e.prototype.pair=function(){var h=this,f;try{f=new Proxy({DANGER:""},{get:function(u,i,d){if(!(!h.is||!(h._||"").sea))return h._.sea[i]}})}catch{}return f},e.prototype.delete=async function(h,f,u){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var i=this;i.back(-1);var d=i.back("user");try{d.auth(h,f,function(_){var r=(d.is||{}).pub;d.map().once(function(){this.put(null)}),d.leave(),(u||y)({ok:0})})}catch(_){s.log("User.delete failed! Error:",_)}return i},e.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const h=this.back(-1);try{return await authRecall(h),h._.user._}catch{const u="No session!";throw s.log(u),{err:u}}},e.prototype.trust=async function(h){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),s.is(h)&&h.get("pub").get((f,u)=>{console.log(f,u)}),h.get("trust").get(path).put(theirPubkey)},e.prototype.grant=function(h,f){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var u=this,i=u.back(-1).user(),d=i._.sea,_="";return u.back(function(r){r.is||(_+=r.get||"")}),async function(){var r,v=await i.get("grant").get(d.pub).get(_).then();v=await a.decrypt(v,d),v||(v=a.random(16).toString(),r=await a.encrypt(v,d),i.get("grant").get(d.pub).get(_).put(r));var c=h.get("pub").then(),w=h.get("epub").then();c=await c,w=await w;var n=await a.secret(w,d);r=await a.encrypt(v,n),i.get("grant").get(c).get(_).put(r,f)}(),u},e.prototype.secret=function(h,f){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var u=this,i=u.back(-1).user(),d=i.pair(),_="";return u.back(function(r){r.is||(_+=r.get||"")}),async function(){var r,v=await i.get("trust").get(d.pub).get(_).then();v=await a.decrypt(v,d),v||(v=a.random(16).toString(),r=await a.encrypt(v,d),i.get("trust").get(d.pub).get(_).put(r)),r=await a.encrypt(h,v),u.put(r,f)}(),u},G.exports=e})(b,"./share"),b(function(G){var e=b("./sea"),a=b("./settings"),s,y=(e.window||"").GUN||b((""+s==typeof N?".":"")+"./gun",1);y.on("opt",function(r){r.sea||(r.sea={own:{}},r.on("put",h,r)),this.to.next(r)});function h(r){var v=this,c=v.as,w=r.put,n=w["#"],t=w["."],l=w[":"],p=w[">"],k=r["#"],m;if(!(!n||!t)){if((r._||"").faith&&(c.opt||"").faith&&typeof r._=="function"){e.opt.pack(w,function(T){e.verify(T,!1,function(I){w["="]=e.opt.unpack(I),v.to.next(r)})});return}var A=function(T){c.on("in",{"@":k,err:r.err=T})};if((r._||"").DBG&&((r._||"").DBG.c=+new Date),0<=n.indexOf("<?")&&(m=parseFloat(n.split("<?")[1]||""),m&&p<y.state()-m*1e3)){(m=r._)&&m.stun&&m.stun--;return}if(n==="~@"){h.alias(v,r,l,t,n,c,A);return}if(n.slice(0,2)==="~@"){h.pubs(v,r,l,t,n,c,A);return}if(m=e.opt.pub(n)){h.pub(v,r,l,t,n,c,A,c.user||"",m);return}if(0<=n.indexOf("#")){h.hash(v,r,l,t,n,c,A);return}h.any(v,r,l,t,n,c,A,c.user||"")}}h.hash=function(r,v,c,w,n,t,l){e.work(c,null,function(p){function k(m){let A="";for(let T=0;T<m.length;T++)A+=T-1&1?"":String.fromCharCode(parseInt(m.substring(T-1,T+1),16));return btoa(A)}if(p&&p===w.split("#").slice(-1)[0])return r.to.next(v);if(p&&p===k(w.split("#").slice(-1)[0]))return r.to.next(v);l("Data hash not same as hash!")},{name:"SHA-256"})},h.alias=function(r,v,c,w,n,t,l){if(!c)return l("Data must exist!");if("~@"+w===u(c))return r.to.next(v);l("Alias not same!")},h.pubs=function(r,v,c,w,n,t,l){if(!c)return l("Alias must exist!");if(w===u(c))return r.to.next(v);l("Alias not same!")},h.pub=async function(r,v,c,w,n,t,l,p,k){var m;const A=await a.parse(c)||{},T=(I,B,g)=>{if(I.m&&I.s&&B&&k)return e.verify(I,k,o=>{if(s!==o&&s!==o.e&&v.put[">"]&&v.put[">"]>parseFloat(o.e))return l("Certificate expired.");if(s!==o&&o.c&&o.w&&(o.c===B||o.c.indexOf("*")>-1)){let j=n.indexOf("/")>-1?n.replace(n.substring(0,n.indexOf("/")+1),""):"";String.match=String.match||y.text.match;const E=Array.isArray(o.w)?o.w:typeof o.w=="object"||typeof o.w=="string"?[o.w]:[];for(const $ of E)if(String.match(j,$["#"])&&String.match(w,$["."])||!$["."]&&String.match(j,$["#"])||!$["#"]&&String.match(w,$["."])||String.match(j?j+"/"+w:w,$["#"]||$)){if($["+"]&&$["+"].indexOf("*")>-1&&j&&j.indexOf(B)==-1&&w.indexOf(B)==-1)return l(`Path "${j}" or key "${w}" must contain string "${B}".`);if(o.wb&&(typeof o.wb=="string"||(o.wb||{})["#"])){var x=r.as.root.$.back(-1);return typeof o.wb=="string"&&o.wb.slice(0,1)!=="~"&&(x=x.get("~"+k)),x.get(o.wb).get(B).once(D=>D&&(D===1||D===!0)?l(`Certificant ${B} blocked.`):g(o))}return g(o)}return l("Certificate verification fail.")}})};if(w==="pub"&&"~"+k===n)return c===k?r.to.next(v):l("Account not same!");if((m=p.is)&&m.pub&&!A["*"]&&!A["+"]&&(k===m.pub||k!==m.pub&&((v._.msg||{}).opt||{}).cert)){e.opt.pack(v.put,I=>{e.sign(I,p._.sea,async function(B){if(s===B)return l(e.err||"Signature fail.");if(v.put[":"]={":":m=e.opt.unpack(B.m),"~":B.s},v.put["="]=m,k===p.is.pub){(m=u(c))&&((t.sea.own[m]=t.sea.own[m]||{})[k]=1),JSON.stringifyAsync(v.put[":"],function(g,o){return g?l(g||"Stringify error."):(v.put[":"]=o,r.to.next(v))});return}if(k!==p.is.pub&&((v._.msg||{}).opt||{}).cert){const g=await a.parse(v._.msg.opt.cert);g&&g.m&&g.s&&T(g,p.is.pub,o=>{v.put[":"]["+"]=g,v.put[":"]["*"]=p.is.pub,JSON.stringifyAsync(v.put[":"],function(x,j){return x?l(x||"Stringify error."):(v.put[":"]=j,r.to.next(v))})})}},{raw:1})});return}e.opt.pack(v.put,I=>{e.verify(I,A["*"]||k,function(B){var g;if(B=e.opt.unpack(B),s===B)return l("Unverified data.");if((g=u(B))&&k===e.opt.pub(g)&&((t.sea.own[g]=t.sea.own[g]||{})[k]=1),A["+"]&&A["+"].m&&A["+"].s&&A["*"])T(A["+"],A["*"],o=>(v.put["="]=B,r.to.next(v)));else return v.put["="]=B,r.to.next(v)})})},h.any=function(r,v,c,w,n,t,l,p){if(t.opt.secure)return l("Soul missing public key at '"+w+"'.");t.on("secure",function(k){if(this.off(),!t.opt.secure)return r.to.next(k);l("Data cannot be changed.")}).on.on("secure",v)};var f=y.valid,u=function(r,v){return typeof(v=f(r))=="string"&&v};(y.state||"").ify;var i=/[^\w_-]/;e.opt.pub=function(r){if(r&&(r=r.split("~"),!(!r||!(r=r[1]))&&(r=r.split(i).slice(0,2),!(!r||r.length!=2)&&(r[0]||"")[0]!=="@")))return r=r.slice(0,2).join("."),r},e.opt.stringy=function(r){},e.opt.pack=function(r,v,c,w,n){var t,l;if(e.opt.check(r))return v(r);r&&r["#"]&&r["."]&&r[">"]&&(t=r[":"],l=1),JSON.parseAsync(l?t:r,function(p,k){var m=s!==(k||"")[":"]&&(k||"")["~"];if(!m){v(r);return}v({m:{"#":n||r["#"],".":c||r["."],":":(k||"")[":"],">":r[">"]||y.state.is(w,c)},s:m})})};var d=e.opt;e.opt.unpack=function(r,v,c){var w;if(s!==r){if(r&&s!==(w=r[":"]))return w;if(v=v||d.fall_key,!c&&d.fall_val&&(c={},c[v]=d.fall_val),!(!v||!c)){if(r===c[v]||!e.opt.check(c[v]))return r;var n=c&&c._&&c._["#"]||d.fall_soul,t=y.state.is(c,v)||d.fall_state;if(r&&r.length===4&&n===r[0]&&v===r[1]&&_(t)===_(r[3]))return r[2];if(t<e.opt.shuffle_attack)return r}}},e.opt.shuffle_attack=15463296e5;var _=Math.floor})(b,"./index")})()}(ft)),ft.exports}Pt();var pt={exports:{}},xt={},_t;function Ut(){if(_t)return xt;_t=1;var F={},b=typeof window<"u"?window.Gun:ht(),N;b.on("opt",function(e){G(e),this.to.next(e)});function G(e){if(e.axe)return;var a=e.opt;if(a.peers,a.axe===!1||typeof process<"u"&&""+(F||"").AXE=="false")return;b.log.once("AXE","AXE relay enabled!");var s=e.axe={},y=a.mesh=a.mesh||b.Mesh(e),h=e.dup;y.way=function(c){if(c){if(c.get)return f(c);c.put||u(c)}};function f(c){if(c){var w=(c._||"").via,n;if(!w||!w.id||!(n=i(c)._))return u(c);n.asked=+new Date,f.turn(c,n.route,0)}}f.turn=function(c,w,n){var t=c["#"],l=h.s[t],p;if(!(!t||!l)&&(clearTimeout(l.lack),!(l.ack&&(t=l["##"])&&c["##"]===t))){if(p=Object.maps(w||a.peers).slice(n=n||0),!p.length){if(!w)return;f.turn(c,N,0);return}setTimeout.each(p,function(k){var m=a.peers[k];if(n++,!m||!m.wire){w&&w.delete(k);return}if(y.say(c,m)!==!1&&n%3==0)return 1},function(){l["##"]=c["##"],l.lack=setTimeout(function(){f.turn(c,w,n)},25)},3)}};function u(c){y.say(c,a.peers)}function i(c){var w="",n,t,l;if(!c||!c.get)return w;typeof(n=c.get["#"])=="string"&&(w=e.$.get(n)),typeof(l=c.get["."])=="string"?t=l:t="";var p=(c._||"").via,k=p.sub||(p.sub=new Object.Map);return(k.get(n)||k.set(n,l=new Object.Map)&&l).set(t,1),p.id&&w._&&(w._.route||(w._.route=new Object.Map)).set(p.id,p),w}function d(c){return(c=c||"")["="]||c["*"]||c[">"]||c}e.on("in",function(c){var w=this.to,n;if((n=c["@"])&&(n=h.s[n])){if(n.ack=(n.ack||0)+1,n.it&&n.it.get&&c.put){var t=n.it.get||"",l=i(n.it)._,p=(n.it._||"").via||"",k;if(p&&l&&(p.id&&(l.route||(l.route=new Object.Map)).set(p.id,p),k=p.sub||(p.sub=new Object.Map),l&&(k.get(d(t["#"]))||k.set(d(t["#"]),k=new Object.Map)&&k).set(d(t["."]),1),p=(c._||"").via||"",p&&(p.id&&(l.route||(l.route=new Object.Map)).set(p.id,p),k=p.sub||(p.sub=new Object.Map),l))){var m=d(t["#"]),A=k.get(m),T=d(t["."]);T?(A||k.set(m,A=new Object.Map)&&A).set(T,1):A||(k.set(m,A=new Object.Map),A.set("",1))}}if(n=n.back){setTimeout.each(Object.keys(n),function(I){w.next({"#":c["#"],"@":I,ok:c.ok})});return}}w.next(c)}),e.on("create",function(c){this.to.next(c),c.on("put",function(w){var n=this;n.as;var t=w.put,l=t["#"],p=t["."],k=t[":"],m=t[">"];if(n.to.next(w),!w["@"]&&!(!l||!p)){var A=c.$.get(l)._,T=(A||"").route;if(T){if(A.skip&&A.skip.has==p){A.skip.now=w["#"];return}(A.skip={now:w["#"],has:p}).to=setTimeout(function(){setTimeout.each(Object.maps(T),function(I){var B,E,g=A.skip||"";if(A.skip=null,!!(B=T.get(I))){if(!B.wire){T.delete(I);return}var o=(B.sub||(B.sub=new Object.Map)).get(l);if(o&&!(!o.get(p)&&!o.get(""))){var x=B.put||(B.put={}),j=c.graph[l],E;j&&N!==(E=j[p])&&(m=v(j,p),k=E),x[l]=r(x[l],p,m,k,l),E=h.track(B.next=B.next||String.random(9)),(E.back||(E.back={}))[""+(g.now||w["#"])]=1,!B.to&&(B.to=setTimeout(function(){_(B)},a.gap))}}})},9)}}})});function _(c){var w={"#":c.next,put:c.put,ok:{"@":3,"/":y.near}};c.next=c.put=c.to=null,y.say(w,c)}var r=b.state.ify,v=b.state.is;(function(){s.up={};var c=y.hear["?"];y.hear["?"]=function(w,n){var t;if(c(w,n),!!n.pid){if(n.pid===a.pid){y.bye(n);return}if(t=s.up[n.pid]){if(t===n)return;a.pid>n.pid&&(t=n,n=s.up[t.pid]),t.url=t.url||n.url,y.bye(n),s.up[t.pid]=t;return}n.url&&(s.up[n.pid]=n,s.stay&&s.stay())}},y.hear.opt=function(w,n){if(!w.ok){var t=w.opt;t&&(t=t.peers,!(!t||typeof t!="string")&&(99<=Object.keys(s.up).length||(y.hi({id:t,url:t,retry:9}),n&&y.say({dam:"opt",ok:1,"@":w["#"]},n))))}},s.stay=function(){clearTimeout(s.stay.to),s.stay.to=setTimeout(function(w,n){(w=e.stats&&e.stats.stay)&&(n={},Object.keys(s.up||"").forEach(function(t){t=(s.up||"")[t],t.url&&(n[t.url]={})}),(w.axe=w.axe||{}).up=n)},1e3*9)},setTimeout(function(w){(w=e.stats&&e.stats.stay&&e.stats.stay.axe)&&(w=w.up)&&(w instanceof Array||(w=Object.keys(w)),setTimeout.each(w||[],function(n){y.hear.opt({opt:{peers:n}})}))},1e3)})(),function(){a.mob=a.mob||9900,e.on("hi",function(c){if(this.to.next(c),!c.url){var w=y.near;if(!(a.mob>=w)){var n={};Object.keys(s.up).forEach(function(t){t=s.up[t],t.url&&(n[t.url]={})}),y.say({dam:"mob",mob:w,peers:n},c),setTimeout(function(){y.bye(c)},9)}}}),e.on("bye",function(c){this.to.next(c)})}()}return function(){var e=Array.from;if(Object.maps=function(a){return e&&a instanceof Map?e(a.keys()):(a instanceof Object.Map&&(a=a.s),Object.keys(a))},e)return Object.Map=Map;(Object.Map=function(){this.s={}}).prototype={set:function(a,s){return this.s[a]=s,this},get:function(a){return this.s[a]},delete:function(a){delete this.s[a]}}}(),xt}var St;function Mt(){return St||(St=1,function(F){(function(){var b=setTimeout||{},N;typeof window!=""+N&&(b.window=window);var G=(b.window||"").AXE||function(){};(G.window=b.window)&&(G.window.AXE=G);var e=(G.window||"").GUN||ht();(e.AXE=G).GUN=G.Gun=e,e.window||Ut(),e.on("opt",function(s){a(s),this.to.next(s)});function a(s){if(s.axe)return;var y=s.opt,h=y.peers;if(y.axe===!1||!e.window)return;var f=e.window,u=f.localStorage||y.localStorage||{},i=f.location||y.location||{},d=f.navigator||y.navigator||{},_=s.axe={},r,v,c=y.mesh=y.mesh||e.Mesh(s);r=h[v=i.origin+"/gun"]=h[v]||{},r.id=r.url=v,r.retry=r.retry||0,r=h[v="http://localhost:8765/gun"]=h[v]||{},r.id=r.url=v,r.retry=r.retry||0,e.log.once("AXE","AXE enabled: Trying to find network via (1) local peer (2) last used peers (3) a URL parameter, and last (4) hard coded peers."),e.log.once("AXEWarn","Warning: AXE is in alpha, use only for testing!");var w=u.peers||"";w&&(w+=" "),w+=((i.search||"").split("peers=")[1]||"").split("&")[0],s.on("bye",function(t){this.to.next(t),t.url&&(d.onLine||(t.retry=1),!t.retry&&(_.fall&&delete _.fall[t.url||t.id],function l(){if(!_.fall){setTimeout(l,9);return}var p=Object.keys(_.fall||""),k=p[Math.random()*p.length>>0];if(p.length||(u.peers="",k="https://gunjs.herokuapp.com/gun"),h[k]){l();return}c.hi(k)}()))}),s.on("hi",function(t){this.to.next(t),t.url});function n(t){_.fall={},((t||"").match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/ig)||[]).forEach(function(l){_.fall[l]={url:l,id:l,retry:0}})}if(w){n(w);return}try{fetch(((i.search||"").split("axe=")[1]||"").split("&")[0]||i.axe||"https://raw.githubusercontent.com/wiki/amark/gun/volunteer.dht.md").then(function(t){return t.text()}).then(function(t){n(u.peers=t)}).catch(function(){n()})}catch{n()}}try{""+N!="object"&&(F.exports=G)}catch{}})()}(pt)),pt.exports}Mt();const Jt={style:{border:"1px solid #aaa","margin-bottom":"16px",padding:"8px"}},Rt={style:{"margin-top":"8px",color:"blue"}},Lt={style:{border:"1px solid #aaa","margin-bottom":"16px",padding:"8px"}},Vt={key:0,style:{"margin-top":"8px",color:"green"}},Kt={key:1,style:{color:"red"}},Ht={style:{border:"1px solid #aaa","margin-bottom":"16px",padding:"8px"}},Ft={style:{"margin-top":"8px"}},qt={style:{border:"1px solid #aaa","margin-bottom":"16px",padding:"8px"}},Wt=["onClick"],Xt={style:{border:"1px solid #aaa",padding:"8px"}},zt={key:0},Yt={style:{"margin-top":"8px",border:"1px solid #ccc",padding:"8px","max-height":"150px",overflow:"auto"}},Zt={key:0},Qt={key:1},ee=jt({__name:"test",setup(F){function b(O){if(!O){alert("");return}navigator.clipboard.writeText(O).then(()=>{alert("")}).catch(S=>{console.error(":",S),alert("")})}console.log("[GunUserFullDemo] Starting integrated test...");const N=["https://peer.wallie.io/gun"],G=It({peers:N,localStorage:!0});console.log("[GunUserFullDemo] GUN instance created with peers:",N);const e=G.user(),a=H(""),s=H(""),y=H(""),h=H(""),f=H(""),u=H(!1),i=H(null),d=H(null),_=H(null),r=H(""),v=H(""),c=H(""),w=H(""),n=H([]),t=H(null),l=H(null),p=H(""),k=H([]);let m=null;function A(){const O=a.value.trim(),S=s.value;if(console.log("[onRegister] Attempting to register:",O),!O||!S){y.value="";return}e.create(O,S,C=>{var P;if(console.log("[onRegister] Registration ack:",C),"err"in C)y.value=": "+C.err;else{y.value="! ",a.value="",s.value="";const M=(P=e.is)==null?void 0:P.pub;M&&G.get("users").get(M).put({alias:O},V=>{V.err?console.error("[onRegister] Error saving user alias:",V.err):console.log("[onRegister] User alias saved successfully")})}})}function T(){const O=h.value.trim(),S=f.value;if(console.log("[onLogin] Attempting to login:",O),!O||!S){_.value="";return}e.auth(O,S,C=>{console.log("[onLogin] Login ack:",C),"err"in C?(u.value=!1,i.value=null,d.value=null,_.value=C.err):(u.value=!0,i.value=O,_.value=null,e.is&&e.is.pub?(d.value=e.is.pub,console.log("[onLogin] Current user pubKey:",e.is.pub)):C.pub?(d.value=C.pub,console.log("[onLogin] Current user pubKey from ack:",C.pub)):(d.value="()",console.warn("[onLogin] ")),d.value&&G.get("users").get(d.value).once(P=>{P&&P.alias?i.value=P.alias:console.warn("[onLogin] ")}),o())})}function I(){console.log("[onLogout] Logging out"),e.leave(),u.value=!1,i.value=null,d.value=null,n.value=[],t.value=null,l.value=null,k.value=[],_.value=null,alert("")}function B(){const O=r.value,S=v.value;if(console.log("[onChangePassword] Attempting to change password"),!O||!S){c.value="";return}e.change(O,S,C=>{console.log("[onChangePassword] Change password ack:",C),C.err?c.value=": "+C.err:(c.value="! ",r.value="",v.value="")})}function g(){const O=w.value.trim();if(console.log("[addBuddy] Attempting to add buddy with pubKey:",O),!u.value){alert("");return}if(!O){alert("");return}e.get("buddy").get(O).put(!0,S=>{console.log("[addBuddy] Add buddy ack:",S),S.err?alert(": "+S.err):(alert(": "+O),w.value="",G.get("users").get(O).once(C=>{C&&C.alias?n.value.some(M=>M.pub===O)||n.value.push({alias:C.alias,pub:O}):(n.value.some(M=>M.pub===O)||n.value.push({alias:"()",pub:O}),console.warn("[addBuddy] "))}))})}function o(){console.log("[listenBuddyList] Listening to buddy list updates"),n.value=[],e.get("buddy").map().on((O,S)=>{console.log("[buddyList map.on] val=",O,"key=",S),O?G.get("users").get(S).once(C=>{C&&C.alias?n.value.some(M=>M.pub===S)||n.value.push({alias:C.alias,pub:S}):(n.value.some(M=>M.pub===S)||n.value.push({alias:"()",pub:S}),console.warn("[listenBuddyList]  for pubKey:",S))}):n.value=n.value.filter(C=>C.pub!==S)})}function x(O){console.log("[openChat] Opening chat with pubKey:",O),t.value=O;const S=n.value.find(C=>C.pub===O);S?l.value=S.alias:l.value="()",k.value=[],j(O)}function j(O){console.log("[listenChat] Listening to chat with:",O),m&&m.off&&m.off();const S=$(d.value,O);console.log("[listenChat] chatId:",S),m=G.get("chats").get(S).map().on((C,P)=>{console.log("[listenChat] New message:",C,"msgId:",P),C&&k.value.push(C)})}function E(){if(!t.value){alert("");return}const O=p.value.trim();if(!O){alert("");return}const S=$(d.value,t.value),C={from:d.value||"",text:O,timestamp:Date.now()};console.log("[sendChat] Sending message:",C),G.get("chats").get(S).set(C,P=>{P.err?(console.error("[sendChat] :",P.err),alert(": "+P.err)):(console.log("[sendChat] "),k.value.push(C),p.value="")})}function $(O,S){return O?O<S?`${O}_${S}`:`${S}_${O}`:(console.warn("[generateChatId] pubA is null, using pubB only"),S)}function D(O){const S=n.value.find(C=>C.pub===O);return S?S.alias:null}return(O,S)=>(z(),vt(U(Ct),null,{default:R(()=>[J(U(Tt),null,{default:R(()=>[J(U(Ot),null,{default:R(()=>[J(U($t),null,{default:R(()=>S[9]||(S[9]=[K("TalkFlow")])),_:1})]),_:1})]),_:1}),J(U(Dt),{style:{padding:"16px"}},{default:R(()=>[L("div",Jt,[S[13]||(S[13]=L("br",null,null,-1)),S[14]||(S[14]=L("p",null," iOS ",-1)),S[15]||(S[15]=L("p",null,"",-1)),S[16]||(S[16]=L("p",null,"",-1)),S[17]||(S[17]=L("p",null,"AI",-1)),S[18]||(S[18]=L("p",null,"",-1)),S[19]||(S[19]=L("p",null,[K(" "),L("a",{href:"zhangguoai888@gmail.com"},"zhangguoai888@gmail.com")],-1)),S[20]||(S[20]=L("h3",null," (user.create)",-1)),J(U(Y),null,{default:R(()=>[J(U(Z),{position:"floating"},{default:R(()=>S[10]||(S[10]=[K("Alias ()")])),_:1}),J(U(tt),{modelValue:a.value,"onUpdate:modelValue":S[0]||(S[0]=C=>a.value=C),placeholder:""},null,8,["modelValue"])]),_:1}),J(U(Y),null,{default:R(()=>[J(U(Z),{position:"floating"},{default:R(()=>S[11]||(S[11]=[K("Password ()")])),_:1}),J(U(tt),{type:"password",modelValue:s.value,"onUpdate:modelValue":S[1]||(S[1]=C=>s.value=C),placeholder:""},null,8,["modelValue"])]),_:1}),J(U(et),{onClick:A},{default:R(()=>S[12]||(S[12]=[K("")])),_:1}),L("p",Rt,X(y.value),1)]),L("div",Lt,[S[27]||(S[27]=L("h3",null," (user.auth)",-1)),J(U(Y),null,{default:R(()=>[J(U(Z),{position:"floating"},{default:R(()=>S[21]||(S[21]=[K("Alias ()")])),_:1}),J(U(tt),{modelValue:h.value,"onUpdate:modelValue":S[2]||(S[2]=C=>h.value=C),placeholder:""},null,8,["modelValue"])]),_:1}),J(U(Y),null,{default:R(()=>[J(U(Z),{position:"floating"},{default:R(()=>S[22]||(S[22]=[K("Password ()")])),_:1}),J(U(tt),{type:"password",modelValue:f.value,"onUpdate:modelValue":S[3]||(S[3]=C=>f.value=C),placeholder:""},null,8,["modelValue"])]),_:1}),J(U(et),{onClick:T},{default:R(()=>S[23]||(S[23]=[K("")])),_:1}),u.value?(z(),Q("div",Vt,[L("p",null,": "+X(i.value),1),L("p",null,[S[24]||(S[24]=L("b",null," (PubKey):",-1)),K(" "+X(d.value),1)]),J(U(et),{fill:"clear",size:"small",onClick:S[4]||(S[4]=C=>b(d.value)),title:""},{default:R(()=>S[25]||(S[25]=[K("  ")])),_:1}),J(U(et),{color:"danger",onClick:I},{default:R(()=>S[26]||(S[26]=[K("")])),_:1})])):st("",!0),_.value?(z(),Q("p",Kt,X(_.value),1)):st("",!0)]),L("div",Ht,[S[31]||(S[31]=L("h3",null," (user.change)",-1)),J(U(Y),null,{default:R(()=>[J(U(Z),{position:"floating"},{default:R(()=>S[28]||(S[28]=[K("")])),_:1}),J(U(tt),{type:"password",modelValue:r.value,"onUpdate:modelValue":S[5]||(S[5]=C=>r.value=C),placeholder:""},null,8,["modelValue"])]),_:1}),J(U(Y),null,{default:R(()=>[J(U(Z),{position:"floating"},{default:R(()=>S[29]||(S[29]=[K("")])),_:1}),J(U(tt),{type:"password",modelValue:v.value,"onUpdate:modelValue":S[6]||(S[6]=C=>v.value=C),placeholder:""},null,8,["modelValue"])]),_:1}),J(U(et),{onClick:B},{default:R(()=>S[30]||(S[30]=[K("")])),_:1}),L("p",Ft,X(c.value),1)]),L("div",qt,[S[37]||(S[37]=L("h3",null,"",-1)),S[38]||(S[38]=L("p",{style:{color:"red"}},"",-1)),J(U(Y),null,{default:R(()=>[J(U(Z),{position:"floating"},{default:R(()=>S[32]||(S[32]=[K(" (PubKey)")])),_:1}),J(U(tt),{modelValue:w.value,"onUpdate:modelValue":S[7]||(S[7]=C=>w.value=C),placeholder:""},null,8,["modelValue"])]),_:1}),J(U(et),{onClick:g},{default:R(()=>S[33]||(S[33]=[K("")])),_:1}),S[39]||(S[39]=L("h4",{style:{"margin-top":"8px"}}," (Buddy List)",-1)),J(U(Et),null,{default:R(()=>[(z(!0),Q(gt,null,wt(n.value,C=>(z(),vt(U(Y),{key:C.pub},{default:R(()=>[J(U(Z),null,{default:R(()=>[L("p",null,[S[34]||(S[34]=L("strong",null,":",-1)),K(" "+X(C.alias),1)]),L("p",{onClick:P=>x(C.pub)},[S[35]||(S[35]=L("strong",null,":",-1)),K(" "+X(C.pub),1)],8,Wt)]),_:2},1024),J(U(et),{onClick:P=>x(C.pub)},{default:R(()=>S[36]||(S[36]=[K("")])),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),L("div",Xt,[L("h3",null," - : "+X(l.value||""),1),t.value?(z(),Q("div",zt,[J(U(Y),null,{default:R(()=>[J(U(Z),{position:"floating"},{default:R(()=>S[40]||(S[40]=[K("")])),_:1}),J(U(tt),{modelValue:p.value,"onUpdate:modelValue":S[8]||(S[8]=C=>p.value=C),placeholder:""},null,8,["modelValue"])]),_:1}),J(U(et),{onClick:E},{default:R(()=>S[41]||(S[41]=[K("")])),_:1}),L("ul",Yt,[(z(!0),Q(gt,null,wt(k.value,(C,P)=>(z(),Q("li",{key:P},[C.from===d.value?(z(),Q("b",Zt,"[]")):(z(),Q("b",Qt,"["+X(D(C.from)||"")+"]",1)),K(" "+X(C.text)+" ",1),L("small",null,"("+X(new Date(C.timestamp).toLocaleTimeString())+")",1)]))),128))])])):st("",!0)])]),_:1})]),_:1}))}});export{ee as default};
