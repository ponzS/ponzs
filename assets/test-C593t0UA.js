import{d as kt,r as K,a as H,c as q,b as M,w as V,e as X,t as W,k as nt,g as Q,F as ot,l as pt,n as mt,_ as _t}from"./index-A3FkA0VD.js";var ut=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xt(L){return L&&L.__esModule&&Object.prototype.hasOwnProperty.call(L,"default")?L.default:L}function bt(L){throw new Error('Could not dynamically require "'+L+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var rt={exports:{}};rt.exports;var ht;function st(){return ht||(ht=1,function(L){(function(){function b(B,e){return e?bt(B):B.slice?b[a(B)]:function(s,d){B(s={exports:{}}),b[a(d)]=s.exports};function a(s){return s.split("/").slice(-1).toString().replace(".js","")}}var N=L;b(function(B){String.random=function(a,s){var d="";for(a=a||24,s=s||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";a-- >0;)d+=s.charAt(Math.floor(Math.random()*s.length));return d},String.match=function(a,s){var d,h;return typeof a!="string"?!1:(typeof s=="string"&&(s={"=":s}),s=s||{},d=s["="]||s["*"]||s[">"]||s["<"],a===d?!0:h!==s["="]?!1:(d=s["*"]||s[">"],a.slice(0,(d||"").length)===d?!0:h!==s["*"]?!1:h!==s[">"]&&h!==s["<"]?a>=s[">"]&&a<=s["<"]:h!==s[">"]&&a>=s[">"]||h!==s["<"]&&a<=s["<"]))},String.hash=function(a,s){if(typeof a=="string"){if(s=s||0,!a.length)return s;for(var d=0,h=a.length,f;d<h;++d)f=a.charCodeAt(d),s=(s<<5)-s+f,s|=0;return s}};var e=Object.prototype.hasOwnProperty;Object.plain=function(a){return a?a instanceof Object&&a.constructor===Object||Object.prototype.toString.call(a).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(a,s){for(var d in a)if(e.call(a,d)&&(!s||s.indexOf(d)==-1))return!1;return!0},Object.keys=Object.keys||function(a){var s=[];for(var d in a)e.call(a,d)&&s.push(d);return s},function(){var a,s=setTimeout,d=0,h=0,f=typeof setImmediate!=""+a&&setImmediate||function(i,w){return typeof MessageChannel==""+a?s:((i=new MessageChannel).port1.onmessage=function(x){x.data==""&&w()},function(x){w=x,i.port2.postMessage("")})}(),u=s.check=s.check||typeof performance!=""+a&&performance||{now:function(){return+new Date}};s.hold=s.hold||9,s.poll=s.poll||function(i){if(s.hold>=u.now()-d&&h++<3333){i();return}f(function(){d=u.now(),i()},h=0)}}(),function(){var a=setTimeout,s=a.turn=a.turn||function(w){d.push(w)==1&&h(i)},d=s.s=[],h=a.poll,f=0,u,i=function(){(u=d[f++])&&u(),(f==d.length||f==99)&&(d=s.s=d.slice(f),f=0),d.length&&h(i)}}(),function(){var a,s=setTimeout,d=s.turn;(s.each=s.each||function(h,f,u,i){i=i||9,function w(x,n,y){if(n=(x=(h||[]).splice(0,i)).length){for(var c=0;c<n&&a===(y=f(x[c]));c++);if(a===y){d(w);return}}u&&u(y)}()})()}()})(b,"./shim"),b(function(B){B.exports=function e(u,s,d){if(!u)return{to:e};var h,f=typeof s=="function",u=(this.tag||(this.tag={}))[u]||f&&(this.tag[u]={tag:u,to:e._={next:function(w){var x;(x=this.to)&&x.next(w)}}});if(f){var i={off:e.off||(e.off=function(){if(this.next===e._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=e._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:e._,next:s,the:u,on:this,as:d};return(i.back=u.last||u).to=i,u.last=i}return(u=u.to)&&h!==s&&u.next(s),u}})(b,"./onto"),b(function(B){B.exports=function(e){return e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"&&e!=1/0&&e!=-1/0&&e===e||!!e&&typeof e["#"]=="string"&&Object.keys(e).length===1&&e["#"]}})(b,"./valid"),b(function(B){b("./shim");function e(){var u=+new Date;return h<u?(s=0,h=u+e.drift):h=u+(s+=1)/d+e.drift}e.drift=0;var a=-1/0,s=0,d=999,h=a,f;e.is=function(u,i,w){var x=i&&u&&u._&&u._[">"]||w;if(x)return typeof(x=x[i])=="number"?x:a},e.ify=function(u,i,w,x,n){(u=u||{})._=u._||{},n&&(u._["#"]=n);var y=u._[">"]||(u._[">"]={});return f!==i&&i!=="_"&&(typeof w=="number"&&(y[i]=w),f!==x&&(u[i]=x)),u},B.exports=e})(b,"./state"),b(function(B){b("./shim");function e(a){var s={s:{}},d=s.s;a=a||{max:999,age:1e3*9},s.check=function(f){return d[f]?h(f):!1};var h=s.track=function(f){var u=d[f]||(d[f]={});return u.was=s.now=+new Date,s.to||(s.to=setTimeout(s.drop,a.age+9)),h.ed&&h.ed(f),u};return s.drop=function(f){s.to=null,s.now=+new Date;var u=Object.keys(d);console.STAT&&console.STAT(s.now,+new Date-s.now,"dup drop keys"),setTimeout.each(u,function(i){var w=d[i];w&&(f||a.age)>s.now-w.was||delete d[i]},0,99)},s}B.exports=e})(b,"./dup"),b(function(B){b("./onto"),B.exports=function(s,d){if(this.on){var h=(this.opt||{}).lack||9e3;if(typeof s!="function"){if(!s)return;var u=s["#"]||s,f=(this.tag||"")[u];return f?(d&&(f=this.on(u,d),clearTimeout(f.err),f.err=setTimeout(function(){f.off()},h)),!0):void 0}var u=d&&d["#"]||e(9);if(!s)return u;var i=this.on(u,s,d);return i.err=i.err||setTimeout(function(){i.off(),i.next({err:"Error: No ACK yet.",lack:!0})},h),u}};var e=String.random||function(){return Math.random().toString(36).slice(2)}})(b,"./ask"),b(function(B){function e(n){return n instanceof e?(this._={$:this}).$:this instanceof e?e.create(this._={$:this,opt:n}):new e(n)}e.is=function(n){return n instanceof e||n&&n._&&n===n._.$||!1},e.version=.202,e.chain=e.prototype,e.chain.toJSON=function(){},b("./shim"),e.valid=b("./valid"),e.state=b("./state"),e.on=b("./onto"),e.dup=b("./dup"),e.ask=b("./ask"),function(){e.create=function(o){o.root=o.root||o,o.graph=o.graph||{},o.on=o.on||e.on,o.ask=o.ask||e.ask,o.dup=o.dup||e.dup();var _=o.$.opt(o.opt);return o.once||(o.on("in",n,o),o.on("out",n,o),o.on("put",v,o),e.on("create",o),o.on("create",o)),o.once=1,_};function n(o){if(o){if(o.out===n){this.to.next(o);return}var _=this,A=_.as,E=A.at||A,O=E.$,$=E.dup,U,D=o.DBG;if((U=o["#"])||(U=o["#"]=s(9)),!$.check(U)){if($.track(U),U=o._,o._=typeof U=="function"?U:function(){},o.$&&o.$===(o.$._||"").$||(o.$=O),o["@"]&&!o.put&&t(o),!E.ask(o["@"],o))if(D&&(D.u=+new Date),o.put){y(o);return}else o.get&&e.on.get(o,O);D&&(D.uc=+new Date),_.to.next(o),D&&(D.ua=+new Date),!(o.nts||o.NTS)&&(o.out=n,E.on("out",o),D&&(D.ue=+new Date))}}}function y(o){if(o){var _=o._||"",A=_.root=((_.$=o.$||"")._||"").root;if(o["@"]&&_.faith&&!_.miss){o.out=n,A.on("out",o);return}_.latch=A.hatch,_.match=A.hatch=[];var E=o.put,O=_.DBG=o.DBG,$=+new Date;if(C=C||$,!(E["#"]&&E["."])){O&&(O.p=$),_["#"]=o["#"],_.msg=o,_.all=0,_.stun=1;var U=Object.keys(E);console.STAT&&console.STAT($,((O||_).pk=+new Date)-$,"put sort");var D=0,j,G,I,J,R,F,Z;(function z(tt){if(j!=D){if(j=D,!(I=U[D])){console.STAT&&console.STAT($,((O||_).pd=+new Date)-$,"put"),r(_);return}(J=E[I])?(Z=J._)?I!==Z["#"]?F=p+m(I)+"soul not same.":(R=Z[">"])||(F=p+m(I)+"no state."):F=p+m(I)+"no meta.":F=p+m(I)+"no node.",G=Object.keys(J||{})}if(F){o.err=_.err=F,r(_);return}var lt=0,Y;for(tt=tt||0;tt++<9&&(Y=G[lt++]);)if(Y!=="_"){var et=J[Y],ct=R[Y];if(i===ct){F=p+m(Y)+"on"+m(I)+"no state.";break}if(!h(et)){F=p+m(Y)+"on"+m(I)+"bad "+typeof et+m(et);break}c(et,Y,I,ct,o),++P}if((G=G.slice(lt)).length){d(z);return}++D,G=null,z(tt)})()}}}e.on.put=y;function c(o,_,A,E,O){var $=O._||"",U=$.root,D=U.graph,j,G=D[A]||w,I=f(G,_,1),J=G[_],R=$.DBG;(j=console.STAT)&&(!D[A]||!J)&&(j.has=(j.has||0)+1);var F=T();if(E>F){setTimeout(function(){c(o,_,A,E,O)},(j=E-F)>S?S:j),console.STAT&&console.STAT((R||$).Hf=+new Date,j,"future");return}if(!(E<I)&&!(!$.faith&&E===I&&(o===J||k(o)<=k(J))&&!$.miss)){$.stun++;var Z=O["#"]+$.all++,z={toString:function(){return Z},_:$};z.toJSON=z.toString,U.dup.track(z)["#"]=O["#"],R&&(R.ph=R.ph||+new Date),U.on("put",{"#":z,"@":O["@"],put:{"#":A,".":_,":":o,">":E},ok:O.ok,_:$})}}function v(o){var _;(_=(o._||"").DBG)&&(_.pa=+new Date,_.pm=_.pm||+new Date);var A=this,E=A.as,O=E.graph,$=o._,U=o.put,D=U["#"],j=U["."],G=U[":"],I=U[">"];o["#"];var J;(J=$.msg)&&(J=J.put)&&(J=J[D])&&u(J,j,I,G,D),O[D]=u(O[D],j,I,G,D),(J=(E.next||"")[D])&&J.on("in",o),r($),A.to.next(o)}function r(o,_){var A;if(!o.stop&&!(!o.err&&0<--o.stun)&&(o.stop=1,!!(A=o.root))){var E=o.match;E.end=1,E===A.hatch&&(!(E=o.latch)||E.end?delete A.hatch:A.hatch=E),o.hatch&&o.hatch(),setTimeout.each(o.match,function(O){O&&O()}),!(!(_=o.msg)||o.err||_.err)&&(_.out=n,o.root.on("out",_),g())}}function t(o){var _=o["@"]||"",A;if(!(A=_._)){var E=(E=o.$)&&(E=E._)&&(E=E.root)&&(E=E.dup);if(!(E=E.check(_)))return;o["@"]=E["#"]||o["@"];return}A.acks=(A.acks||0)+1,(A.err=o.err)&&(o["@"]=A["#"],r(A)),A.ok=o.ok||A.ok,!A.stop&&!A.crack&&(A.crack=A.match&&A.match.push(function(){l(A)})),l(A)}function l(o){!o||!o.root||o.stun||o.acks!==o.all||o.root.on("in",{"@":o["#"],err:o.err,ok:o.err?i:o.ok||{"":1}})}var p="Error: Invalid graph!",m=function(o){return" '"+(""+o).slice(0,9)+"...' "},k=JSON.stringify,S=2147483647,T=e.state,P=0,C,g=function(){P>999&&P/-(C-(C=+new Date))>1&&(e.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),g=function(){P=0})}}(),function(){e.on.get=function(y,c){var v=c._,r=y.get,t=r["#"],l=v.graph[t],p=r["."],m=v.next||(v.next={}),k=m[t],S=y._||{},T=S.DBG=y.DBG;if(T&&(T.g=+new Date),!l)return v.on("get",y);if(p){if((typeof p!="string"||i===l[p])&&!((k||"").next||"")[p]){v.on("get",y);return}l=u({},p,f(l,p),l[p],t)}l&&n(y,l),v.on("get",y)};function n(y,c){var v=+new Date,r=y._||{},t=r.DBG=y.DBG,l=y["#"],p=s(9),m=Object.keys(c||"").sort(),k=((c||"")._||"")["#"];m.length;var S=y.$._.root,T=c===S.graph[k];console.STAT&&console.STAT(v,((t||r).gk=+new Date)-v,"got keys"),c&&function P(){v=+new Date;for(var C=0,g,o={},_;C<9&&(g=m[C++]);)u(o,g,f(c,g),c[g],k);m=m.slice(C),(_={})[k]=o,o=_;var A;T&&(A=function(){},A.ram=A.faith=!0),_=m.length,console.STAT&&console.STAT(v,-(v-(v=+new Date)),"got copied some"),t&&(t.ga=+new Date),S.on("in",{"@":l,"#":p,put:o,"%":_?p=s(9):i,$:S.$,_:A,DBG:t,FOO:1}),console.STAT&&console.STAT(v,+new Date-v,"got in"),_&&setTimeout.turn(P)}(),c||S.on("in",{"@":y["#"]})}e.on.get.ack=n}(),function(){e.chain.opt=function(n){n=n||{};var y=this,c=y._,v=n.peers||n;return Object.plain(n)||(n={}),Object.plain(c.opt)||(c.opt=n),typeof v=="string"&&(v=[v]),Object.plain(c.opt.peers)||(c.opt.peers={}),v instanceof Array&&(n.peers={},v.forEach(function(r){var t={};t.id=t.url=r,n.peers[r]=c.opt.peers[r]=c.opt.peers[r]||t})),a(n,function r(t){var l=this[t];if(this&&this.hasOwnProperty(t)||typeof l=="string"||Object.empty(l)){this[t]=l;return}l&&l.constructor!==Object&&!(l instanceof Array)||a(l,r)}),c.opt.from=n,e.on("opt",c),c.opt.uuid=c.opt.uuid||function(t){return e.state().toString(36).replace(".","")+String.random(t||12)},y}}();var a=function(n,y){Object.keys(n).forEach(y,n)},s=String.random,d=setTimeout.turn,h=e.valid,f=e.state.is,u=e.state.ify,i,w={},x;e.log=function(){return!e.log.off&&x.log.apply(x,arguments),[].slice.call(arguments).join(" ")},e.log.once=function(n,y,c){return(c=e.log.once)[n]=c[n]||0,c[n]++||e.log(y)},typeof window<"u"&&((window.GUN=window.Gun=e).window=window);try{typeof N<"u"&&(N.exports=e)}catch{}B.exports=e,(e.window||{}).console=(e.window||{}).console||{log:function(){}},(x=console).only=function(n,y){return x.only.i&&n===x.only.i&&x.only.i++&&(x.log.apply(x,arguments)||y)},e.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(b,"./root"),b(function(B){var e=b("./root");e.chain.back=function(d,h){var f;if(d=d||1,d===-1||d===1/0)return this._.root.$;if(d===1)return(this._.back||this._).$;var u=this,i=u._;if(typeof d=="string"&&(d=d.split(".")),d instanceof Array){var w=0,x=d.length,f=i;for(w;w<x;w++)f=(f||a)[d[w]];return s!==f?h?u:f:(f=i.back)?f.$.back(d,h):void 0}if(typeof d=="function"){for(var n,f={back:i};(f=f.back)&&s===(n=d(f,h)););return n}return typeof d=="number"?(i.back||i).$.back(d-1):this};var a={},s})(b,"./back"),b(function(B){var e=b("./root");e.chain.chain=function(r){var t=this,l=t._,p=new(r||t).constructor(t),m=p._,k;return m.root=k=l.root,m.id=++k.once,m.back=t._,m.on=e.on,m.on("in",e.on.in,m),m.on("out",e.on.out,m),p};function a(r){var t,l=this.as,p=l.back,m=l.root,k;if(r.$||(r.$=l.$),this.to.next(r),l.err){l.on("in",{put:l.put=i,$:l.$});return}if(t=r.get){if(m.pass&&(m.pass[l.id]=l),l.lex&&Object.keys(l.lex).forEach(function(S){k[S]=l.lex[S]},k=r.get=r.get||{}),t["#"]||l.soul){if(t["#"]=t["#"]||l.soul,r["#"]||(r["#"]=w(9)),p=m.$.get(t["#"])._,t=t["."]){if(n(p.put,t)&&(k=p.ask&&p.ask[t],(p.ask||(p.ask={}))[t]=p.$.get(t)._,p.on("in",{get:t,put:{"#":p.soul,".":t,":":p.put[t],">":c(m.graph[p.soul],t)}}),k))return}else{if(k=p.ask&&p.ask[""],(p.ask||(p.ask={}))[""]=p,i!==p.put&&(p.on("in",p),k))return;r.$=p.$}return m.ask(f,r),m.on("in",r)}if(t["."])return l.get?(r={get:{".":l.get},$:l.$},(p.ask||(p.ask={}))[l.get]=r.$._,p.on("out",r)):(r={get:l.lex?r.get:{},$:l.$},p.on("out",r));if((l.ask||(l.ask={}))[""]=l,l.get)return t["."]=l.get,(p.ask||(p.ask={}))[l.get]=r.$._,p.on("out",r)}return p.on("out",r)}e.on.out=a;function s(r,t){t=t||this.as;var l=t.root,p=r.$||(r.$=t.$),m=(p||"")._||u,k=r.put||"",S=k["#"],T=k["."],P=i!==k["="]?k["="]:k[":"],C=k[">"]||-1/0,g;if(i!==r.put&&(i===k["#"]||i===k["."]||i===k[":"]&&i===k["="]||i===k[">"])){if(!x(k)){if(!(S=((k||"")._||"")["#"])){console.log("chain not yet supported for",k,"...",r,t);return}return p=t.root.$.get(S),setTimeout.each(Object.keys(k).sort(),function(o){o=="_"||i===(C=c(k,o))||t.on("in",{$:p,put:{"#":S,".":o,"=":k[o],">":C},VIA:r})})}t.on("in",{$:m.back.$,put:{"#":S=m.back.soul,".":T=m.has||m.get,"=":k,">":c(m.back.put,T)},via:r});return}(r.seen||"")[t.id]||((r.seen||(r.seen=function(){}))[t.id]=t,t!==m&&(Object.keys(r).forEach(function(o){k[o]=r[o]},k={}),k.get=t.get||k.get,!t.soul&&!t.has?k.$$$=k.$$$||t.$:m.soul&&(k.$=t.$,k.$$=k.$$||m.$),r=k),h(r,t),(t.soul||r.$$)&&C>=c(l.graph[S],T)&&((k=l.$.get(S)._).put=v(k.put,T,C,P,S)),!m.soul&&C>=c(l.graph[S],T)&&(g=(l.$.get(S)._.next||"")[T])&&(g.put=P,typeof(k=x(P))=="string"&&(g.put=l.$.get(k)._.put||P)),this.to&&this.to.next(r),t.any&&setTimeout.each(Object.keys(t.any),function(o){(o=t.any[o])&&o(r)},0,99),t.echo&&setTimeout.each(Object.keys(t.echo),function(o){(o=t.echo[o])&&o.on("in",r)},0,99),((r.$$||"")._||m).soul&&(g=t.next)&&(g=g[T])&&(k={},Object.keys(r).forEach(function(o){k[o]=r[o]}),k.$=(r.$$||r.$).get(k.get=T),delete k.$$,delete k.$$$,g.on("in",k)),d(r,t))}e.on.in=s;function d(r,t){if(t=t||this.as||r.$._,!(r.$$&&this!==e.on)&&!(!r.put||t.soul)){var l=r.put||"",p=l["="]||l[":"],T,m=t.root,k=m.$.get(l["#"]).get(l["."])._;if(typeof(p=x(p))!="string"){this===e.on&&((k.echo||(k.echo={}))[t.id]=t);return}if(!((k.echo||(k.echo={}))[t.id]&&!(m.pass||"")[t.id])){if(T=m.pass){if(T[p+t.id])return;T[p+t.id]=1}(k.echo||(k.echo={}))[t.id]=t,t.has&&(t.link=p);var S=m.$.get(k.link=p)._;(S.echo||(S.echo={}))[k.id]=k;var T=t.ask||"";(T[""]||t.lex)&&S.on("out",{get:{"#":p}}),setTimeout.each(Object.keys(T),function(P,C){!P||!(C=T[P])||C.on("out",{get:{"#":p,".":P}})},0,99)}}}e.on.link=d;function h(r,t){var l=r.put||"",p=i!==l["="]?l["="]:l[":"],m=t.root,k,S;if(i===p){if(t.soul&&i!==t.put||(S=(r.$$||r.$||"")._||"",r["@"]&&(i!==S.put||i!==t.put)))return;(k=t.link||r.linked)&&delete(m.$.get(k)._.echo||"")[t.id],t.has&&(t.link=null),t.put=i,setTimeout.each(Object.keys(t.next||""),function(T,P){(P=t.next[T])&&(k&&delete(m.$.get(k).get(T)._.echo||"")[P.id],P.on("in",{get:T,put:i,$:P.$}))},0,99);return}t.soul||r.$$||(k=x(p),S=r.$._||"",!((k===S.link||t.has&&!S.link)&&!((m.pass||"")[t.id]&&typeof k!="string"))&&(delete(S.echo||"")[t.id],h({get:t.get,put:i,$:r.$,linked:r.linked=r.linked||S.link},t)))}e.on.unlink=h;function f(r,t){var l=this.as,p=l.$._;p.root;var m=l.get||"",k=(r.put||"")[m["#"]]||"";if(!r.put||typeof m["."]=="string"&&i===k[m["."]]){if(i!==p.put||!p.soul&&!p.has)return;p.ack=(p.ack||0)+1,p.on("in",{get:p.get,put:p.put=i,$:p.$,"@":r["@"]});return}(r._||{}).miss=1,e.on.put(r)}var u={},i,w=String.random,x=e.valid,n=function(r,t){return r&&Object.prototype.hasOwnProperty.call(r,t)},y=e.state,c=y.is,v=y.ify})(b,"./chain"),b(function(B){var e=b("./root");e.chain.get=function(i,w,x){var n,y;if(typeof i=="string"){if(i.length==0)return(n=this.chain())._.err={err:e.log("0 length key!",i)},w&&w.call(n,n._.err),n;var c=this,v=c._,r=v.next||h;(n=r[i])||(n=i&&a(i,c)),n=n&&n.$}else if(typeof i=="function"){let S=function(T,P,C){if(!S.stun&&!((O=l.pass)&&!O[p])){var g=T.$._,o=(T.$$||"")._,_=(o||g).put,A=!g.has&&!g.soul,E={},O;if((A||u===_)&&(_=u===((O=T.put)||"")["="]?u===(O||"")[":"]?O:O[":"]:O["="]),typeof(O=e.valid(_))=="string"&&(_=u===(O=l.$.get(O)._.put)?t.not?u:_:O),!(t.not&&u===_)){if(u===t.stun){if((O=l.stun)&&O.on&&(v.$.back(function($){if(O.on(""+$.id,E={}),(E.run||0)<S.id)return E}),!E.run&&O.on(""+g.id,E={}),!E.run&&o&&O.on(""+o.id,E={}),S.id>E.run&&((!E.stun||E.stun.end)&&(E.stun=O.on("stun"),E.stun=E.stun&&E.stun.last),E.stun&&!E.stun.end))){(E.stun.add||(E.stun.add={}))[p]=function(){S(T,P,1)};return}if(u===_&&(C=0),(O=l.hatch)&&!O.end&&u===t.hatch&&!C){if(m[g.$._.id])return;m[g.$._.id]=1,O.push(function(){S(T,P,1)});return}m={}}if(l.pass){if(l.pass[p+g.id])return;l.pass[p+g.id]=1}if(t.on){t.ok.call(g.$,_,g.get,T,P||S);return}if(t.v2020){t.ok(T,P||S);return}Object.keys(T).forEach(function($){O[$]=T[$]},O={}),T=O,T.put=_,t.ok.call(t.as,T,P||S)}}};if(w===!0)return s(this,i,w,x),this;n=this;var v=n._,t=w||{},l=v.root,p;t.at=v,t.ok=i;var m={};return S.at=v,(v.any||(v.any={}))[p=String.random(7)]=S,S.off=function(){S.stun=1,v.any&&delete v.any[p]},S.rid=d,S.id=t.run||++l.once,y=l.pass,(l.pass={})[p]=1,t.out=t.out||{get:{}},v.on("out",t.out),l.pass=y,n}else{if(typeof i=="number")return this.get(""+i,w,x);if(typeof(y=f(i))=="string")return this.get(y,w,x);(y=this.get.next)&&(n=y(this,i))}return n?(w&&typeof w=="function"&&n.get(w,x),n):((n=this.chain())._.err={err:e.log("Invalid get request!",i)},w&&w.call(n,n._.err),n)};function a(i,w){var x=w._,n=x.next,y=w.chain(),c=y._;return n||(n=x.next={}),n[c.get=i]=c,w===x.root.$?c.soul=i:(x.soul||x.has)&&(c.has=i),c}function s(i,w,x,n){var y=i._,c=0,v;return(v=y.soul||y.link)?w(v,n,y):y.jam?y.jam.push([w,n]):(y.jam=[[w,n]],i.get(function(t,l){if(!(u===t.put&&!y.root.opt.super&&(v=Object.keys(y.root.opt.peers).length)&&++c<=v)){l.rid(t);var p=(p=t.$)&&p._||{},m=0,k;for(v=y.jam,delete y.jam;k=v[m++];){var S=k[0];k=k[1],S&&S(p.link||p.soul||e.valid(t.put)||((t.put||{})._||{})["#"],k,t,l)}}},{out:{get:{".":!0}}}),i)}function d(i){var w=this.at||this.on;if(!i||w.soul||w.has)return this.off();if(i=(i=(i=i.$||i)._||i).id){w.map;var x;if((x=this.seen||(this.seen={}))[i])return!0;x[i]=!0}}var h={},f=e.valid,u})(b,"./get"),b(function(B){var e=b("./root");e.chain.put=function(n,y,c){var v=this,r=v._,t=r.root;c=c||{},c.root=r.root,c.run||(c.run=t.once),a(c,r.id),c.ack=c.ack||y,c.via=c.via||v,c.data=c.data||n,c.soul||(c.soul=r.soul||typeof y=="string"&&y);var l=c.state=c.state||e.state();return typeof n=="function"?(n(function(p){c.data=p,v.put(f,f,c)}),v):c.soul?(c.$=t.$.get(c.soul),c.todo=[{it:c.data,ref:c.$}],c.turn=c.turn||i,c.ran=c.ran||s,function p(){var m=c.todo,k=m.pop(),S=k.it;k.ref&&k.ref._.id;var T,P,C,g,o;if(a(c,k.ref),(g=k.todo)&&(P=g.pop(),S=S[P],g.length&&m.push(k)),P&&(m.path||(m.path=[])).push(P),!(T=w(S))&&!(o=e.is(S))){if(!Object.plain(S)){s.err(c,"Invalid data: "+h(S)+" at "+(c.via.back(function(O){O.get&&g.push(O.get)},g=[])||g.join("."))+"."+(m.path||[]).join("."));return}for(var _=c.seen||(c.seen=[]),A=_.length;A--;)if(S===(g=_[A]).it){T=S=g.link;break}}if(P&&T)k.node=x(k.node,P,l,S);else{let O=function($,U){var D=C.link["#"];U&&(U.off(),U.rid($));var j=D||$.soul||(g=($.$$||$.$)._||"").soul||g.link||((g=g.put||"")._||"")["#"]||g["#"]||((g=$.put||"")&&$.$$?g["#"]:(g["="]||g[":"]||"")["#"]);if(!D&&a(c,$.$),!j&&!k.link["#"]){(k.wait||(k.wait=[])).push(function(){O($,U)});return}j||(j=[],($.$$||$.$).back(function(G){if(g=G.soul||G.link)return j.push(g);j.push(G.get)}),j=j.reverse().join("/")),C.link["#"]=j,!o&&(((c.graph||(c.graph={}))[j]=C.node||(C.node={_:{}}))._["#"]=j),delete c.wait[E],C.wait&&setTimeout.each(C.wait,function(G){G&&G()}),c.ran(c)};if(!c.seen){s.err(c,"Data at root of graph must be a node (an object).");return}c.seen.push(C={it:S,link:{},todo:o?[]:Object.keys(S).sort().reverse(),path:(m.path||[]).slice(),up:k}),k.node=x(k.node,P,l,C.link),!o&&C.todo.length&&m.push(C);var E=c.seen.length;(c.wait||(c.wait={}))[E]="",g=(C.ref=o?S:P?k.ref.get(P):k.ref)._,(g=S&&(S._||"")["#"]||g.soul||g.link)?O({soul:g}):C.ref.get(O,{run:c.run,v2020:1,out:{get:{".":" "}}})}if(!m.length)return c.ran(c);c.turn(p)}(),v):(d(c),v)};function a(n,y){if(y){y=(y._||"").id||y;var c=n.root.stun||(n.root.stun={on:e.on}),v={},r;n.stun||(n.stun=c.on("stun",function(){})),(r=c.on(""+y))&&r.the.last.next(v),!(v.run>=n.run)&&c.on(""+y,function(t){if(n.stun.end){this.off(),this.to.next(t);return}t.run=t.run||n.run,t.stun=t.stun||n.stun})}}function s(n){if(n.err){s.end(n.stun,n.root);return}if(!(n.todo.length||n.end||!Object.empty(n.wait))){n.end=1;var y=n.$.back(-1)._,c=y.root,v=y.ask(function(p){c.on("ack",p),p.err&&!p.lack&&e.log(p),++r>(n.acks||0)&&this.off(),n.ack&&n.ack(p,this)},n.opt),r=0,t=n.stun,l;(l=function(){t&&(s.end(t,c),setTimeout.each(Object.keys(t=t.add||""),function(p){(p=t[p])&&p()}))}).hatch=l,n.ack&&!n.ok&&(n.ok=n.acks||9),n.via._.on("out",{put:n.out=n.graph,ok:n.ok&&{"@":n.ok+1},opt:n.opt,"#":v,_:l})}}s.end=function(n,y){n.end=u,n.the.to===n&&n===n.the.last&&delete y.stun,n.off()},s.err=function(n,y){(n.ack||u).call(n,n.out={err:n.err=e.log(y)}),n.ran(n)};function d(n){var y=n.via._,c;n.via=n.via.back(function(v){if(v.soul||!v.get)return v.$;c=n.data,(n.data={})[v.get]=c}),(!n.via||!n.via._.soul)&&(n.via=y.root.$.get(((n.data||"")._||"")["#"]||y.$.back("opt.uuid")())),n.via.put(n.data,n.ack,n)}function h(n,y){return n&&(y=n.constructor)&&y.name||typeof n}var f,u=function(){},i=setTimeout.turn,w=e.valid,x=e.state.ify})(b,"./put"),b(function(B){var e=b("./root");b("./chain"),b("./back"),b("./put"),b("./get"),B.exports=e})(b,"./index"),b(function(B){var e=b("./index");e.chain.on=function(d,h,f,u){var i=this,w=i._;w.root;var x;if(typeof d=="string")return h?(x=w.on(d,h,f||w,u),f&&f.$&&(f.subs||(f.subs=[])).push(x),i):w.on(d);var n=h;return(n=n===!0?{change:!0}:n||{}).not=1,n.on=1,i.get(d,n),i},e.chain.once=function(d,h){if(h=h||{},!d)return a(this);var f=this,u=f._,i=u.root;u.put;var w=String.random(7),x;return f.get(function(n,y,c,v){var r=this,t=r._,l=t.one||(t.one={});if(v.stun||l[w]==="")return;if((x=e.valid(n))===!0){p();return}if(typeof x=="string")return;clearTimeout((u.one||"")[w]),clearTimeout(l[w]),l[w]=setTimeout(p,h.wait||99);function p(m){if(!t.has&&!t.soul&&(t={put:n,get:y}),s===(x=t.put)&&(x=((c.$$||"")._||"").put),typeof e.valid(x)=="string"&&(x=i.$.get(x)._.put,x===s&&!m)){l[w]=setTimeout(function(){p(1)},h.wait||99);return}v.stun||l[w]!==""&&(l[w]="",(u.soul||u.has)&&v.off(),d.call(r,x,t.get),clearTimeout(l[w]))}},{on:1}),f};function a(d,h,f){return e.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(f=d.chain())._.nix=d.once(function(u,i){f._.on("in",this._)}),f._.lex=d._.lex,f}e.chain.off=function(){var d=this,h=d._,f,u=h.back;if(u)return h.ack=0,(f=u.next)&&f[h.get]&&delete f[h.get],(f=u.any)&&(delete u.any,u.any={}),(f=u.ask)&&delete f[h.get],(f=u.put)&&delete f[h.get],(f=h.soul)&&delete u.root.graph[f],(f=h.map)&&Object.keys(f).forEach(function(i,w){w=f[i],w.link&&u.root.$.get(w.link).off()}),(f=h.next)&&Object.keys(f).forEach(function(i,w){w=f[i],w.$.off()}),h.on("off",{}),d};var s})(b,"./on"),b(function(B){var e=b("./index"),a=e.chain.get.next;e.chain.get.next=function(f,u){var i;return Object.plain(u)?(i=((i=u["#"])||"")["="]||i)?f.get(i):((i=f.chain()._).lex=u,f.on("in",function(w){String.match(w.get||(w.put||"")["."],u["."]||u["#"]||u)&&i.on("in",w),this.to.next(w)}),i.$):(a||d)(f,u)},e.chain.map=function(f,u,i){var w=this,x=w._,n,y;return Object.plain(f)&&(n=f["."]?f:{".":f},f=h),f?(e.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),y=w.chain(),w.map().on(function(c,v,r,t){var l=(f||d).call(this,c,v,r,t);if(h!==l){if(c===l)return y._.on("in",r);if(e.is(l))return y._.on("in",l._);var p={};Object.keys(r.put).forEach(function(m){p[m]=r.put[m]},p),p["="]=l,y._.on("in",{get:v,put:p})}}),y):((y=x.each)||((x.each=y=w.chain())._.lex=n||y._.lex||x.lex,y._.nix=w.back("nix"),w.on("in",s,y._)),y)};function s(f){this.to.next(f);var u=this.as,i=f.$,w=i._,x=f.put,n;!w.soul&&!f.$$||(n=u.lex)&&!String.match(f.get||(x||"")["."],n["."]||n["#"]||n)||e.on.link(f,u)}var d=function(){},h})(b,"./map"),b(function(B){var e=b("./index");e.chain.set=function(a,s,d){var h=this,f=h.back(-1),u,i;return s=s||function(){},d=d||{},d.item=d.item||a,(u=((a||"")._||"")["#"])&&((a={})["#"]=u),typeof(i=e.valid(a))=="string"?h.get(u=i).put(a,s,d):e.is(a)?(h.put(function(w){a.get(function(x,n,y){if(!x)return s.call(h,{err:e.log('Only a node can be linked! Not "'+y.put+'"!')});(i={})[x]={"#":x},w(i)},!0)}),a):(Object.plain(a)&&(a=f.get(u=h.back("opt.uuid")()).put(a)),h.get(u||f.back("opt.uuid")(7)).put(a,s,d))}})(b,"./set"),b(function(B){b("./shim");var e=function(){},a=JSON.parseAsync||function(f,u,i){var w,x=+new Date;try{u(w,JSON.parse(f,i),s.sucks(+new Date-x))}catch(n){u(n)}},s=JSON.stringifyAsync||function(f,u,i,w){var x,n=+new Date;try{u(x,JSON.stringify(f,i,w),s.sucks(+new Date-n))}catch(y){u(y)}};s.sucks=function(f){f>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),s.sucks=e)};function d(f){var u=function(){},i=f.opt||{};i.log=i.log||console.log,i.gap=i.gap||i.wait||0,i.max=i.max||(i.memory?i.memory*999*999:3e8)*.3,i.pack=i.pack||i.max*.01*.01,i.puff=i.puff||9;var w=setTimeout.turn||setTimeout,x=f.dup,n=x.check,y=x.track,c=u.hear=function(t,l){if(t){if(i.max<=t.length)return u.say({dam:"!",err:"Message too big!"},l);u===this&&(c.d+=t.length||0,++c.c);var p=l.SH=+new Date,m=t[0],k;if(m==="["){a(t,function(S,T){if(S||!T)return u.say({dam:"!",err:"DAM JSON parse error."},l);console.STAT&&console.STAT(+new Date,T.length,"# on hear batch");var P=i.puff;(function C(){for(var g=+new Date,o=0,_;o<P&&(_=T[o++]);)u.hear(_,l);T=T.slice(o),console.STAT&&console.STAT(g,+new Date-g,"hear loop"),v(l),T.length&&w(C,0)})()}),t="";return}if(m==="{"||(t["#"]||Object.plain(t))&&(k=t)){if(k)return c.one(k,l,p);a(t,function(S,T){if(S||!T)return u.say({dam:"!",err:"DAM JSON parse error."},l);c.one(T,l,p)});return}}};c.one=function(t,l,C){var m,k,S,T,P;if(t.DBG&&(t.DBG=P={DBG:t.DBG}),P&&(P.h=C),P&&(P.hp=+new Date),(m=t["#"])||(m=t["#"]=String.random(9)),!(S=n(m))&&(k=t["##"],!(k&&(S=t["@"]||t.get&&m)&&x.check(T=S+k)))){if((t._=function(){}).via=u.leap=l,(S=t["><"])&&typeof S=="string"&&S.slice(0,99).split(",").forEach(function(g){this[g]=1},t._.yo={}),S=t.dam){(S=u.hear[S])&&S(t,l,f),y(m);return}(S=t.ok)&&(t._.near=S["/"]);var C=+new Date;P&&(P.is=C),l.SI=m,y.ed=function(g){m===g&&(y.ed=0,(g=x.s[m])&&(g.via=l,t.get&&(g.it=t)))},f.on("in",u.last=t),P&&(P.hd=+new Date),console.STAT&&console.STAT(C,+new Date-C,t.get?"msg get":t.put?"msg put":"msg"),y(m),T&&y(T),u.leap=u.last=null}},c.c=c.d=0,function(){var t=0,l;u.hash=function(k,S){var T,P,C,g=+new Date;s(k.put,function o(_,A){var E=(P||(P=C=A||"")).slice(0,32768);if(T=String.hash(E,T),P=P.slice(32768),P){w(o,0);return}console.STAT&&console.STAT(g,+new Date-g,"say json+hash"),k._.$put=C,k["##"]=T,u.say(k,S),delete k._.$put},p)};function p(k,S){var T;return S instanceof Object?(Object.keys(S).sort().forEach(m,{to:T={},on:S}),T):S}function m(k){this.to[k]=this.on[k]}u.say=function(k,S){var T;if((T=this)&&(T=T.to)&&T.next&&T.next(k),!k)return!1;var P,C,g,o=k["@"],_=k._||(k._=function(){}),A=k.DBG,E=+new Date;if(_.y=_.y||E,S||A&&(A.y=E),(P=k["#"])||(P=k["#"]=String.random(9)),!l&&y(P),!(C=k["##"])&&h!==k.put&&!_.via&&o){u.hash(k,S);return}if(!S&&o&&(S=(T=x.s[o])&&(T.via||(T=T.it)&&(T=T._)&&T.via)||(T=u.last)&&o===T["#"]&&u.leap),!S&&o)return x.s[o]?void 0:(console.STAT&&console.STAT(+new Date,++t,"total no peer to ack to"),!1);if(o&&!k.put&&!C&&((x.s[o]||"").it||"")["##"])return!1;if(!S&&u.way)return u.way(k);if(A&&(A.yh=+new Date),!(g=_.raw)){u.raw(k,S);return}if(A&&(A.yr=+new Date),!S||!S.id){if(!Object.plain(S||i.peers))return!1;var E=+new Date;i.puff;var O=i.peers,$=Object.keys(S||i.peers||{});console.STAT&&console.STAT(E,+new Date-E,"peer keys"),function j(){var G=+new Date;l=1;var I=_.raw;_.raw=g;for(var J=0,R;J<9&&(R=($||"")[J++]);)(R=O[R]||(S||"")[R])&&u.say(k,R);_.raw=I,l=0,$=$.slice(J),console.STAT&&console.STAT(G,+new Date-G,"say loop"),$.length&&(w(j,0),o&&y(o))}();return}if(!S.wire&&u.wire&&u.wire(S),P!==S.last){if(S.last=P,S===_.via||(T=_.yo)&&(T[S.url]||T[S.pid]||T[S.id]))return!1;if(console.STAT&&console.STAT(E,((A||_).yp=+new Date)-(_.y||E),"say prep"),!l&&o&&y(o),S.batch){if(S.tail=(T=S.tail||0)+g.length,S.tail<=i.pack){S.batch+=(T?",":"")+g;return}v(S)}S.batch="[";var U=+new Date;setTimeout(function(){console.STAT&&console.STAT(U,+new Date-U,"0ms TO"),v(S)},i.gap),r(g,S),console.STAT&&o===S.SI&&console.STAT(E,+new Date-S.SH,"say ack")}},u.say.c=u.say.d=0,u.raw=function(k,S){if(!k)return"";var T=k._||{},P,C;if(C=T.raw)return C;if(typeof k=="string")return k;var g=k["##"],o=k["@"];if(g&&o){if(!T.via&&n(o+g))return!1;if(C=(x.s[o]||"").it){if(g===C["##"])return!1;C["##"]||(C["##"]=g)}}if(!k.dam&&!k["@"]){var _=0,A=[];C=i.peers;for(var E in C){var O=C[E];if(A.push(O.url||O.pid||O.id),++_>6)break}_>1&&(k["><"]=A.join())}if(k.put&&(C=k.ok)&&(k.ok={"@":(C["@"]||1)-1,"/":C["/"]==k._.near?u.near:C["/"]}),P=T.$put){C={},Object.keys(k).forEach(function(U){C[U]=k[U]}),C.put=":])([:",s(C,function(U,D){if(!U){var j=+new Date;C=D.indexOf('"put":":])([:"'),$(h,D=D.slice(0,C+6)+P+D.slice(C+14)),console.STAT&&console.STAT(j,+new Date-j,"say slice")}});return}s(k,$);function $(U,D){U||(T.raw=D,u.say(k,S))}}}();function v(t){var l=t.batch,p=typeof l=="string";if(p&&(l+="]"),t.batch=t.tail=null,!!l&&!(p?3>l.length:!l.length)){if(!p)try{l=l.length===1?l[0]:JSON.stringify(l)}catch(m){return i.log("DAM JSON stringify error",m)}l&&r(l,t)}}function r(t,l){try{var p=l.wire;l.say?l.say(t):p.send&&p.send(t),u.say.d+=t.length||0,++u.say.c}catch{(l.queue=l.queue||[]).push(t)}}return u.near=0,u.hi=function(t){var l=t.wire,p;if(!l){u.wire(t.length&&{url:t,id:t}||t);return}t.id?i.peers[t.url||t.id]=t:(p=t.id=t.id||t.url||String.random(9),u.say({dam:"?",pid:f.opt.pid},i.peers[p]=t),delete x.s[t.last]),t.met||(u.near++,t.met=+new Date,f.on("hi",t)),p=t.queue,t.queue=[],setTimeout.each(p||[],function(m){r(m,t)},0,9)},u.bye=function(t){t.met&&--u.near,delete t.met,f.on("bye",t);var l=+new Date;l=l-(t.met||l),u.bye.time=((u.bye.time||l)+l)/2},u.hear["!"]=function(t,l){i.log("Error:",t.err)},u.hear["?"]=function(t,l){t.pid&&(l.pid||(l.pid=t.pid),t["@"])||(u.say({dam:"?",pid:i.pid,"@":t["#"]},l),delete x.s[l.last])},u.hear.mob=function(t,l){if(t.peers){var p=Object.keys(t.peers),m=p[Math.random()*p.length>>0];m&&(u.bye(l),u.hi(m))}},f.on("create",function(t){t.opt.pid=t.opt.pid||String.random(9),this.to.next(t),t.on("out",u.say)}),f.on("bye",function(t,l){t=i.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(l=t.wire)&&l.close&&l.close(),delete i.peers[t.id],t.wire=null}),f.on("bye",function(t,l){this.to.next(t),(l=console.STAT)&&(l.peers=u.near),(l=t.url)&&setTimeout(function(){},i.lack||9e3)}),f.on("hi",function(t,l){if(this.to.next(t),(l=console.STAT)&&(l.peers=u.near),!i.super){var p=Object.keys(f.next||"");p.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(p,function(m){var k=f.next[m];if(i.super||(k.ask||"")[""]){u.say({get:{"#":m}},t);return}setTimeout.each(Object.keys(k.ask||""),function(S){S&&u.say({"##":String.hash((f.graph[m]||"")[S]),get:{"#":m,".":S}},t)})})}}),u}var h;try{B.exports=d}catch{}})(b,"./mesh"),b(function(B){var e=b("./index");e.Mesh=b("./mesh"),e.on("opt",function(s){if(this.to.next(s),s.once)return;var d=s.opt;if(d.WebSocket===!1)return;var h=e.window||{},f=d.WebSocket||h.WebSocket||h.webkitWebSocket||h.mozWebSocket;if(!f)return;d.WebSocket=f;var u=d.mesh=d.mesh||e.Mesh(s);u.wire||d.wire,u.wire=d.wire=i;function i(y){try{if(!y||!y.url)return v&&v(y);var c=y.url.replace(/^http/,"ws"),v=y.wire=new d.WebSocket(c);return v.onclose=function(){x(y),d.mesh.bye(y)},v.onerror=function(r){x(y)},v.onopen=function(){d.mesh.hi(y)},v.onmessage=function(r){r&&d.mesh.hear(r.data||r,y)},v}catch{d.mesh.bye(y)}}setTimeout(function(){!d.super&&s.on("out",{dam:"hi"})},1);var w=2*999;function x(y){clearTimeout(y.defer),d.peers[y.url]&&(n&&y.retry<=0||(y.retry=(y.retry||d.retry+1||60)-(-y.tried+(y.tried=+new Date)<w*4?1:0),y.defer=setTimeout(function c(){if(n&&n.hidden)return setTimeout(c,w);i(y)},w)))}var n=""+a!=typeof document&&document});var a})(b,"./websocket"),b(function(B){if(!(typeof Gun>"u")){var e=function(){},a;try{a=(Gun.window||e).localStorage}catch{}a||(Gun.log("Warning: No localStorage exists to persist data to!"),a={setItem:function(d,h){this[d]=h},removeItem:function(d){delete this[d]},getItem:function(d){return this[d]}});var s=JSON.stringifyAsync||function(d,h,f,u){var i;try{h(i,JSON.stringify(d,f,u))}catch(w){h(w)}};Gun.on("create",function d(h){this.to.next(h);var f=h.opt;h.graph;var u=[],i,w,x,n;if(f.localStorage===!1)return;f.prefix=f.file||"gun/";try{i=d[f.prefix]=d[f.prefix]||JSON.parse(x=a.getItem(f.prefix))||{}}catch{i=d[f.prefix]={}}x=(x||"").length,h.on("get",function(c){this.to.next(c);var v=c.get,r,t,l,p;!v||!(r=v["#"])||(t=i[r]||p,t&&(l=v["."])&&!Object.plain(l)&&(t=Gun.state.ify({},l,Gun.state.is(t,l),t[l],r)),Gun.on.get.ack(c,t))}),h.on("put",function(c){this.to.next(c);var v=c.put,r=v["#"],t=v["."],l=c["#"],p=c.ok||"";if(i[r]=Gun.state.ify(i[r],t,v[">"],v[":"],r),n&&x>4999880){h.on("in",{"@":l,err:"localStorage max!"});return}!c["@"]&&(!c._.via||Math.random()<p["@"]/p["/"])&&u.push(l),!w&&(w=setTimeout(y,9+x/333))});function y(){if(!u.length&&((setTimeout.turn||"").s||"").length){setTimeout(y,99);return}var c=u;clearTimeout(w),w=!1,u=[],s(i,function(v,r){try{!v&&a.setItem(f.prefix,r)}catch(t){v=n=t||"localStorage failure"}v&&(Gun.log(v+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),h.on("localStorage:error",{err:v,get:f.prefix,put:i})),x=r.length,setTimeout.each(c,function(t){h.on("in",{"@":t,err:v,ok:0})},0,99)})}})}})(b,"./localStorage")})(),function(){var C;if(""+C!=typeof Gun){var b=function(g){console.warn("Warning! Deprecated internal utility will break in next version:",g)},N=Gun;N.fn=N.fn||{is:function(g){return b("fn"),!!g&&typeof g=="function"}},N.bi=N.bi||{is:function(g){return b("bi"),g instanceof Boolean||typeof g=="boolean"}},N.num=N.num||{is:function(g){return b("num"),!B(g)&&(g-parseFloat(g)+1>=0||g===1/0||g===-1/0)}},N.text=N.text||{is:function(g){return b("text"),typeof g=="string"}},N.text.ify=N.text.ify||function(g){return b("text.ify"),N.text.is(g)?g:typeof JSON<"u"?JSON.stringify(g):g&&g.toString?g.toString():g},N.text.random=N.text.random||function(g,o){b("text.random");var _="";for(g=g||24,o=o||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";g>0;)_+=o.charAt(Math.floor(Math.random()*o.length)),g--;return _},N.text.match=N.text.match||function(g,o){var _,A;return b("text.match"),typeof g!="string"?!1:(typeof o=="string"&&(o={"=":o}),o=o||{},_=o["="]||o["*"]||o[">"]||o["<"],g===_?!0:A!==o["="]?!1:(_=o["*"]||o[">"]||o["<"],g.slice(0,(_||"").length)===_?!0:A!==o["*"]?!1:A!==o[">"]&&A!==o["<"]?g>=o[">"]&&g<=o["<"]:A!==o[">"]&&g>=o[">"]||A!==o["<"]&&g<=o["<"]))},N.text.hash=N.text.hash||function(g,o){if(b("text.hash"),typeof g=="string"){if(o=o||0,!g.length)return o;for(var _=0,A=g.length,E;_<A;++_)E=g.charCodeAt(_),o=(o<<5)-o+E,o|=0;return o}},N.list=N.list||{is:function(g){return b("list"),g instanceof Array}},N.list.slit=N.list.slit||Array.prototype.slice,N.list.sort=N.list.sort||function(g){return b("list.sort"),function(o,_){return!o||!_?0:(o=o[g],_=_[g],o<_?-1:o>_?1:0)}},N.list.map=N.list.map||function(g,o,_){return b("list.map"),T(g,o,_)},N.list.index=1,N.obj=N.boj||{is:function(g){return b("obj"),g?g instanceof Object&&g.constructor===Object||Object.prototype.toString.call(g).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},N.obj.put=N.obj.put||function(g,o,_){return b("obj.put"),(g||{})[o]=_,g},N.obj.has=N.obj.has||function(g,o){return b("obj.has"),g&&Object.prototype.hasOwnProperty.call(g,o)},N.obj.del=N.obj.del||function(g,o){if(b("obj.del"),!!g)return g[o]=null,delete g[o],g},N.obj.as=N.obj.as||function(g,o,_,A){return b("obj.as"),g[o]=g[o]||(A===_?{}:_)},N.obj.ify=N.obj.ify||function(g){if(b("obj.ify"),l(g))return g;try{g=JSON.parse(g)}catch{g={}}return g},function(){var g;function o(_,A){m(this,A)&&g!==this[A]||(this[A]=_)}N.obj.to=N.obj.to||function(_,A){return b("obj.to"),A=A||{},T(_,o,A),A}}(),N.obj.copy=N.obj.copy||function(g){return b("obj.copy"),g&&JSON.parse(JSON.stringify(g))},function(){function g(o,_){var A=this.n,E;if(!(A&&(_===A||l(A)&&m(A,_)))&&E!==_)return!0}N.obj.empty=N.obj.empty||function(o,_){return b("obj.empty"),o?!T(o,g,{n:_}):!0}}(),function(){function g(A,E){if(arguments.length===2){g.r=g.r||{},g.r[A]=E;return}g.r=g.r||[],g.r.push(A)}var o=Object.keys,_;Object.keys=Object.keys||function(A){return _(A,function(E,O,$){$(O)})},N.obj.map=_=N.obj.map||function(A,E,O){b("obj.map");var $,U=0,D,j,G,I,J=typeof E=="function";if(g.r=$,o&&l(A)&&(G=o(A),I=!0),O=O||{},B(A)||G)for(D=(G||A).length;U<D;U++){var R=U+N.list.index;if(J){if(j=I?E.call(O,A[G[U]],G[U],g):E.call(O,A[U],R,g),j!==$)return j}else if(E===A[I?G[U]:U])return G?G[U]:R}else for(U in A)if(J){if(m(A,U)&&(j=O?E.call(O,A[U],U,g):E(A[U],U,g),j!==$))return j}else if(E===A[U])return U;return J?g.r:N.list.index?0:-1}}(),N.time=N.time||{},N.time.is=N.time.is||function(g){return b("time"),g?g instanceof Date:+new Date().getTime()};var r=N.fn.is,B=N.list.is,t=N.obj,l=t.is,m=t.has,T=t.map,e={};e.is=function(g){return b("val.is"),g===C?!1:g===null?!0:g===1/0?!1:d(g)||s(g)||n(g)?!0:e.link.is(g)||!1},e.link=e.rel={_:"#"},function(){e.link.is=function(o){if(b("val.link.is"),o&&o[a]&&!o._&&l(o)){var _={};if(T(o,g,_),_.id)return _.id}return!1};function g(o,_){var A=this;if(A.id)return A.id=!1;if(_==a&&d(o))A.id=o;else return A.id=!1}}(),e.link.ify=function(g){return b("val.link.ify"),S({},a,g)},N.obj.has._=".";var a=e.link._,C,s=N.bi.is,n=N.num.is,d=N.text.is,t=N.obj,l=t.is,S=t.put,T=t.map;N.val=N.val||e;var h={_:"_"};h.soul=function(g,o){return b("node.soul"),g&&g._&&g._[o||i]},h.soul.ify=function(g,o){return b("node.soul.ify"),o=typeof o=="string"?{soul:o}:o||{},g=g||{},g._=g._||{},g._[i]=o.soul||g._[i]||u(),g},h.soul._=e.link._,function(){h.is=function(o,_,A){b("node.is");var E;return l(o)&&(E=h.soul(o))?!T(o,g,{as:A,cb:_,s:E,n:o}):!1};function g(o,_){if(_!==h._){if(!e.is(o))return!0;this.cb&&this.cb.call(this.as,o,_,this.n,this.s)}}}(),function(){h.ify=function(o,_,A){return b("node.ify"),_?typeof _=="string"?_={soul:_}:typeof _=="function"&&(_={map:_}):_={},_.map&&(_.node=_.map.call(A,o,C,_.node||{})),(_.node=h.soul.ify(_.node||{},_))&&T(o,g,{o:_,as:A}),_.node};function g(o,_){var A=this.o,E,O;if(A.map){E=A.map.call(this.as,o,""+_,A.node),O===E?p(A.node,_):A.node&&(A.node[_]=E);return}e.is(o)&&(A.node[_]=o)}}();var t=N.obj,l=t.is,p=t.del,T=t.map,f=N.text,u=f.random,i=h.soul._,C;N.node=N.node||h;var w=N.state;w.lex=function(){return b("state.lex"),w().toString(36).replace(".","")},w.to=function(g,o,_){b("state.to");var A=(g||{})[o];return l(A)&&(A=P(A)),w.ify(_,o,w.is(g,o),A,h.soul(g))},function(){w.map=function(o,_,A){b("state.map");var E,O=l(O=o||_)?O:null;return o=r(o=o||_)?o:null,O&&!o?(_=n(_)?_:w(),O[c]=O[c]||{},T(O,g,{o:O,s:_}),O):(A=A||l(_)?_:E,_=n(_)?_:w(),function($,U,D,j){if(!o)return g.call({o:D,s:_},$,U),$;o.call(A||this||{},$,U,D,j),!(m(D,U)&&E===D[U])&&g.call({o:D,s:_},$,U)})};function g(o,_){c!==_&&w.ify(this.o,_,this.s)}}();var t=N.obj;t.as;var m=t.has,l=t.is,T=t.map,P=t.copy,x=N.num,n=x.is,y=N.fn,r=y.is,c=h._,C,v={};(function(){v.is=function(_,A,E,O){return b("graph.is"),!_||!l(_)||k(_)?!1:!T(_,g,{cb:A,fn:E,as:O})};function g(_,A){if(!_||A!==h.soul(_)||!h.is(_,this.fn,this.as))return!0;this.cb&&(o.n=_,o.as=this.as,this.cb.call(o.as,_,A,o))}function o(_){_&&h.is(o.n,_,o.as)}})(),function(){v.ify=function(O,$,U){b("graph.ify");var D={path:[],obj:O};return $?typeof $=="string"?$={soul:$}:typeof $=="function"&&($.map=$):$={},typeof U=="string"&&($.soul=$.soul||U,U=C),$.soul&&(D.link=e.link.ify($.soul)),$.shell=(U||{}).shell,$.graph=$.graph||{},$.seen=$.seen||[],$.as=$.as||U,g($,D),$.root=D.node,$.graph};function g(O,$){var U;return(U=E(O,$))?U:($.env=O,$.soul=_,h.ify($.obj,o,$)&&($.link=$.link||e.link.ify(h.soul($.node)),$.obj!==O.shell&&(O.graph[e.link.is($.link)]=$.node)),$)}function o(O,$,U){var D=this,j=D.env,G,I;if(h._===$&&m(O,e.link._))return U._;if(G=A(O,$,U,D,j)){if($||(D.node=D.node||U||{},m(O,h._)&&h.soul(O)&&(D.node._=P(O._)),D.node=h.soul.ify(D.node,e.link.is(D.link)),D.link=D.link||e.link.ify(h.soul(D.node))),(I=j.map)&&(I.call(j.as||{},O,$,U,D),m(U,$))){if(O=U[$],C===O){p(U,$);return}if(!(G=A(O,$,U,D,j)))return}if(!$)return D.node;if(G===!0)return O;if(I=g(j,{obj:O,path:D.path.concat($)}),!!I.node)return I.link}}function _(O){var $=this,U=e.link.is($.link),D=$.env.graph;$.link=$.link||e.link.ify(O),$.link[e.link._]=O,$.node&&$.node[h._]&&($.node[h._][e.link._]=O),m(D,U)&&(D[O]=D[U],p(D,U))}function A(O,$,U,D,j){var G;if(e.is(O))return!0;if(l(O))return 1;if(G=j.invalid)return O=G.call(j.as||{},O,$,U),A(O,$,U,D,j);j.err="Invalid value at '"+D.path.concat($).join(".")+"'!",N.list.is(O)&&(j.err+=" Use `.set(item)` instead of an Array.")}function E(O,$){for(var U=O.seen,D=U.length,j;D--;)if(j=U[D],$.obj===j.obj)return j;U.push($)}}(),v.node=function(g){b("graph.node");var o=h.soul(g);if(o)return S({},o,g)},function(){v.to=function(o,_,A){if(b("graph.to"),!!o){var E={};return A=A||{seen:{}},T(o[_],g,{obj:E,graph:o,opt:A}),E}};function g(o,_){var A,E;if(h._===_){if(k(o,e.link._))return;this.obj[_]=P(o);return}if(!(A=e.link.is(o))){this.obj[_]=o;return}if(E=this.opt.seen[A]){this.obj[_]=E;return}this.obj[_]=this.opt.seen[A]=v.to(this.graph,A,this.opt)}}();var r=N.fn.is,t=N.obj,l=t.is,p=t.del,m=t.has,k=t.empty,S=t.put,T=t.map,P=t.copy,C;N.graph=N.graph||v}}()}(rt)),rt.exports}var at,dt;function St(){return dt||(dt=1,at=st()),at}var At=St();const jt=xt(At);var it={exports:{}};it.exports;var yt;function Tt(){return yt||(yt=1,function(L){(function(){function b(B,e){return e?bt(B):B.slice?b[a(B)]:function(s,d){B(s={exports:{}}),b[a(d)]=s.exports};function a(s){return s.split("/").slice(-1).toString().replace(".js","")}}var N=L;b(function(B){typeof self<"u"&&(B.window=self),typeof window<"u"&&(B.window=window);var e=B.window||B,a,s=e.SEA||{};(s.window=B.window)&&(s.window.SEA=s);try{a+""!=typeof N&&(N.exports=s)}catch{}B.exports=s})(b,"./root"),b(function(B){var e=b("./root");try{e.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(b,"./https"),b(function(B){var e;if(e+""==typeof btoa){if(e+""==typeof Buffer)try{ut.Buffer=b("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}ut.btoa=function(a){return Buffer.from(a,"binary").toString("base64")},ut.atob=function(a){return Buffer.from(a,"base64").toString("binary")}}})(b,"./base64"),b(function(B){b("./base64");function e(){}Object.assign(e,{from:Array.from}),e.prototype=Object.create(Array.prototype),e.prototype.toString=function(a,s,d){a=a||"utf8",s=s||0;const h=this.length;if(a==="hex"){const f=new Uint8Array(this);return[...Array((d&&d+1||h)-s).keys()].map(u=>f[u+s].toString(16).padStart(2,"0")).join("")}if(a==="utf8")return Array.from({length:(d||h)-s},(f,u)=>String.fromCharCode(this[u+s])).join("");if(a==="base64")return btoa(this)},B.exports=e})(b,"./array"),b(function(B){b("./base64");var e=b("./array");function a(...s){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),a.from(...s)}a.prototype=Object.create(Array.prototype),Object.assign(a,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const s=arguments[0];let d;if(typeof s=="string"){const f=arguments[1]||"utf8";if(f==="hex"){const u=s.match(/([\da-fA-F]{2})/g).map(i=>parseInt(i,16));if(!u||!u.length)throw new TypeError("Invalid first argument for type 'hex'.");d=e.from(u)}else if(f==="utf8"||f==="binary"){const u=s.length,i=new Uint16Array(u);Array.from({length:u},(w,x)=>i[x]=s.charCodeAt(x)),d=e.from(i)}else if(f==="base64"){const u=atob(s),i=u.length,w=new Uint8Array(i);Array.from({length:i},(x,n)=>w[n]=u.charCodeAt(n)),d=e.from(w)}else f==="binary"?d=e.from(s):console.info("SafeBuffer.from unknown encoding: "+f);return d}if(s.byteLength,s.byteLength?s.byteLength:s.length){let f;return s instanceof ArrayBuffer&&(f=new Uint8Array(s)),e.from(f||s)}},alloc(s,d=0){return e.from(new Uint8Array(Array.from({length:s},()=>d)))},allocUnsafe(s){return e.from(new Uint8Array(Array.from({length:s})))},concat(s){if(!Array.isArray(s))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return e.from(s.reduce((d,h)=>d.concat(Array.from(h)),[]))}}),a.prototype.from=a.from,a.prototype.toString=e.prototype.toString,B.exports=a})(b,"./buffer"),b(function(B){const e=b("./root"),a={Buffer:b("./buffer")};var s={},d;if(JSON.parseAsync=JSON.parseAsync||function(f,u,i){var w;try{u(w,JSON.parse(f,i))}catch(x){u(x)}},JSON.stringifyAsync=JSON.stringifyAsync||function(f,u,i,w){var x;try{u(x,JSON.stringify(f,i,w))}catch(n){u(n)}},a.parse=function(f,u){return new Promise(function(i,w){JSON.parseAsync(f,function(x,n){x?w(x):i(n)},u)})},a.stringify=function(f,u,i){return new Promise(function(w,x){JSON.stringifyAsync(f,function(n,y){n?x(n):w(y)},u,i)})},e.window&&(a.crypto=e.window.crypto||e.window.msCrypto,a.subtle=(a.crypto||s).subtle||(a.crypto||s).webkitSubtle,a.TextEncoder=e.window.TextEncoder,a.TextDecoder=e.window.TextDecoder,a.random=f=>a.Buffer.from(a.crypto.getRandomValues(new Uint8Array(a.Buffer.alloc(f))))),!a.TextDecoder){const{TextEncoder:f,TextDecoder:u}=b((d+""==typeof N?".":"")+"./lib/text-encoding",1);a.TextDecoder=u,a.TextEncoder=f}if(!a.crypto)try{var h=b("crypto",1);Object.assign(a,{crypto:h,random:u=>a.Buffer.from(h.randomBytes(u))});const{Crypto:f}=b("@peculiar/webcrypto",1);a.ossl=a.subtle=new f({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}B.exports=a})(b,"./shim"),b(function(B){var e=b("./root"),a=b("./shim"),s={};s.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},s.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},s.ecdh={name:"ECDH",namedCurve:"P-256"},s.jwk=function(d,h){d=d.split(".");var f=d[0],u=d[1],i={kty:"EC",crv:"P-256",x:f,y:u,ext:!0};return i.key_ops=h?["sign"]:["verify"],h&&(i.d=h),i},s.keyToJwk=function(d){return{kty:"oct",k:d.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},s.recall={validity:12*60*60,hook:function(d){return d}},s.check=function(d){return typeof d=="string"&&d.slice(0,4)==="SEA{"},s.parse=async function(h){try{var f=typeof h=="string";return f&&h.slice(0,4)==="SEA{"&&(h=h.slice(3)),f?await a.parse(h):h}catch{}return h},e.opt=s,B.exports=s})(b,"./settings"),b(function(B){var e=b("./shim");B.exports=async function(a,s){var d=typeof a=="string"?a:await e.stringify(a),h=await e.subtle.digest({name:s||"SHA-256"},new e.TextEncoder().encode(d));return e.Buffer.from(h)}})(b,"./sha256"),b(function(B){const e=b("./shim"),a=e.subtle,s=e.ossl?e.ossl:a,d=h=>s.digest({name:"SHA-1"},new ArrayBuffer(h));B.exports=d})(b,"./sha1"),b(function(B){var e=b("./root"),a=b("./shim"),s=b("./settings"),d=b("./sha256"),h;e.work=e.work||(async(f,u,i,w)=>{try{var x=(u||{}).epub||u;if(w=w||{},x instanceof Function&&(i=x,x=h),f=typeof f=="string"?f:await a.stringify(f),(w.name||"").toLowerCase().slice(0,3)==="sha"){var n=a.Buffer.from(await d(f,w.name),"binary").toString(w.encode||"base64");if(i)try{i(n)}catch(r){console.log(r)}return n}x=x||a.random(9);var y=await(a.ossl||a.subtle).importKey("raw",new a.TextEncoder().encode(f),{name:w.name||"PBKDF2"},!1,["deriveBits"]),c=await(a.ossl||a.subtle).deriveBits({name:w.name||"PBKDF2",iterations:w.iterations||s.pbkdf2.iter,salt:new a.TextEncoder().encode(w.salt||x),hash:w.hash||s.pbkdf2.hash},y,w.length||s.pbkdf2.ks*8);f=a.random(f.length);var v=a.Buffer.from(c,"binary").toString(w.encode||"base64");if(i)try{i(v)}catch(r){console.log(r)}return v}catch(r){if(console.log(r),e.err=r,e.throw)throw r;i&&i();return}}),B.exports=e.work})(b,"./work"),b(function(B){var e=b("./root"),a=b("./shim");b("./settings"),e.name=e.name||(async(s,d)=>{try{if(s)try{s()}catch(h){console.log(h)}return}catch(h){if(console.log(h),e.err=h,e.throw)throw h;s&&s();return}}),e.pair=e.pair||(async(s,d)=>{try{var h=a.ossl||a.subtle,f=await a.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async w=>{var x={};x.priv=(await a.subtle.exportKey("jwk",w.privateKey)).d;var n=await a.subtle.exportKey("jwk",w.publicKey);return x.pub=n.x+"."+n.y,x});try{var u=await h.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async w=>{var x={};x.epriv=(await h.exportKey("jwk",w.privateKey)).d;var n=await h.exportKey("jwk",w.publicKey);return x.epub=n.x+"."+n.y,x})}catch(w){if(e.window)throw w;if(w=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw w}u=u||{};var i={pub:f.pub,priv:f.priv,epub:u.epub,epriv:u.epriv};if(s)try{s(i)}catch(w){console.log(w)}return i}catch(w){if(console.log(w),e.err=w,e.throw)throw w;s&&s();return}}),B.exports=e.pair})(b,"./pair"),b(function(B){var e=b("./root"),a=b("./shim"),s=b("./settings"),d=b("./sha256"),h;e.sign=e.sign||(async(f,u,i,w)=>{try{if(w=w||{},!(u||w).priv){if(!e.I)throw"No signing key.";u=await e.I(null,{what:f,how:"sign",why:w.why})}if(h===f)throw"`undefined` not allowed.";var x=await s.parse(f),n=w.check=w.check||x;if(e.verify&&(e.opt.check(n)||n&&n.s&&n.m)&&h!==await e.verify(n,u)){var l=await s.parse(n);if(w.raw||(l="SEA"+await a.stringify(l)),i)try{i(l)}catch(m){console.log(m)}return l}var y=u.pub,c=u.priv,v=s.jwk(y,c),r=await d(x),t=await(a.ossl||a.subtle).importKey("jwk",v,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(p=>(a.ossl||a.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},p,new Uint8Array(r))),l={m:x,s:a.Buffer.from(t,"binary").toString(w.encode||"base64")};if(w.raw||(l="SEA"+await a.stringify(l)),i)try{i(l)}catch(p){console.log(p)}return l}catch(p){if(console.log(p),e.err=p,e.throw)throw p;i&&i();return}}),B.exports=e.sign})(b,"./sign"),b(function(B){var e=b("./root"),a=b("./shim"),s=b("./settings"),d=b("./sha256"),h;e.verify=e.verify||(async(i,w,x,n)=>{try{var y=await s.parse(i);if(w===!1){var c=await s.parse(y.m);if(x)try{x(c)}catch(T){console.log(T)}return c}n=n||{};var v=w.pub||w,r=e.opt.slow_leak?await e.opt.slow_leak(v):await(a.ossl||a.subtle).importKey("jwk",s.jwk(v),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),t=await d(y.m),l,p,m,k;try{if(l=a.Buffer.from(y.s,n.encode||"base64"),p=new Uint8Array(l),m=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},r,p,new Uint8Array(t)),!m)throw"Signature did not match."}catch{if(e.opt.fallback)return await e.opt.fall_verify(i,w,x,n)}var S=m?await s.parse(y.m):h;if(x)try{x(S)}catch(T){console.log(T)}return S}catch(T){if(console.log(T),e.err=T,e.throw)throw T;x&&x();return}}),B.exports=e.verify;var f={};e.opt.slow_leak=i=>{if(f[i])return f[i];var w=s.jwk(i);return f[i]=(a.ossl||a.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),f[i]};var u=e.opt;e.opt.fall_verify=async function(i,w,x,n,y){if(y===e.opt.fallback)throw"Signature did not match";y=y||1;var c=i||"";i=e.opt.unpack(i)||i;var v=await s.parse(i),r=w.pub||w,t=await e.opt.slow_leak(r),l=y<=e.opt.fallback?a.Buffer.from(await a.subtle.digest({name:"SHA-256"},new a.TextEncoder().encode(await s.parse(v.m)))):await d(v.m),p,m,k;try{if(p=a.Buffer.from(v.s,n.encode||"base64"),m=new Uint8Array(p),k=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},t,m,new Uint8Array(l)),!k)throw"Signature did not match."}catch{try{p=a.Buffer.from(v.s,"utf8"),m=new Uint8Array(p),k=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},t,m,new Uint8Array(l))}catch{if(!k)throw"Signature did not match."}}var S=k?await s.parse(v.m):h;if(u.fall_soul=c["#"],u.fall_key=c["."],u.fall_val=i,u.fall_state=c[">"],x)try{x(S)}catch(T){console.log(T)}return S},e.opt.fallback=2})(b,"./verify"),b(function(B){var e=b("./shim"),a=b("./settings"),s=b("./sha256");const d=async(h,f,u)=>{const i=h+(f||e.random(8)).toString("utf8"),w=e.Buffer.from(await s(i),"binary"),x=a.keyToJwk(w);return await e.subtle.importKey("jwk",x,{name:"AES-GCM"},!1,["encrypt","decrypt"])};B.exports=d})(b,"./aeskey"),b(function(B){var e=b("./root"),a=b("./shim");b("./settings");var s=b("./aeskey"),d;e.encrypt=e.encrypt||(async(h,f,u,i)=>{try{i=i||{};var w=(f||i).epriv||f;if(d===h)throw"`undefined` not allowed.";if(!w){if(!e.I)throw"No encryption key.";f=await e.I(null,{what:h,how:"encrypt",why:i.why}),w=f.epriv||f}var x=typeof h=="string"?h:await a.stringify(h),n={s:a.random(9),iv:a.random(15)},y=await s(w,n.s,i).then(v=>a.subtle.encrypt({name:i.name||"AES-GCM",iv:new Uint8Array(n.iv)},v,new a.TextEncoder().encode(x))),c={ct:a.Buffer.from(y,"binary").toString(i.encode||"base64"),iv:n.iv.toString(i.encode||"base64"),s:n.s.toString(i.encode||"base64")};if(i.raw||(c="SEA"+await a.stringify(c)),u)try{u(c)}catch(v){console.log(v)}return c}catch(v){if(console.log(v),e.err=v,e.throw)throw v;u&&u();return}}),B.exports=e.encrypt})(b,"./encrypt"),b(function(B){var e=b("./root"),a=b("./shim"),s=b("./settings"),d=b("./aeskey");e.decrypt=e.decrypt||(async(h,f,u,i)=>{try{i=i||{};var w=(f||i).epriv||f;if(!w){if(!e.I)throw"No decryption key.";f=await e.I(null,{what:h,how:"decrypt",why:i.why}),w=f.epriv||f}var x=await s.parse(h),n,y,c;try{n=a.Buffer.from(x.s,i.encode||"base64"),y=a.Buffer.from(x.iv,i.encode||"base64"),c=a.Buffer.from(x.ct,i.encode||"base64");var v=await d(w,n,i).then(t=>a.subtle.decrypt({name:i.name||"AES-GCM",iv:new Uint8Array(y),tagLength:128},t,new Uint8Array(c)))}catch{if(i.encode==="utf8")throw"Could not decrypt";if(e.opt.fallback)return i.encode="utf8",await e.decrypt(h,f,u,i)}var r=await s.parse(new a.TextDecoder("utf8").decode(v));if(u)try{u(r)}catch(t){console.log(t)}return r}catch(t){if(console.log(t),e.err=t,e.throw)throw t;u&&u();return}}),B.exports=e.decrypt})(b,"./decrypt"),b(function(B){var e=b("./root"),a=b("./shim");b("./settings"),e.secret=e.secret||(async(d,h,f,u)=>{try{if(u=u||{},!h||!h.epriv||!h.epub){if(!e.I)throw"No secret mix.";h=await e.I(null,{what:d,how:"secret",why:u.why})}var i=d.epub||d,w=h.epub,x=h.epriv,n=a.ossl||a.subtle,y=s(i),c=Object.assign({public:await n.importKey(...y,!0,[])},{name:"ECDH",namedCurve:"P-256"}),v=s(w,x),r=await n.importKey(...v,!1,["deriveBits"]).then(async l=>{var p=await n.deriveBits(c,l,256),m=new Uint8Array(p),k=await n.importKey("raw",m,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return n.exportKey("jwk",k).then(({k:S})=>S)}),t=r;if(f)try{f(t)}catch(l){console.log(l)}return t}catch(l){if(console.log(l),e.err=l,e.throw)throw l;f&&f();return}});var s=(d,h)=>{var[f,u]=d.split("."),i=h?{d:h}:{};return["jwk",Object.assign(i,{x:f,y:u,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};B.exports=e.secret})(b,"./secret"),b(function(B){var e=b("./root");e.certify=e.certify||(async(a,s={},d,h,f={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),a=(()=>{var t=[];if(a){if((typeof a=="string"||Array.isArray(a))&&a.indexOf("*")>-1)return"*";if(typeof a=="string")return a;if(Array.isArray(a)){if(a.length===1&&a[0])return typeof a[0]=="object"&&a[0].pub?a[0].pub:typeof a[0]=="string"?a[0]:null;a.map(l=>{typeof l=="string"?t.push(l):typeof l=="object"&&l.pub&&t.push(l.pub)})}return typeof a=="object"&&a.pub?a.pub:t.length>0?t:null}})(),!a)return console.log("No certificant found.");const i=f.expiry&&(typeof f.expiry=="number"||typeof f.expiry=="string")?parseFloat(f.expiry):null,w=(s||{}).read?s.read:null,x=(s||{}).write?s.write:typeof s=="string"||Array.isArray(s)||s["+"]||s["#"]||s["."]||s["="]||s["*"]||s[">"]||s["<"]?s:null,n=(f||{}).block||(f||{}).blacklist||(f||{}).ban||{},y=n.read&&(typeof n.read=="string"||(n.read||{})["#"])?n.read:null,c=typeof n=="string"?n:n.write&&(typeof n.write=="string"||n.write["#"])?n.write:null;if(!w&&!x)return console.log("No policy found.");const v=JSON.stringify({c:a,...i?{e:i}:{},...w?{r:w}:{},...x?{w:x}:{},...y?{rb:y}:{},...c?{wb:c}:{}});var u=await e.sign(v,d,null,{raw:1});if(f.raw||(u="SEA"+JSON.stringify(u)),h)try{h(u)}catch(t){console.log(t)}return u}catch(i){if(e.err=i,e.throw)throw i;h&&h();return}}),B.exports=e.certify})(b,"./certify"),b(function(B){var e=b("./shim"),a=b("./root");a.work=b("./work"),a.sign=b("./sign"),a.verify=b("./verify"),a.encrypt=b("./encrypt"),a.decrypt=b("./decrypt"),a.certify=b("./certify"),a.random=a.random||e.random,a.Buffer=a.Buffer||b("./buffer"),a.keyid=a.keyid||(async s=>{try{const d=e.Buffer.concat(s.replace(/-/g,"+").replace(/_/g,"/").split(".").map(i=>e.Buffer.from(i,"base64"))),h=e.Buffer.concat([e.Buffer.from([153,d.length/256,d.length%256]),d]),f=await sha1hash(h),u=e.Buffer.from(f,"binary");return u.toString("hex",u.length-8)}catch(d){throw console.log(d),d}}),((a.window||{}).GUN||{}).SEA=a,B.exports=a})(b,"./sea"),b(function(B){var e=b("./sea"),a,s;e.window?a=e.window.GUN||{chain:{}}:a=b((s+""==typeof N?".":"")+"./gun",1),e.GUN=a;function d(f){this._={$:this}}d.prototype=function(){function f(){}return f.prototype=a.chain,new f}(),d.prototype.constructor=d,a.chain.user=function(f){var u=this,w=u.back(-1),i;if(f)return f=e.opt.pub((f._||"")["#"])||f,w.get("~"+f);if(i=w.back("user"))return i;var w=w._,x=w,n=x.opt.uuid||h;return(x=(i=x.user=u.chain(new d))._).opt={},x.opt.uuid=function(y){var c=n(),v=w.user;return!v||!(v=v.is)||!(v=v.pub)||(c="~"+v+"/"+c,y&&y.call&&y(null,c)),c},i};function h(){return a.state().toString(36).replace(".","")}a.User=d,d.GUN=a,d.SEA=a.SEA=e,B.exports=d})(b,"./user"),b(function(B){var e,a=""+e!=typeof GUN?GUN||{chain:{}}:b((""+e==typeof N?".":"")+"./gun",1);a.chain.then=function(s,d){var h=this,f=new Promise(function(u,i){h.once(u,d)});return s?f.then(s):f}})(b,"./then"),b(function(B){var e=b("./user"),a=e.SEA,s=e.GUN,d=function(){};e.prototype.create=function(...h){var f=typeof h[0]=="object"&&(h[0].pub||h[0].epub)?h[0]:typeof h[1]=="object"&&(h[1].pub||h[1].epub)?h[1]:null,u=f&&(f.pub||f.epub)?f.pub:typeof h[0]=="string"?h[0]:null,i=f&&(f.pub||f.epub)?f:u&&typeof h[1]=="string"?h[1]:null,w=h.filter(t=>typeof t=="function")[0]||null,x=h&&h.length>1&&typeof h[h.length-1]=="object"?h[h.length-1]:{},n=this,y=n._,c=n.back(-1);if(w=w||d,x=x||{},x.check!==!1){var v;if(u||(v="No user."),(i||"").length<8&&(v="Password too short!"),v)return w({err:s.log(v)}),n}if(y.ing)return(w||d)({err:s.log("User is already being created or authenticated!"),wait:!0}),n;y.ing=!0;var r={};return r.a=function(t){if(r.pubs=t,t&&!x.already){var l={err:s.log("User already created!")};y.ing=!1,(w||d)(l),n.leave();return}r.salt=String.random(64),a.work(i,r.salt,r.b)},r.b=function(t){r.proof=t,f?r.c(f):a.pair(r.c)},r.c=function(t){var l;r.pair=t||{},(l=y.root.user)&&(l._.sea=t,l.is={pub:t.pub,epub:t.epub,alias:u}),r.data={pub:t.pub},r.d()},r.d=function(){r.data.alias=u,r.e()},r.e=function(){r.data.epub=r.pair.epub,a.encrypt({priv:r.pair.priv,epriv:r.pair.epriv},r.proof,r.f,{raw:1})},r.f=function(t){r.data.auth=JSON.stringify({ek:t,s:r.salt}),r.g(r.data.auth)},r.g=function(t){var l;r.data.auth=r.data.auth||t,c.get(l="~"+r.pair.pub).put(r.data).on(r.h);var p={};p[l]={"#":l},c.get("~@"+u).put(p).get(l).on(r.i)},r.h=function(t,l,p,m){m.off(),r.h.ok=1,r.i()},r.i=function(t,l,p,m){m&&(r.i.ok=1,m.off()),!(!r.h.ok||!r.i.ok)&&(y.ing=!1,w({ok:0,pub:r.pair.pub}),d===w&&(f?n.auth(f):n.auth(u,i)))},c.get("~@"+u).once(r.a),n},e.prototype.leave=function(h,f){var u=this,i=u.back(-1)._.user;if(i&&(delete i.is,delete i._.is,delete i._.sea),a.window)try{var w={};w=a.window.sessionStorage,delete w.recall,delete w.pair}catch{}return u}})(b,"./create"),b(function(B){var e=b("./user"),a=e.SEA,s=e.GUN,d=function(){};e.prototype.auth=function(...f){var u=typeof f[0]=="object"&&(f[0].pub||f[0].epub)?f[0]:typeof f[1]=="object"&&(f[1].pub||f[1].epub)?f[1]:null,i=!u&&typeof f[0]=="string"?f[0]:null,w=(i||u&&!(u.priv&&u.epriv))&&typeof f[1]=="string"?f[1]:null,x=f.filter(p=>typeof p=="function")[0]||null,n=f&&f.length>1&&typeof f[f.length-1]=="object"?f[f.length-1]:{},y=this,c=y._,v=y.back(-1);if(c.ing)return(x||d)({err:s.log("User is already being created or authenticated!"),wait:!0}),y;c.ing=!0;var r={},t,l=9;return r.a=function(p){if(!p)return r.b();if(!p.pub){var m=[];return Object.keys(p).forEach(function(k){k!="_"&&m.push(p[k])}),r.b(m)}if(r.name)return r.f(p);r.c((r.data=p).auth)},r.b=function(p){var m=(r.list=(r.list||[]).concat(p||[])).shift();if(t===m){if(r.name)return r.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(i&&l--){v.get("~@"+i).once(r.a);return}return r.err("Wrong user or password.")}v.get(m).once(r.a)},r.c=function(p){if(t===p)return r.b();if(typeof p=="string")return r.c(h(p));a.work(w,(r.auth=p).s,r.d,r.enc)},r.d=function(p){a.decrypt(r.auth.ek,p,r.e,r.enc)},r.e=function(p){if(t===p)return r.enc?(r.enc=null,r.b()):(r.enc={encode:"utf8"},r.c(r.auth));r.half=p,r.f(r.data)},r.f=function(p){var m=r.half||{},k=r.data||{};r.g(r.lol={pub:p.pub||k.pub,epub:p.epub||k.epub,priv:p.priv||m.priv,epriv:p.epriv||m.epriv})},r.g=function(p){if(!p||!p.pub||!p.epub)return r.b();r.pair=p;var m=v._.user,k=m._;k.tag;var S=k.opt;k=m._=v.get("~"+p.pub)._,k.opt=S,m.is={pub:p.pub,epub:p.epub,alias:i||p.pub},k.sea=r.pair,c.ing=!1;try{w&&t==(h(c.root.graph["~"+p.pub].auth)||"")[":"]&&(n.shuffle=n.change=w)}catch{}if(n.change?r.z():(x||d)(k),a.window&&(y.back("user")._.opt||n).remember)try{var T={};T=a.window.sessionStorage,T.recall=!0,T.pair=JSON.stringify(p)}catch{}try{v._.tag.auth?v._.on("auth",k):setTimeout(function(){v._.on("auth",k)},1)}catch(P){s.log("Your 'auth' callback crashed with:",P)}},r.h=function(p){if(!p)return r.b();if(i=p.alias,i||(i=p.alias="~"+u.pub),!p.auth)return r.g(u);u=null,r.c((r.data=p).auth)},r.z=function(){r.salt=String.random(64),a.work(n.change,r.salt,r.y)},r.y=function(p){a.encrypt({priv:r.pair.priv,epriv:r.pair.epriv},p,r.x,{raw:1})},r.x=function(p){r.w(JSON.stringify({ek:p,s:r.salt}))},r.w=function(p){if(n.shuffle){console.log("migrate core account from UTF8 & shuffle");var m={};Object.keys(r.data).forEach(function(k){m[k]=r.data[k]}),delete m._,m.auth=p,v.get("~"+r.pair.pub).put(m)}v.get("~"+r.pair.pub).get("auth").put(p,x||d)},r.err=function(p){var m={err:s.log(p||"User cannot be found!")};c.ing=!1,(x||d)(m)},r.plugin=function(p){if(!(r.name=p))return r.err();var m=[p];p[0]!=="~"&&(m[1]="~"+p,m[2]="~@"+p),r.b(m)},u?u.priv&&u.epriv?r.g(u):v.get("~"+u.pub).once(r.h):i?v.get("~@"+i).once(r.a):!i&&!w&&a.name(r.plugin),y};function h(f){if(typeof f!="string")return f;try{f=JSON.parse(f)}catch{f={}}return f}})(b,"./auth"),b(function(B){var e=b("./user"),a=e.SEA;e.GUN,e.prototype.recall=function(s,d){var h=this,f=h.back(-1);if(s=s||{},s&&s.sessionStorage){if(a.window)try{var u={};u=a.window.sessionStorage,u&&(f._.opt.remember=!0,(h.back("user")._.opt||s).remember=!0,(u.recall||u.pair)&&f.user().auth(JSON.parse(u.pair),d))}catch{}return h}return h}})(b,"./recall"),b(function(B){var e=b("./user"),a=e.SEA,s=e.GUN,d=function(){};e.prototype.pair=function(){var h=this,f;try{f=new Proxy({DANGER:"☠"},{get:function(u,i,w){if(!(!h.is||!(h._||"").sea))return h._.sea[i]}})}catch{}return f},e.prototype.delete=async function(h,f,u){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var i=this;i.back(-1);var w=i.back("user");try{w.auth(h,f,function(x){var n=(w.is||{}).pub;w.map().once(function(){this.put(null)}),w.leave(),(u||d)({ok:0})})}catch(x){s.log("User.delete failed! Error:",x)}return i},e.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const h=this.back(-1);try{return await authRecall(h),h._.user._}catch{const u="No session!";throw s.log(u),{err:u}}},e.prototype.trust=async function(h){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),s.is(h)&&h.get("pub").get((f,u)=>{console.log(f,u)}),h.get("trust").get(path).put(theirPubkey)},e.prototype.grant=function(h,f){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var u=this,i=u.back(-1).user(),w=i._.sea,x="";return u.back(function(n){n.is||(x+=n.get||"")}),async function(){var n,y=await i.get("grant").get(w.pub).get(x).then();y=await a.decrypt(y,w),y||(y=a.random(16).toString(),n=await a.encrypt(y,w),i.get("grant").get(w.pub).get(x).put(n));var c=h.get("pub").then(),v=h.get("epub").then();c=await c,v=await v;var r=await a.secret(v,w);n=await a.encrypt(y,r),i.get("grant").get(c).get(x).put(n,f)}(),u},e.prototype.secret=function(h,f){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var u=this,i=u.back(-1).user(),w=i.pair(),x="";return u.back(function(n){n.is||(x+=n.get||"")}),async function(){var n,y=await i.get("trust").get(w.pub).get(x).then();y=await a.decrypt(y,w),y||(y=a.random(16).toString(),n=await a.encrypt(y,w),i.get("trust").get(w.pub).get(x).put(n)),n=await a.encrypt(h,y),u.put(n,f)}(),u},B.exports=e})(b,"./share"),b(function(B){var e=b("./sea"),a=b("./settings"),s,d=(e.window||"").GUN||b((""+s==typeof N?".":"")+"./gun",1);d.on("opt",function(n){n.sea||(n.sea={own:{}},n.on("put",h,n)),this.to.next(n)});function h(n){var y=this,c=y.as,v=n.put,r=v["#"],t=v["."],l=v[":"],p=v[">"],m=n["#"],k;if(!(!r||!t)){if((n._||"").faith&&(c.opt||"").faith&&typeof n._=="function"){e.opt.pack(v,function(T){e.verify(T,!1,function(P){v["="]=e.opt.unpack(P),y.to.next(n)})});return}var S=function(T){c.on("in",{"@":m,err:n.err=T})};if((n._||"").DBG&&((n._||"").DBG.c=+new Date),0<=r.indexOf("<?")&&(k=parseFloat(r.split("<?")[1]||""),k&&p<d.state()-k*1e3)){(k=n._)&&k.stun&&k.stun--;return}if(r==="~@"){h.alias(y,n,l,t,r,c,S);return}if(r.slice(0,2)==="~@"){h.pubs(y,n,l,t,r,c,S);return}if(k=e.opt.pub(r)){h.pub(y,n,l,t,r,c,S,c.user||"",k);return}if(0<=r.indexOf("#")){h.hash(y,n,l,t,r,c,S);return}h.any(y,n,l,t,r,c,S,c.user||"")}}h.hash=function(n,y,c,v,r,t,l){e.work(c,null,function(p){function m(k){let S="";for(let T=0;T<k.length;T++)S+=T-1&1?"":String.fromCharCode(parseInt(k.substring(T-1,T+1),16));return btoa(S)}if(p&&p===v.split("#").slice(-1)[0])return n.to.next(y);if(p&&p===m(v.split("#").slice(-1)[0]))return n.to.next(y);l("Data hash not same as hash!")},{name:"SHA-256"})},h.alias=function(n,y,c,v,r,t,l){if(!c)return l("Data must exist!");if("~@"+v===u(c))return n.to.next(y);l("Alias not same!")},h.pubs=function(n,y,c,v,r,t,l){if(!c)return l("Alias must exist!");if(v===u(c))return n.to.next(y);l("Alias not same!")},h.pub=async function(n,y,c,v,r,t,l,p,m){var k;const S=await a.parse(c)||{},T=(P,C,g)=>{if(P.m&&P.s&&C&&m)return e.verify(P,m,o=>{if(s!==o&&s!==o.e&&y.put[">"]&&y.put[">"]>parseFloat(o.e))return l("Certificate expired.");if(s!==o&&o.c&&o.w&&(o.c===C||o.c.indexOf("*")>-1)){let A=r.indexOf("/")>-1?r.replace(r.substring(0,r.indexOf("/")+1),""):"";String.match=String.match||d.text.match;const E=Array.isArray(o.w)?o.w:typeof o.w=="object"||typeof o.w=="string"?[o.w]:[];for(const O of E)if(String.match(A,O["#"])&&String.match(v,O["."])||!O["."]&&String.match(A,O["#"])||!O["#"]&&String.match(v,O["."])||String.match(A?A+"/"+v:v,O["#"]||O)){if(O["+"]&&O["+"].indexOf("*")>-1&&A&&A.indexOf(C)==-1&&v.indexOf(C)==-1)return l(`Path "${A}" or key "${v}" must contain string "${C}".`);if(o.wb&&(typeof o.wb=="string"||(o.wb||{})["#"])){var _=n.as.root.$.back(-1);return typeof o.wb=="string"&&o.wb.slice(0,1)!=="~"&&(_=_.get("~"+m)),_.get(o.wb).get(C).once($=>$&&($===1||$===!0)?l(`Certificant ${C} blocked.`):g(o))}return g(o)}return l("Certificate verification fail.")}})};if(v==="pub"&&"~"+m===r)return c===m?n.to.next(y):l("Account not same!");if((k=p.is)&&k.pub&&!S["*"]&&!S["+"]&&(m===k.pub||m!==k.pub&&((y._.msg||{}).opt||{}).cert)){e.opt.pack(y.put,P=>{e.sign(P,p._.sea,async function(C){if(s===C)return l(e.err||"Signature fail.");if(y.put[":"]={":":k=e.opt.unpack(C.m),"~":C.s},y.put["="]=k,m===p.is.pub){(k=u(c))&&((t.sea.own[k]=t.sea.own[k]||{})[m]=1),JSON.stringifyAsync(y.put[":"],function(g,o){return g?l(g||"Stringify error."):(y.put[":"]=o,n.to.next(y))});return}if(m!==p.is.pub&&((y._.msg||{}).opt||{}).cert){const g=await a.parse(y._.msg.opt.cert);g&&g.m&&g.s&&T(g,p.is.pub,o=>{y.put[":"]["+"]=g,y.put[":"]["*"]=p.is.pub,JSON.stringifyAsync(y.put[":"],function(_,A){return _?l(_||"Stringify error."):(y.put[":"]=A,n.to.next(y))})})}},{raw:1})});return}e.opt.pack(y.put,P=>{e.verify(P,S["*"]||m,function(C){var g;if(C=e.opt.unpack(C),s===C)return l("Unverified data.");if((g=u(C))&&m===e.opt.pub(g)&&((t.sea.own[g]=t.sea.own[g]||{})[m]=1),S["+"]&&S["+"].m&&S["+"].s&&S["*"])T(S["+"],S["*"],o=>(y.put["="]=C,n.to.next(y)));else return y.put["="]=C,n.to.next(y)})})},h.any=function(n,y,c,v,r,t,l,p){if(t.opt.secure)return l("Soul missing public key at '"+v+"'.");t.on("secure",function(m){if(this.off(),!t.opt.secure)return n.to.next(m);l("Data cannot be changed.")}).on.on("secure",y)};var f=d.valid,u=function(n,y){return typeof(y=f(n))=="string"&&y};(d.state||"").ify;var i=/[^\w_-]/;e.opt.pub=function(n){if(n&&(n=n.split("~"),!(!n||!(n=n[1]))&&(n=n.split(i).slice(0,2),!(!n||n.length!=2)&&(n[0]||"")[0]!=="@")))return n=n.slice(0,2).join("."),n},e.opt.stringy=function(n){},e.opt.pack=function(n,y,c,v,r){var t,l;if(e.opt.check(n))return y(n);n&&n["#"]&&n["."]&&n[">"]&&(t=n[":"],l=1),JSON.parseAsync(l?t:n,function(p,m){var k=s!==(m||"")[":"]&&(m||"")["~"];if(!k){y(n);return}y({m:{"#":r||n["#"],".":c||n["."],":":(m||"")[":"],">":n[">"]||d.state.is(v,c)},s:k})})};var w=e.opt;e.opt.unpack=function(n,y,c){var v;if(s!==n){if(n&&s!==(v=n[":"]))return v;if(y=y||w.fall_key,!c&&w.fall_val&&(c={},c[y]=w.fall_val),!(!y||!c)){if(n===c[y]||!e.opt.check(c[y]))return n;var r=c&&c._&&c._["#"]||w.fall_soul,t=d.state.is(c,y)||w.fall_state;if(n&&n.length===4&&r===n[0]&&y===n[1]&&x(t)===x(n[3]))return n[2];if(t<e.opt.shuffle_attack)return n}}},e.opt.shuffle_attack=15463296e5;var x=Math.floor})(b,"./index")})()}(it)),it.exports}Tt();var ft={exports:{}},vt={},wt;function Ot(){if(wt)return vt;wt=1;var L={},b=typeof window<"u"?window.Gun:st(),N;b.on("opt",function(e){B(e),this.to.next(e)});function B(e){if(e.axe)return;var a=e.opt;if(a.peers,a.axe===!1||typeof process<"u"&&""+(L||"").AXE=="false")return;b.log.once("AXE","AXE relay enabled!");var s=e.axe={},d=a.mesh=a.mesh||b.Mesh(e),h=e.dup;d.way=function(c){if(c){if(c.get)return f(c);c.put||u(c)}};function f(c){if(c){var v=(c._||"").via,r;if(!v||!v.id||!(r=i(c)._))return u(c);r.asked=+new Date,f.turn(c,r.route,0)}}f.turn=function(c,v,r){var t=c["#"],l=h.s[t],p;if(!(!t||!l)&&(clearTimeout(l.lack),!(l.ack&&(t=l["##"])&&c["##"]===t))){if(p=Object.maps(v||a.peers).slice(r=r||0),!p.length){if(!v)return;f.turn(c,N,0);return}setTimeout.each(p,function(m){var k=a.peers[m];if(r++,!k||!k.wire){v&&v.delete(m);return}if(d.say(c,k)!==!1&&r%3==0)return 1},function(){l["##"]=c["##"],l.lack=setTimeout(function(){f.turn(c,v,r)},25)},3)}};function u(c){d.say(c,a.peers)}function i(c){var v="",r,t,l;if(!c||!c.get)return v;typeof(r=c.get["#"])=="string"&&(v=e.$.get(r)),typeof(l=c.get["."])=="string"?t=l:t="";var p=(c._||"").via,m=p.sub||(p.sub=new Object.Map);return(m.get(r)||m.set(r,l=new Object.Map)&&l).set(t,1),p.id&&v._&&(v._.route||(v._.route=new Object.Map)).set(p.id,p),v}function w(c){return(c=c||"")["="]||c["*"]||c[">"]||c}e.on("in",function(c){var v=this.to,r;if((r=c["@"])&&(r=h.s[r])){if(r.ack=(r.ack||0)+1,r.it&&r.it.get&&c.put){var t=r.it.get||"",l=i(r.it)._,p=(r.it._||"").via||"",m;if(p&&l&&(p.id&&(l.route||(l.route=new Object.Map)).set(p.id,p),m=p.sub||(p.sub=new Object.Map),l&&(m.get(w(t["#"]))||m.set(w(t["#"]),m=new Object.Map)&&m).set(w(t["."]),1),p=(c._||"").via||"",p&&(p.id&&(l.route||(l.route=new Object.Map)).set(p.id,p),m=p.sub||(p.sub=new Object.Map),l))){var k=w(t["#"]),S=m.get(k),T=w(t["."]);T?(S||m.set(k,S=new Object.Map)&&S).set(T,1):S||(m.set(k,S=new Object.Map),S.set("",1))}}if(r=r.back){setTimeout.each(Object.keys(r),function(P){v.next({"#":c["#"],"@":P,ok:c.ok})});return}}v.next(c)}),e.on("create",function(c){this.to.next(c),c.on("put",function(v){var r=this;r.as;var t=v.put,l=t["#"],p=t["."],m=t[":"],k=t[">"];if(r.to.next(v),!v["@"]&&!(!l||!p)){var S=c.$.get(l)._,T=(S||"").route;if(T){if(S.skip&&S.skip.has==p){S.skip.now=v["#"];return}(S.skip={now:v["#"],has:p}).to=setTimeout(function(){setTimeout.each(Object.maps(T),function(P){var C,E,g=S.skip||"";if(S.skip=null,!!(C=T.get(P))){if(!C.wire){T.delete(P);return}var o=(C.sub||(C.sub=new Object.Map)).get(l);if(o&&!(!o.get(p)&&!o.get(""))){var _=C.put||(C.put={}),A=c.graph[l],E;A&&N!==(E=A[p])&&(k=y(A,p),m=E),_[l]=n(_[l],p,k,m,l),E=h.track(C.next=C.next||String.random(9)),(E.back||(E.back={}))[""+(g.now||v["#"])]=1,!C.to&&(C.to=setTimeout(function(){x(C)},a.gap))}}})},9)}}})});function x(c){var v={"#":c.next,put:c.put,ok:{"@":3,"/":d.near}};c.next=c.put=c.to=null,d.say(v,c)}var n=b.state.ify,y=b.state.is;(function(){s.up={};var c=d.hear["?"];d.hear["?"]=function(v,r){var t;if(c(v,r),!!r.pid){if(r.pid===a.pid){d.bye(r);return}if(t=s.up[r.pid]){if(t===r)return;a.pid>r.pid&&(t=r,r=s.up[t.pid]),t.url=t.url||r.url,d.bye(r),s.up[t.pid]=t;return}r.url&&(s.up[r.pid]=r,s.stay&&s.stay())}},d.hear.opt=function(v,r){if(!v.ok){var t=v.opt;t&&(t=t.peers,!(!t||typeof t!="string")&&(99<=Object.keys(s.up).length||(d.hi({id:t,url:t,retry:9}),r&&d.say({dam:"opt",ok:1,"@":v["#"]},r))))}},s.stay=function(){clearTimeout(s.stay.to),s.stay.to=setTimeout(function(v,r){(v=e.stats&&e.stats.stay)&&(r={},Object.keys(s.up||"").forEach(function(t){t=(s.up||"")[t],t.url&&(r[t.url]={})}),(v.axe=v.axe||{}).up=r)},1e3*9)},setTimeout(function(v){(v=e.stats&&e.stats.stay&&e.stats.stay.axe)&&(v=v.up)&&(v instanceof Array||(v=Object.keys(v)),setTimeout.each(v||[],function(r){d.hear.opt({opt:{peers:r}})}))},1e3)})(),function(){a.mob=a.mob||9900,e.on("hi",function(c){if(this.to.next(c),!c.url){var v=d.near;if(!(a.mob>=v)){var r={};Object.keys(s.up).forEach(function(t){t=s.up[t],t.url&&(r[t.url]={})}),d.say({dam:"mob",mob:v,peers:r},c),setTimeout(function(){d.bye(c)},9)}}}),e.on("bye",function(c){this.to.next(c)})}()}return function(){var e=Array.from;if(Object.maps=function(a){return e&&a instanceof Map?e(a.keys()):(a instanceof Object.Map&&(a=a.s),Object.keys(a))},e)return Object.Map=Map;(Object.Map=function(){this.s={}}).prototype={set:function(a,s){return this.s[a]=s,this},get:function(a){return this.s[a]},delete:function(a){delete this.s[a]}}}(),vt}var gt;function $t(){return gt||(gt=1,function(L){(function(){var b=setTimeout||{},N;typeof window!=""+N&&(b.window=window);var B=(b.window||"").AXE||function(){};(B.window=b.window)&&(B.window.AXE=B);var e=(B.window||"").GUN||st();(e.AXE=B).GUN=B.Gun=e,e.window||Ot(),e.on("opt",function(s){a(s),this.to.next(s)});function a(s){if(s.axe)return;var d=s.opt,h=d.peers;if(d.axe===!1||!e.window)return;var f=e.window,u=f.localStorage||d.localStorage||{},i=f.location||d.location||{},w=f.navigator||d.navigator||{},x=s.axe={},n,y,c=d.mesh=d.mesh||e.Mesh(s);n=h[y=i.origin+"/gun"]=h[y]||{},n.id=n.url=y,n.retry=n.retry||0,n=h[y="http://localhost:8765/gun"]=h[y]||{},n.id=n.url=y,n.retry=n.retry||0,e.log.once("AXE","AXE enabled: Trying to find network via (1) local peer (2) last used peers (3) a URL parameter, and last (4) hard coded peers."),e.log.once("AXEWarn","Warning: AXE is in alpha, use only for testing!");var v=u.peers||"";v&&(v+=" "),v+=((i.search||"").split("peers=")[1]||"").split("&")[0],s.on("bye",function(t){this.to.next(t),t.url&&(w.onLine||(t.retry=1),!t.retry&&(x.fall&&delete x.fall[t.url||t.id],function l(){if(!x.fall){setTimeout(l,9);return}var p=Object.keys(x.fall||""),m=p[Math.random()*p.length>>0];if(p.length||(u.peers="",m="https://gunjs.herokuapp.com/gun"),h[m]){l();return}c.hi(m)}()))}),s.on("hi",function(t){this.to.next(t),t.url});function r(t){x.fall={},((t||"").match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/ig)||[]).forEach(function(l){x.fall[l]={url:l,id:l,retry:0}})}if(v){r(v);return}try{fetch(((i.search||"").split("axe=")[1]||"").split("&")[0]||i.axe||"https://raw.githubusercontent.com/wiki/amark/gun/volunteer.dht.md").then(function(t){return t.text()}).then(function(t){r(u.peers=t)}).catch(function(){r()})}catch{r()}}try{""+N!="object"&&(L.exports=B)}catch{}})()}(ft)),ft.exports}$t();const Dt={class:"section"},Et={class:"form-group"},Ct={class:"form-group"},Bt={class:"message"},Gt={class:"section"},Nt={class:"form-group"},Pt={class:"form-group"},Ut={key:0,class:"logged-in"},Mt={class:"pubkey-container"},It={key:1,class:"error-message"},Jt={class:"section"},Rt={class:"form-group"},Kt={class:"form-group"},Lt={class:"message"},Ht={class:"section"},qt={class:"form-group"},Ft={class:"buddy-list"},Wt={class:"pubkey-container"},Vt=["onClick"],Xt=["onClick"],zt={class:"section"},Yt={key:0},Zt={class:"form-group"},Qt={class:"chat-messages"},te={class:"message-header"},ee={key:0},ne={key:1},re={key:2,class:"copy-pubkey"},ie=["onClick"],oe={class:"message-body"},ue={key:0,class:"copy-success"},ae=kt({__name:"test",setup(L){console.log("[GunUserFullDemo] Starting integrated test...");const b=["https://peer.wallie.io/gun"],N=jt({peers:b,localStorage:!0});console.log("[GunUserFullDemo] GUN instance created with peers:",b);const B=N.user(),e=K(""),a=K(""),s=K(""),d=K(""),h=K(""),f=K(!1),u=K(null),i=K(null),w=K(null),x=K(""),n=K(""),y=K(""),c=K(""),v=K([]),r=K(null),t=K(null),l=K(""),p=K([]);let m=null;const k=K(!1);function S(){const D=e.value.trim(),j=a.value;if(console.log("[onRegister] Attempting to register:",D),!D||!j){s.value="请填写用户名和密码";return}B.create(D,j,G=>{var I;if(console.log("[onRegister] Registration ack:",G),"err"in G)s.value="注册失败: "+G.err;else{s.value="注册成功! 请使用相同的用户名和密码登录",e.value="",a.value="";const J=(I=B.is)==null?void 0:I.pub;J&&N.get("users").get(J).put({alias:D},R=>{R.err?console.error("[onRegister] Error saving user alias:",R.err):console.log("[onRegister] User alias saved successfully")})}})}function T(){const D=d.value.trim(),j=h.value;if(console.log("[onLogin] Attempting to login:",D),!D||!j){w.value="请填写用户名和密码";return}B.auth(D,j,G=>{console.log("[onLogin] Login ack:",G),"err"in G?(f.value=!1,u.value=null,i.value=null,w.value=G.err):(f.value=!0,u.value=D,w.value=null,B.is&&B.is.pub?(i.value=B.is.pub,console.log("[onLogin] Current user pubKey:",B.is.pub)):G.pub?(i.value=G.pub,console.log("[onLogin] Current user pubKey from ack:",G.pub)):(i.value="(未知公钥)",console.warn("[onLogin] 无法获取当前用户的公钥")),i.value&&i.value!=="(未知公钥)"&&N.get("users").get(i.value).once(I=>{I&&I.alias?u.value=I.alias:console.warn("[onLogin] 用户名未找到")}),o())})}function P(){console.log("[onLogout] Logging out"),B.leave(),f.value=!1,u.value=null,i.value=null,v.value=[],r.value=null,t.value=null,p.value=[],w.value=null,alert("已退出")}function C(){const D=x.value,j=n.value;if(console.log("[onChangePassword] Attempting to change password"),!D||!j){y.value="请填写旧密码和新密码";return}B.change(D,j,G=>{console.log("[onChangePassword] Change password ack:",G),G.err?y.value="修改密码失败: "+G.err:(y.value="密码修改成功! 请使用新密码重新登录",x.value="",n.value="")})}function g(){const D=c.value.trim();if(console.log("[addBuddy] Attempting to add buddy with pubKey:",D),!f.value){alert("请先登录");return}if(!D){alert("请填写好友的公钥");return}B.get("buddy").get(D).put(!0,j=>{console.log("[addBuddy] Add buddy ack:",j),j.err?alert("添加好友失败: "+j.err):(alert("已添加好友: "+D),c.value="",N.get("users").get(D).once(G=>{G&&G.alias?v.value.some(J=>J.pub===D)||v.value.push({alias:G.alias,pub:D}):(v.value.some(J=>J.pub===D)||v.value.push({alias:"(未知)",pub:D}),console.warn("[addBuddy] 好友用户名未找到"))}))})}function o(){console.log("[listenBuddyList] Listening to buddy list updates"),v.value=[],B.get("buddy").map().on((D,j)=>{console.log("[buddyList map.on] val=",D,"key=",j),D?N.get("users").get(j).once(G=>{G&&G.alias?v.value.some(J=>J.pub===j)||v.value.push({alias:G.alias,pub:j}):(v.value.some(J=>J.pub===j)||v.value.push({alias:"(未知)",pub:j}),console.warn("[listenBuddyList] 好友用户名未找到 for pubKey:",j))}):v.value=v.value.filter(G=>G.pub!==j)})}function _(D){console.log("[openChat] Opening chat with pubKey:",D),r.value=D;const j=v.value.find(G=>G.pub===D);j?t.value=j.alias:t.value="(未知)",p.value=[],A(D)}function A(D){console.log("[listenChat] Listening to chat with:",D),m&&m.off&&m.off();const j=O(i.value,D);console.log("[listenChat] chatId:",j),m=N.get("chats").get(j).map().on((G,I)=>{console.log("[listenChat] New message:",G,"msgId:",I),G&&p.value.push(G)})}function E(){if(!r.value){alert("未选择好友");return}const D=l.value.trim();if(!D){alert("消息不能为空");return}const j=O(i.value,r.value),G={from:i.value||"未知",text:D,timestamp:Date.now()};console.log("[sendChat] Sending message:",G),N.get("chats").get(j).set(G,I=>{I.err?(console.error("[sendChat] 发送失败:",I.err),alert("发送失败: "+I.err)):(console.log("[sendChat] 发送成功"),p.value.push(G),l.value="")})}function O(D,j){return D?D<j?`${D}_${j}`:`${j}_${D}`:(console.warn("[generateChatId] pubA is null, using pubB only"),j)}function $(D){const j=v.value.find(G=>G.pub===D);return j?j.alias:null}async function U(D){if(!D||D==="(未知公钥)"){alert("无法复制无效的公钥");return}try{await navigator.clipboard.writeText(D),k.value=!0,setTimeout(()=>{k.value=!1},2e3)}catch(j){console.error("复制失败:",j),alert("复制失败，请手动复制")}}return(D,j)=>(H(),q(ot,null,[M("div",Dt,[j[11]||(j[11]=M("h3",null,"注册 (user.create)",-1)),M("div",Et,[j[9]||(j[9]=M("label",{for:"regAlias"},"Alias (用户名)",-1)),V(M("input",{id:"regAlias","onUpdate:modelValue":j[0]||(j[0]=G=>e.value=G),type:"text",placeholder:"用户名",class:"input"},null,512),[[X,e.value]])]),M("div",Ct,[j[10]||(j[10]=M("label",{for:"regPassword"},"Password (密码)",-1)),V(M("input",{id:"regPassword","onUpdate:modelValue":j[1]||(j[1]=G=>a.value=G),type:"password",placeholder:"密码",class:"input"},null,512),[[X,a.value]])]),M("button",{onClick:S,class:"button"},"注册"),M("p",Bt,W(s.value),1)]),M("div",Gt,[j[15]||(j[15]=M("h3",null,"登录 (user.auth)",-1)),M("div",Nt,[j[12]||(j[12]=M("label",{for:"loginAlias"},"Alias (用户名)",-1)),V(M("input",{id:"loginAlias","onUpdate:modelValue":j[2]||(j[2]=G=>d.value=G),type:"text",placeholder:"用户名",class:"input"},null,512),[[X,d.value]])]),M("div",Pt,[j[13]||(j[13]=M("label",{for:"loginPassword"},"Password (密码)",-1)),V(M("input",{id:"loginPassword","onUpdate:modelValue":j[3]||(j[3]=G=>h.value=G),type:"password",placeholder:"密码",class:"input"},null,512),[[X,h.value]])]),M("button",{onClick:T,class:"button"},"登录"),f.value?(H(),q("div",Ut,[M("p",null,"已登录: "+W(u.value),1),M("div",Mt,[M("p",null,[j[14]||(j[14]=M("b",null,"公钥 (PubKey):",-1)),nt(" "+W(i.value),1)]),M("button",{onClick:j[4]||(j[4]=G=>U(i.value)),class:"copy-button"},"复制")]),M("button",{onClick:P,class:"button danger"},"退出")])):Q("",!0),w.value?(H(),q("p",It,W(w.value),1)):Q("",!0)]),M("div",Jt,[j[18]||(j[18]=M("h3",null,"修改密码 (user.change)",-1)),M("div",Rt,[j[16]||(j[16]=M("label",{for:"oldPassword"},"旧密码",-1)),V(M("input",{id:"oldPassword","onUpdate:modelValue":j[5]||(j[5]=G=>x.value=G),type:"password",placeholder:"旧密码",class:"input"},null,512),[[X,x.value]])]),M("div",Kt,[j[17]||(j[17]=M("label",{for:"newPassword"},"新密码",-1)),V(M("input",{id:"newPassword","onUpdate:modelValue":j[6]||(j[6]=G=>n.value=G),type:"password",placeholder:"新密码",class:"input"},null,512),[[X,n.value]])]),M("button",{onClick:C,class:"button"},"修改密码"),M("p",Lt,W(y.value),1)]),M("div",Ht,[j[22]||(j[22]=M("h3",null,"好友管理",-1)),j[23]||(j[23]=M("p",{class:"info"},"需登录后才可添加好友",-1)),M("div",qt,[j[19]||(j[19]=M("label",{for:"friendPub"},"好友公钥 (PubKey)",-1)),V(M("input",{id:"friendPub","onUpdate:modelValue":j[7]||(j[7]=G=>c.value=G),type:"text",placeholder:"对方公钥",class:"input"},null,512),[[X,c.value]])]),M("button",{onClick:g,class:"button"},"添加好友"),j[24]||(j[24]=M("h4",null,"我的好友列表 (Buddy List)",-1)),M("ul",Ft,[(H(!0),q(ot,null,pt(v.value,G=>(H(),q("li",{key:G.pub,class:"buddy-item"},[M("div",null,[j[20]||(j[20]=M("strong",null,"用户名:",-1)),nt(" "+W(G.alias),1)]),M("div",Wt,[j[21]||(j[21]=M("strong",null,"公钥:",-1)),nt(" "+W(G.pub)+" ",1),M("button",{onClick:I=>U(G.pub),class:"copy-button"},"复制",8,Vt)]),M("button",{onClick:I=>_(G.pub),class:"button small"},"聊天",8,Xt)]))),128))])]),M("div",zt,[M("h3",null,"聊天 - 当前好友: "+W(t.value||"暂无"),1),r.value?(H(),q("div",Yt,[M("div",Zt,[j[25]||(j[25]=M("label",{for:"newMsg"},"发送消息",-1)),V(M("input",{id:"newMsg","onUpdate:modelValue":j[8]||(j[8]=G=>l.value=G),type:"text",placeholder:"输入消息",class:"input"},null,512),[[X,l.value]])]),M("button",{onClick:E,class:"button"},"发送"),M("ul",Qt,[(H(!0),q(ot,null,pt(p.value,(G,I)=>(H(),q("li",{key:I,class:mt({"my-message":G.from===i.value})},[M("div",te,[G.from===i.value?(H(),q("strong",ee,"[我]")):(H(),q("strong",ne,"["+W($(G.from)||"对方")+"]",1)),G.from!==i.value?(H(),q("span",re,[M("button",{onClick:J=>U(G.from),class:"copy-button small"},"复制",8,ie)])):Q("",!0)]),M("div",oe,[nt(W(G.text)+" ",1),M("small",null,"("+W(new Date(G.timestamp).toLocaleTimeString())+")",1)])],2))),128))])])):Q("",!0)]),k.value?(H(),q("div",ue,"公钥已复制！")):Q("",!0)],64))}}),se=_t(ae,[["__scopeId","data-v-9996b52d"]]);export{se as default};
